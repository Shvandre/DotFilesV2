import{j as e,f1 as q,f$ as X,gf as Y,f3 as Z,i as R,k as M,aZ as ee,v as P,L as _,e as F,gg as W,f as H,a_ as L,a$ as k,P as se,a9 as V,r as a,fu as O,eP as te,gh as ne,ca as re,eO as ie,gi as ae,gj as oe,gk as ce,gl as de,gm as le,gn as ue,fV as fe,go as me,fk as he,H as pe,J as ge,ba as Q,a8 as xe,cp as G,ct as $,cu as K,cs as ye,cv as Te,cT as U,b8 as Ae,b9 as we,fl as Se,cx as je,cw as Ce,aa as be,bQ as z,fM as B,cd as Ne,cy as J,fN as ke,fn as Ee,fm as ve,s as Be,fp as Re,N as Me,fq as _e,bS as D,fw as Fe,bj as We,bk as He,fx as Le,fy as I,fz as De,fA as Ie,fB as Pe,fG as Ve,fH as Oe,bh as Qe,fI as Ge}from"./main.BJ1Zz46B.js";import{T as $e}from"./TransitionGroup.9hOyNVKg.js";const Ke=({onBack:r,onClose:s})=>e.jsxs(q,{children:[e.jsx(X,{onClick:r,children:e.jsx(Y,{})}),e.jsx(Z,{handleClose:s})]}),Ue=({nftItem:r})=>{const{t:s}=R(),t=M(),n=ee();return e.jsxs(P,{fullWidth:!0,children:[r.collection&&e.jsx(_,{onClick:()=>t.copyToClipboard(k(r.collection.address,n,!0)),children:e.jsxs(F,{children:[e.jsx(W,{children:s("NFT_collection_id")}),e.jsx(H,{children:L(k(r.collection.address,n,!0))})]})}),e.jsx(_,{onClick:()=>t.copyToClipboard(k(r.address,n,!0)),children:e.jsxs(F,{children:[e.jsx(W,{children:s("NFT_item_id")}),e.jsx(H,{children:L(k(r.address,n,!0))})]})})]})},ze=new re({asset:z,weiAmount:0}),Je=(r,s,t)=>{const n=Q(),l=xe(),d=G(),f=a.useMemo(()=>{if(t){if(n.type==="ton-multisig")return{type:"multisig",ttlSeconds:5*60};if(t==="external")return $;if(t==="battery")return K;throw new Error(`Unsupported sender type for nft transfer ${t}`)}},[t,n]),g=ye(f),y=Te(g),T=U();return Ae([we.estimate,s?.address,l,y],async()=>{try{if(n.type==="watch-only")throw new Error("account not controllable");const i=new B(n.activeTonWallet.rawAddress),c=await g(),m=i.encodeNftTransfer({nftAddress:r.address,recipientAddress:s.address.address,forwardPayload:s.comment?J.comment(s.comment):null,responseAddress:"excessAddress"in c&&c.excessAddress?c.excessAddress:void 0});return await T.estimate(c,m)}catch(i){throw await d(i),i}},{enabled:s!=null&&!!g&&f!==void 0})},qe=(r,s,t,n)=>{const l=Q(),d=Se(),{mutateAsync:f}=je(),g=Ce(),y=U(),T=G();return be(async()=>{if(l.type==="watch-only")return console.error("Can't send a transfer using this account"),!1;if(!t)return!1;if(t.fee.type==="ton-asset"&&t.fee.extra.asset.id!==z.id)throw new Error(`Unexpected fee ${t.fee}`);try{let i;if(l.type==="ton-multisig"){if(n.multisigTTL===void 0)throw new Error("TTL must be specified for multisig sending");i={type:"multisig",ttlSeconds:60*Number(n.multisigTTL)}}else if(n.selectedSenderType==="external")i=$;else if(n.selectedSenderType==="battery")i=K;else throw new Error(`Unsupported sender type for nft transfer ${n.selectedSenderType}`);const c=await g(i),m=new B(l.activeTonWallet.rawAddress),w=new Ne(B.nftTransferBase.toString()).plus(Math.abs(t.event?.extra??0)),h=m.encodeNftTransfer({nftAddress:s.address,recipientAddress:r.address.address,forwardPayload:r.comment?J.comment(r.comment):null,nftTransferAmountWei:w,responseAddress:"excessAddress"in c&&c.excessAddress?c.excessAddress:void 0});await y.send(c,ke,h),d("send-nft")}catch(i){await T(i)}return await f(),!0})},Xe={type:"nfr_transfer"},Ye=({recipient:r,onClose:s,nftItem:t,headerBlock:n,mainButton:l,multisigTTL:d,isAnimationProcess:f})=>{const y=se()&&f,{standalone:T}=V(),[i,c]=a.useState(!1),{t:m}=R(),w=O(),{data:h}=te(Xe),[A,S]=a.useState(),b=Je(t,r,A),{mutateAsync:E,isLoading:x,error:j,reset:v,isIdle:N}=qe(r,t,b.data,{multisigTTL:d,selectedSenderType:A});a.useEffect(()=>{N&&h&&S(h[0].type)},[JSON.stringify(h),N]);const C=t.previews?.find(u=>u.resolution==="100x100"),o=async()=>{if(x)return!1;try{v();const u=await E();return u&&(c(!0),setTimeout(s,2e3)),u}catch(u){return console.error(u),!1}},p=async u=>{u.stopPropagation(),u.preventDefault()};return e.jsx(ne.Provider,{value:{recipient:r,assetAmount:ze,estimation:b,formState:{done:i,isLoading:x,error:j},onClose:()=>s(),onBack:()=>{},handleSubmit:o},children:e.jsxs(ie,{onSubmit:p,standalone:T,children:[n,e.jsxs(ae,{children:[C?e.jsx(oe,{src:C.url}):e.jsx(ce,{}),e.jsx(de,{children:t.dns??t.metadata.name}),e.jsx(le,{children:m("txActions_signRaw_types_nftItemTransfer")})]}),e.jsxs(P,{margin:!1,fullWidth:!0,children:[e.jsx(ue,{}),e.jsx(fe,{availableSendersChoices:h,selectedSenderType:A,onSenderTypeChange:S}),e.jsx(me,{})]}),e.jsx(Ue,{nftItem:t}),e.jsx(he,{}),w&&d?e.jsx(es,{ttl:d}):null,!y&&e.jsx(pe,{children:e.jsx(ge,{children:l})})]})})},Ze=Be(Re)`
    margin-bottom: 1rem;
`,es=({ttl:r})=>{const{data:s}=Ee(),{signerWallet:t}=ve();return s?e.jsx(Ze,{status:"progress",signedWallets:[],threshold:s.threshold,pendingWallets:s.signers,hostAddress:t.rawAddress,secondsLeft:Number(r)*60}):null},ss=({nftItem:r,onClose:s})=>{const t=M(),{t:n}=R(),{standalone:l,extension:d}=V(),f=a.useRef(null),g=a.useRef(null),y=a.useRef(null),[T,i]=a.useState(!0),[c,m]=a.useState(),w=O(),{mutateAsync:h}=_e(),A=async o=>{i(!0),m(o),j("confirm")},S=a.useCallback(()=>{i(!1),m(o=>o?{...o,done:!1}:void 0),j("recipient")},[m]),[b,E]=a.useState(),[x,j]=a.useState(w?"multisig-settings":"recipient"),v=a.useCallback(async({address:o})=>{const p={address:o},u=await h(p);A({address:{...p,blockchain:D.TON},toAccount:u,comment:"",done:!0})},[A,h]),N=async o=>{const p=Ge({url:o});if(p===null)return t.uiEvents.emit("copy",{method:"copy",params:n("Unexpected_QR_Code")});await v(p)},C={"multisig-settings":f,recipient:g,confirm:y}[x];return e.jsx(Fe,{standalone:l,extension:d,children:e.jsx($e,{childFactory:We(T),children:e.jsx(He,{nodeRef:C,classNames:"right-to-left",addEndListener:o=>{setTimeout(o,Qe)},children:o=>e.jsxs("div",{ref:C,children:[x==="multisig-settings"&&e.jsx(Le,{onSubmit:p=>{i(!0),E(p.lifetime),j("recipient")},isAnimationProcess:o==="exiting",header:e.jsx(De,{title:n("multisig_create_order_title"),onClose:s}),MainButton:I}),x==="recipient"&&e.jsx(Ie,{data:c,setRecipient:A,onScan:N,acceptBlockchains:[D.TON],MainButton:I,HeaderBlock:()=>e.jsx(Pe,{title:n("nft_transfer_title"),onClose:s,onBack:w?S:void 0}),isAnimationProcess:o==="exiting"}),x==="confirm"&&e.jsx(Ye,{onClose:s,recipient:c,nftItem:r,mainButton:e.jsx(Ve,{MainButton:Oe}),headerBlock:e.jsx(Ke,{onBack:S,onClose:s}),multisigTTL:b,isAnimationProcess:o==="exiting"})]})},x)})})},rs=()=>{const r=M(),[s,t]=a.useState(),n=a.useCallback(()=>{t(void 0)},[t]);a.useEffect(()=>{const d=f=>{t(f.params)};return r.uiEvents.on("transferNft",d),()=>{r.uiEvents.off("transferNft",d)}},[]);const l=a.useCallback(()=>{if(s)return e.jsx(ss,{onClose:n,nftItem:s})},[s,n]);return e.jsx(Me,{isOpen:!!s,handleClose:n,hideButton:!0,backShadow:!0,mobileFullScreen:!0,children:l})};export{rs as default};
