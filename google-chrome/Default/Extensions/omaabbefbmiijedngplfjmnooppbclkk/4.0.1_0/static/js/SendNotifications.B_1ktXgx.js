import{bb as ze,r as a,c9 as Ue,eP as Qe,eQ as Ge,eR as Je,aM as je,c0 as ye,bQ as ue,b8 as Be,ca as E,j as t,cA as Re,eS as qe,eT as Ce,cd as v,eU as Ke,eV as Ye,R as Ze,s as T,D as Xe,f as D,eW as et,eX as tt,e5 as nt,v as st,L as ne,e as se,dI as ae,aY as ie,B as at,a9 as de,cg as be,aL as fe,bS as S,cf as it,eY as ot,ch as rt,ci as ct,cj as _e,ck as lt,eZ as Ne,c5 as Me,i as me,P as Fe,o as ut,A as dt,bE as ft,eO as Oe,e_ as mt,e$ as U,f0 as Q,f1 as pt,f2 as ht,f3 as xt,Q as gt,H as G,J,f4 as kt,cc as jt,n as Ie,U as yt,a1 as bt,cL as At,k as pe,bx as he,d_ as St,c7 as Tt,f5 as wt,f6 as vt,f7 as Vt,f8 as Bt,f9 as Rt,fa as Ct,fb as _t,fc as Nt,fd as Mt,fe as Ft,ff as Ot,fg as It,fh as Et,fi as Dt,cl as Lt,fj as Pt,fk as Wt,cs as Ht,cv as $t,cr as Ee,e2 as xe,cp as zt,cw as Ut,fl as Qt,cx as Gt,aa as Jt,fm as qt,fn as Kt,fo as Yt,fp as Zt,b7 as Xt,fq as De,cS as Le,fr as en,fs as tn,ft as nn,fu as sn,ek as an,fv as on,fw as rn,bj as cn,bk as ln,fx as un,fy as Ae,fz as dn,fA as fn,fB as mn,fC as pn,fD as hn,cB as Se,fE as Te,fF as we,fG as ve,fH as Ve,bh as xn,fI as gn,fJ as kn,fK as jn,N as yn}from"./main.BJ1Zz46B.js";import{T as bn}from"./TransitionGroup.9hOyNVKg.js";const An=(e,n)=>{const i=e.id===qe.id?.9:.5,s=Ce(new v(Ke.jettonTransferAmount.toString())).multipliedBy(1.2).div(i).div(n);return E.fromRelativeAmount({asset:e,amount:s})},Sn=({isMax:e,assetAmount:n,...i})=>{const s=ze(),o=a.useMemo(()=>({type:"transfer",asset:n.asset}),[n.asset]),c=Ue(n.asset),[u,r]=a.useState(n),{data:d}=Qe(o),[p,x]=a.useState(),k=Ge({recipient:i.recipient,amount:u,isMax:e,senderType:p}),g=Je({recipient:i.recipient,amount:u,isMax:e,estimation:k.data,senderType:p});a.useEffect(()=>{g.isIdle&&d&&x(d[0].type)},[JSON.stringify(d),g.isIdle]);const V=je(n.asset)?ye(n.asset.address):void 0,j=V!==ue.address&&e&&p==="gasless"&&je(n.asset)&&c,y=Be(["current-token-to-ton-rate",ye(n.asset.address)],async()=>{const m=await new Ye(s.tonApiV2).getRates({tokens:[V],currencies:["TON"]});return Object.values(m.rates)[0].prices.TON},{enabled:!!j});return a.useEffect(()=>{if(!j)return r(n);if(!y.data)return;const m=An(n.asset,y.data);r(new E({asset:n.asset,weiAmount:c.minus(m.weiAmount)}))},[e,n,p,c?.toFixed(0),y.data]),t.jsx(Re,{estimation:k,...g,...i,assetAmount:u,selectedSenderType:p,onSenderTypeChange:x,availableSendersChoices:d})},Tn=T.input`
    padding: 0;
    margin: 0;
    border: none;
    outline: none;
    /* added styles */
    font-family: inherit;
    font-size: inherit;
    background: transparent;
    color: ${e=>e.theme.textPrimary};

    font-family: 'Montserrat', sans-serif;
    font-style: normal;
    font-weight: 600;

    line-height: 49px;
    text-align: right;

    -moz-appearance: textfield;

    &::-webkit-outer-spin-button,
    &::-webkit-inner-spin-button {
        -webkit-appearance: none;
    }
`,Pe=Ze.forwardRef(({value:e,setValue:n,inputSize:i},s)=>t.jsx(Tn,{autoComplete:"off",autoCorrect:"off",spellCheck:!1,id:"sentence","data-testid":"amount-input",ref:s,style:{fontSize:`${i.size}px`,width:`${i.width}px`},inputMode:"decimal",type:"text",value:e,onChange:o=>{n(o.target.value)}}));Pe.displayName="Sentence";const wn=T.div`
    background: ${e=>e.theme.buttonTertiaryBackground};
    border-radius: ${e=>e.theme.cornerMedium};
    padding: 0.5rem 1rem;
    display: flex;
    gap: 0.5rem;
`,vn=T.span`
    color: ${e=>e.theme.iconSecondary};
    display: flex;
    align-items: center;
`,oe=T.img`
    border-radius: ${e=>e.theme.cornerFull};
    width: 24px;
    height: 24px;
`,re=T.div`
    display: flex;
    gap: 0.5rem;
    width: 200px;
    overflow: hidden;
`,ce=T(at)`
    color: ${e=>e.theme.textSecondary};
    text-overflow: ellipsis;
    overflow: hidden;
`,le=T.span`
    padding-left: 0.5rem;
    color: ${e=>e.theme.accentBlue};
    display: flex;
`,Vn=({onClose:e,jetton:n,jettons:i,setJetton:s,info:o})=>{const c=nt(),u=a.useRef(null);return a.useEffect(()=>{u.current&&u.current.parentElement?.parentElement?.scrollIntoView({behavior:"smooth"})},[u]),t.jsxs(st,{margin:!1,dropDown:!0,children:[t.jsx(ne,{dropDown:!0,onClick:()=>{s(ae.TON),e()},children:t.jsxs(se,{children:[t.jsxs(re,{children:[t.jsx(oe,{src:"https://wallet.tonkeeper.com/img/toncoin.svg"}),t.jsx(D,{children:ae.TON}),t.jsx(ce,{children:c(o?.balance??0)})]}),ae.TON===n?t.jsx(le,{children:t.jsx(ie,{})}):void 0]})}),o?.extraBalance?.map(r=>t.jsx(ne,{dropDown:!0,onClick:()=>{s(r.preview.symbol),e()},children:t.jsxs(se,{children:[t.jsxs(re,{children:[t.jsx(oe,{src:r.preview.image}),t.jsx(D,{children:r.preview.symbol}),t.jsx(ce,{children:c(r.amount,r.preview.decimals)})]}),r.preview.symbol===n?t.jsx(le,{ref:u,children:t.jsx(ie,{})}):void 0]})},r.preview.symbol)),i.balances.map(r=>t.jsx(ne,{dropDown:!0,onClick:()=>{s(r.jetton.address),e()},children:t.jsxs(se,{children:[t.jsxs(re,{children:[t.jsx(oe,{src:r.jetton.image}),t.jsx(D,{children:r.jetton.symbol}),t.jsx(ce,{children:c(r.balance,r.jetton.decimals)})]}),r.jetton.address===n?t.jsx(le,{ref:u,children:t.jsx(ie,{})}):void 0]})},r.jetton.address))]})},Bn=({jetton:e,jettons:n,setJetton:i,info:s})=>t.jsx(Xe,{center:!0,payload:o=>t.jsx(Vn,{info:s,onClose:o,jetton:e,jettons:n,setJetton:i}),children:t.jsxs(wn,{children:[t.jsx(D,{children:et(e,n)}),t.jsx(vn,{children:t.jsx(tt,{})})]})}),Rn=(e,n)=>{const{ios:i,standalone:s}=de();a.useEffect(()=>{if(!i)return;const o=window.innerHeight;function c(){const d=e.current;if(!d)return;const p=o-this.height+16,x=s?Math.max(32,p):p;d.style.bottom=`${x}px`;const k=Math.min(this.height-16-56-16-36-16-16-16-16-37,272);n.current&&(n.current.style.height=`${k}px`)}function u(){const d=window.visualViewport;d&&d.removeEventListener("resize",c),setTimeout(()=>{const p=e.current;p&&(p.style.bottom=null)})}const r=window.visualViewport;return r&&(setTimeout(()=>c.call(r),300),r.addEventListener("resize",c)),()=>{u()}},[e.current,n.current])},We={size:40,width:30},Cn=(e,n)=>{const i=n.clientWidth;let s=We.size,o=be(e,`600 ${s}px 'Montserrat'`);for(;Math.round(o)>i-115;)s=Math.max(1,s-1),o=be(e,`600 ${s}px 'Montserrat'`);return{width:Math.max(Math.round(o)+5,e.length*6,30),size:s}},_n=(e,n)=>{a.useEffect(()=>{const i=setTimeout(()=>{e.current&&e.current.focus()},300);return()=>{clearTimeout(i)}},[e.current,n])};function z(e){return e.toFormat({groupSeparator:ot(),decimalSeparator:it()})}const Nn=(e,n)=>{const{kind:i,payload:s}=n;switch(i){case"select":return{inputValue:"0",coinValue:new v(0),token:s.token,inFiat:!1,isMax:!1};case"max":if(s.prices!==void 0){const o=s.value.multipliedBy(s.prices).decimalPlaces(2,v.ROUND_FLOOR);return{...e,inputValue:z(e.inFiat?o:s.value),fiatValue:o,coinValue:s.value,isMax:!e.isMax}}else return{...e,inputValue:z(s.value),coinValue:s.value,isMax:!e.isMax};case"input":{const o=e.inFiat?2:e.token.decimals;let c=rt(s.value);ct(c,o)||(c=e.inputValue),_e(c)&&(c=lt(c));const u=Ne(c),r=e.inFiat?u.div(s.prices??0):u,d=e.inFiat?u:u.multipliedBy(s.prices??0);return{...e,inputValue:c,coinValue:r,fiatValue:d,isMax:!1}}case"price":{if(!s.prices)return e;const o=e.coinValue.multipliedBy(s.prices).decimalPlaces(2,v.ROUND_FLOOR);return{...e,fiatValue:o}}case"toggle":{const o=z(e.inFiat?e.coinValue.decimalPlaces(e.token.decimals,v.ROUND_FLOOR):e.fiatValue?.decimalPlaces(2,v.ROUND_FLOOR)??new v(0));return{...e,inputValue:o,inFiat:!e.inFiat}}default:return e}},He=(e,n)=>{const i=e?.inFiat??!1;return{inputValue:e?.inputValue??z((i?e?.fiatValue:e?.coinValue)||new v(0)),coinValue:e?.coinValue??new v(0),fiatValue:e?.fiatValue,token:e?.token||(n===S.TON?ue:fe),inFiat:i,isMax:e?.isMax??!1}},Mn=e=>e.token.blockchain===S.TRON?e.token.symbol:Me(e.token,{userFriendly:!0}),Fn=({onBack:e,onClose:n,isAnimationProcess:i})=>{const{t:s}=me(),c=Fe()&&i,u=ut(),r=a.useCallback(()=>{n(),u(dt.walletSettings+ft.battery)},[n]);return t.jsxs(Oe,{onSubmit:mt(r),children:[!c&&t.jsx(U,{children:t.jsx(Q,{children:t.jsxs(pt,{children:[t.jsx(ht,{onBack:e}),t.jsx(xt,{handleClose:n})]})})}),t.jsx(Ln,{}),t.jsxs(On,{children:[t.jsx(gt,{children:s("transfer_battery_required_title")}),t.jsx(In,{children:s("transfer_battery_required_description")})]}),!c&&t.jsx(G,{children:t.jsx(J,{children:t.jsx(En,{primary:!0,fullWidth:!0,onClick:r,children:s("transfer_battery_required_button")})})})]})},On=T.div`
    margin-bottom: 24px;
`,In=T(yt)`
    display: block;
    margin-top: 4px;
    color: ${e=>e.theme.textSecondary};
`,En=T(bt)`
    ${e=>e.theme.displayType==="compact"&&Ie`
            position: absolute;
            bottom: 16px;
        `}
`,Dn=T.div`
    display: flex;
    align-items: center;
    margin: 0 auto 16px;
    gap: 12px;

    > img {
        width: 56px;
        height: 56px;
    }

    *:last-child {
        height: 62px;
        width: auto;
    }
`,Ln=()=>t.jsxs(Dn,{children:[t.jsx("img",{src:fe.image}),t.jsx(kt,{}),t.jsx(jt,{})]}),Pn=e=>{const{data:n}=At();return e.recipient.address.blockchain===S.TRON&&(!n||n.batteryUnitsBalance.isZero())?n===void 0?null:t.jsx(Fn,{onBack:()=>e.onBack(He(e.defaults,e.recipient.address.blockchain)),onClose:e.onClose,isAnimationProcess:e.isAnimationProcess}):t.jsx(Wn,{...e})},Wn=({recipient:e,onClose:n,onBack:i,onConfirm:s,defaults:o,MainButton:c,HeaderBlock:u,isAnimationProcess:r})=>{const{t:d}=me(),p=pe(),{standalone:x,fiat:k}=de(),g=e.address.blockchain,j=Fe()&&r,{data:y}=he(),{data:m}=St(),[f,b]=a.useReducer(Nn,He(o,g)),{data:w,isLoading:q}=Tt(Mn(f)),{data:h,isLoading:B}=wt(f.token),C=a.useRef(null),_=a.useRef(null),L=a.useRef(null);Rn(L,_),_n(C,f.token);const[M,K]=a.useState(We);a.useLayoutEffect(()=>{_.current&&K(Cn(f.inputValue,_.current))},[_.current,f.inputValue]),a.useEffect(()=>{b({kind:"price",payload:{prices:w?.prices}})},[b,w]);const Y=a.useCallback(()=>{b({kind:"toggle",payload:void 0})},[]),Z=a.useCallback(R=>{b({kind:"input",payload:{value:R,prices:w?.prices}})},[b,w]),P=a.useCallback(()=>{b({kind:"max",payload:{value:h.relativeAmount,prices:w?.prices}})},[b,h,w]),X=a.useCallback(R=>{y&&b({kind:"select",payload:{token:vt(R,m,y)}})},[b,y]),W=h.relativeAmount.minus(f.coinValue),F=W.gte(0),O=a.useMemo(()=>F&&_e(f.inputValue)&&Ne(f.inputValue).isGreaterThan(0),[F,f.inputValue]),ee=a.useCallback(()=>{i(f)},[i,f]),H=a.useCallback(()=>{O?s(f):p.hapticNotification("error")},[O,s,f,p]),te=async R=>{R.stopPropagation(),R.preventDefault(),H()};return t.jsxs(Oe,{onSubmit:te,standalone:x,children:[!j&&t.jsx(U,{children:t.jsx(Q,{children:t.jsx(u,{onClose:n,onBack:ee,children:t.jsxs(Vt,{children:[d("send_screen_steps_done_to").replace("%{name}",""),t.jsx(Bt,{recipient:e}),t.jsx(Rt,{recipient:e})]})})})}),t.jsxs(Ct,{ref:_,children:[t.jsx(_t,{children:g===S.TON?t.jsx(Bn,{info:m,jetton:Me(f.token),setJetton:X,jettons:y??{balances:[]}}):t.jsx(Nt,{children:t.jsx(D,{children:"TRC20"})})}),t.jsxs(Mt,{children:[t.jsx(Pe,{ref:C,value:f.inputValue,setValue:Z,inputSize:M}),t.jsx(Ft,{children:f.inFiat?k:f.token.symbol})]}),t.jsx(Ot,{amountState:f,toggleFiat:Y})]}),t.jsxs(It,{children:[t.jsx(Et,{maxValue:f.isMax,onClick:P,children:d("send_screen_steps_amount_max")}),F?t.jsxs(Dt,{children:[d("send_screen_steps_amount_remaining").replace("%{amount}",Lt.format(W,{decimals:f.token.decimals}))," ",f.token.symbol]}):t.jsx(Pt,{children:d("send_screen_steps_amount_insufficient_balance")})]}),t.jsx(Wt,{}),!j&&t.jsx(G,{children:t.jsx(J,{children:t.jsx(c,{ref:L,isDisabled:!O,isLoading:q||B,onClick:H})})})]})},Hn={type:"multisig",ttlSeconds:60*5};function $n(e,n,i){const s=Ht(Hn),o=$t(s),c=Ee();return Be(["multisig-transfer-estimation",e,n,i,o],async()=>{const u=await s(),r=e.comment;return c.estimate(u,{to:xe(e.address.address)?e.address.address:e.toAccount.address,amount:n,isMax:i,payload:r?{type:"comment",value:r}:void 0})},{enabled:!!e,refetchOnMount:"always"})}function zn(e,n,i,s,o){const c=Ee(),u=zt(),r=Ut(),d=Qt(),{mutateAsync:p}=Gt();return Jt(async()=>{try{const x=Number(s)*60,k=await r({type:"multisig",ttlSeconds:x}),g=e.comment;await c.send(k,o,{to:xe(e.address.address)?e.address.address:e.toAccount.address,amount:n,isMax:i,payload:g?{type:"comment",value:g}:void 0}),n.asset.id===ue.id?d("send-ton"):d("send-jetton")}catch(x){await u(x)}return await p(),!0})}const Un=T(Zt)`
    margin-bottom: 1rem;
`,Qn=({isMax:e,ttl:n,children:i,...s})=>{const{signerWallet:o}=qt(),{data:c}=Kt(),u=$n(s.recipient,s.assetAmount,e),r=zn(s.recipient,s.assetAmount,e,n,u.data);return t.jsxs(Re,{estimation:u,...r,...s,children:[i,t.jsx(Yt,{children:c?t.jsx(Un,{status:"progress",signedWallets:[],threshold:c.threshold,pendingWallets:c.signers,hostAddress:o.rawAddress,secondsLeft:Number(n)*60}):null})]})},Gn=({onClose:e,chain:n,initRecipient:i,initAmountState:s})=>{const o=pe(),{standalone:c,ios:u,extension:r}=de(),{t:d}=me(),{data:p}=he(),x=sn(),k=Le(),[g,V]=a.useState(x?"multisig-settings":"recipient"),j=a.useCallback(l=>{!x&&l==="multisig-settings"&&(l="recipient"),V(l)},[V,x]),[y,m]=a.useState(!0),[f,b]=a.useState(),[w,q]=a.useState(i),[h,B]=a.useState(s);a.useEffect(()=>{i&&k("send_click",{from:"send_amount",token:h?.token?.symbol??"ton"})},[]);const C=an(),{mutateAsync:_,isLoading:L}=De(),M=l=>{h?.token?.blockchain&&h?.token?.blockchain!==l.address.blockchain&&B(void 0),q(l),C&&l.address.blockchain===S.TRON&&B({token:fe})},K=l=>{m(!0),M(l),j("amount"),k("send_click",{from:"send_recipient",token:h?.token?.symbol??"ton"})},Y=l=>{m(!0),B(l),j("confirm"),k("send_confirm",{from:"send_amount",token:h?.token?.symbol??"ton"})},Z=l=>{m(!1),B(l),j("recipient")},P=()=>{u&&jn("decimal"),m(!1),j("amount")},X=l=>{if(!C)return;const A={address:l,blockchain:S.TRON};M({address:A,done:!0}),j("amount")},W=async({address:l,text:A})=>{const N={address:l,blockchain:S.TON},I=await _(N),ke=I.memoRequired?!!(I.memoRequired&&A):!0;M({address:N,toAccount:I,comment:A??"",done:ke})},F=a.useCallback(async({amount:l,jetton:A})=>{if(A&&p){let N;try{N=on(A,p)}catch{return o.uiEvents.emit("copy",{method:"copy",params:d("Unexpected_QR_Code")}),!1}const I=new E({asset:N,weiAmount:l||"0"});B({coinValue:I.relativeAmount,token:N,inFiat:!1,isMax:!1})}else B({coinValue:l?Ce(l):new v("0"),token:s?.token,inFiat:!1,isMax:!1});return!0},[o,p,s?.token]),O=async l=>{const A=gn({url:l});if(A){await F(A)&&await W(A);return}return kn(l)?X(l):o.uiEvents.emit("copy",{method:"copy",params:d("Unexpected_QR_Code")})},ee=a.useRef(null),H=a.useRef(null),te=a.useRef(null),R=a.useRef(null),ge={"multisig-settings":ee,recipient:H,amount:te,confirm:R}[g],$e=a.useMemo(()=>!h?.token||!h?.coinValue?null:E.fromRelativeAmount({asset:h.token,amount:h.coinValue}),[h?.token?.id,h?.coinValue]);let $=[];return n?n===S.TRON&&!C?$=[S.TON]:$=[n]:$=C?[S.TON,S.TRON]:[S.TON],t.jsx(rn,{standalone:c,extension:r,children:t.jsx(bn,{childFactory:cn(y),children:t.jsx(ln,{nodeRef:ge,classNames:"right-to-left",addEndListener:l=>{setTimeout(l,xn)},children:l=>t.jsxs("div",{ref:ge,children:[g==="multisig-settings"&&t.jsx(un,{onSubmit:A=>{m(!0),b(A.lifetime),j("recipient")},isAnimationProcess:l==="exiting",header:t.jsx(dn,{title:d("multisig_create_order_title"),onClose:e}),MainButton:Ae}),g==="recipient"&&t.jsx(fn,{data:w,setRecipient:K,onScan:O,keyboard:"decimal",isExternalLoading:L,acceptBlockchains:$,MainButton:Ae,HeaderBlock:()=>t.jsx(mn,{onBack:x?()=>{m(!1),j("multisig-settings")}:void 0,title:d("transaction_recipient"),onClose:e}),isAnimationProcess:l==="exiting"}),g==="amount"&&t.jsx(Pn,{defaults:h,onClose:e,onBack:Z,recipient:w,onConfirm:Y,MainButton:hn,HeaderBlock:pn,isAnimationProcess:l==="exiting"}),g==="confirm"&&(x?t.jsxs(Qn,{onClose:e,onBack:P,recipient:w,assetAmount:E.fromRelativeAmount({asset:h.token,amount:h.coinValue}),isMax:h.isMax,ttl:f,children:[t.jsx(Se,{children:l!=="exiting"&&t.jsx(U,{children:t.jsx(Q,{children:t.jsx(Te,{})})})}),t.jsx(we,{children:l!=="exiting"&&t.jsx(G,{children:t.jsx(J,{children:t.jsx(ve,{MainButton:Ve})})})})]}):t.jsxs(Sn,{onClose:e,onBack:P,recipient:w,assetAmount:$e,isMax:h.isMax,children:[t.jsx(Se,{children:l!=="exiting"&&t.jsx(U,{children:t.jsx(Q,{children:t.jsx(Te,{})})})}),t.jsx(we,{children:l!=="exiting"&&t.jsx(G,{children:t.jsx(J,{children:t.jsx(ve,{MainButton:Ve})})})})]}))]})},g)})})},Jn=T(yn)`
    ${e=>e.theme.proDisplayType==="mobile"&&Ie`
            --height: calc(100% - (env(safe-area-inset-top) + 10px));
        `}
`,Yn=()=>{const[e,n]=a.useState(!1),[i,s]=a.useState(void 0),[o,c]=a.useState(void 0),{data:u}=he(),r=Xt(),{mutateAsync:d,reset:p}=De(),x=pe(),k=Le();a.useEffect(()=>{const j=y=>{p();const m=y.params;if(s(y.params.chain),m.chain===S.TRON){c(en(m)),n(!0),k("send_open",{from:m.from});return}d({address:r.rawAddress}).then(f=>{m.address&&xe(m.address)?d({address:m.address}).then(b=>{c(tn(m,f,b,u)),n(!0)}):(c({initAmountState:nn(m,f,u)}),n(!0))}),k("send_open",{from:m.from})};return x.uiEvents.on("transfer",j),()=>{x.uiEvents.off("transfer",j)}},[u,k]);const g=a.useCallback(()=>{c(void 0),n(!1)},[]),V=a.useCallback(()=>t.jsx(Gn,{onClose:g,chain:i,initAmountState:o?.initAmountState,initRecipient:o?.initRecipient}),[e,o,i]);return t.jsx(Jn,{isOpen:e,handleClose:g,hideButton:!0,backShadow:!0,footer:t.jsx(t.Fragment,{}),mobileFullScreen:!0,children:V})};export{Yn as default};
