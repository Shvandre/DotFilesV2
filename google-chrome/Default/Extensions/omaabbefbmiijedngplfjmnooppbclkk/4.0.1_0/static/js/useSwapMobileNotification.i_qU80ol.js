import{cy as O,gN as I,bK as k,gv as y,eS as v,bQ as $,gu as f,r as b,cd as d,c9 as H,b8 as j,b9 as F,c7 as R,c0 as _,b$ as L,k as U,a9 as J}from"./main.BJ1Zz46B.js";function D(t,e){if(t&&t===e)return!0;try{return e?(typeof t=="string"&&(t=O.Address.parse(t)),typeof e=="string"&&(e=O.Address.parse(e)),t.equals(e)):!1}catch{return!1}}class C extends Error{url;status;statusText;body;request;constructor(e,n,r){super(r),this.name="ApiError",this.url=n.url,this.status=n.status,this.statusText=n.statusText,this.body=n.body,this.request=e}}class W extends Error{constructor(e){super(e),this.name="CancelError"}get isCancelled(){return!0}}class K{#t;#s;#e;#r;#a;#o;#n;constructor(e){this.#t=!1,this.#s=!1,this.#e=!1,this.#r=[],this.#a=new Promise((n,r)=>{this.#o=n,this.#n=r;const s=i=>{this.#t||this.#s||this.#e||(this.#t=!0,this.#o&&this.#o(i))},a=i=>{this.#t||this.#s||this.#e||(this.#s=!0,this.#n&&this.#n(i))},o=i=>{this.#t||this.#s||this.#e||this.#r.push(i)};return Object.defineProperty(o,"isResolved",{get:()=>this.#t}),Object.defineProperty(o,"isRejected",{get:()=>this.#s}),Object.defineProperty(o,"isCancelled",{get:()=>this.#e}),e(s,a,o)})}get[Symbol.toStringTag](){return"Cancellable Promise"}then(e,n){return this.#a.then(e,n)}catch(e){return this.#a.catch(e)}finally(e){return this.#a.finally(e)}cancel(){if(!(this.#t||this.#s||this.#e)){if(this.#e=!0,this.#r.length)try{for(const e of this.#r)e()}catch(e){console.warn("Cancellation threw an error",e);return}this.#r.length=0,this.#n&&this.#n(new W("Request aborted"))}}get isCancelled(){return this.#e}}const l={BASE:"",VERSION:"1.0.0",WITH_CREDENTIALS:!1,CREDENTIALS:"include",TOKEN:void 0,USERNAME:void 0,PASSWORD:void 0,HEADERS:void 0,ENCODE_PATH:void 0},g=t=>t!=null,m=t=>typeof t=="string",A=t=>m(t)&&t!=="",T=t=>typeof t=="object"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.arrayBuffer=="function"&&typeof t.constructor=="function"&&typeof t.constructor.name=="string"&&/^(Blob|File)$/.test(t.constructor.name)&&/^(Blob|File)$/.test(t[Symbol.toStringTag]),P=t=>t instanceof FormData,M=t=>{try{return btoa(t)}catch{return I.Buffer.from(t).toString("base64")}},V=t=>{const e=[],n=(s,a)=>{e.push(`${encodeURIComponent(s)}=${encodeURIComponent(String(a))}`)},r=(s,a)=>{g(a)&&(Array.isArray(a)?a.forEach(o=>{r(s,o)}):typeof a=="object"?Object.entries(a).forEach(([o,i])=>{r(`${s}[${o}]`,i)}):n(s,a))};return Object.entries(t).forEach(([s,a])=>{r(s,a)}),e.length>0?`?${e.join("&")}`:""},Q=(t,e)=>{const n=encodeURI,r=e.url.replace("{api-version}",t.VERSION).replace(/{(.*?)}/g,(a,o)=>e.path?.hasOwnProperty(o)?n(String(e.path[o])):a),s=`${t.BASE}${r}`;return e.query?`${s}${V(e.query)}`:s},z=t=>{if(t.formData){const e=new FormData,n=(r,s)=>{m(s)||T(s)?e.append(r,s):e.append(r,JSON.stringify(s))};return Object.entries(t.formData).filter(([r,s])=>g(s)).forEach(([r,s])=>{Array.isArray(s)?s.forEach(a=>n(r,a)):n(r,s)}),e}},S=async(t,e)=>e,Y=async(t,e)=>{const[n,r,s,a]=await Promise.all([S(e,t.TOKEN),S(e,t.USERNAME),S(e,t.PASSWORD),S(e,t.HEADERS)]),o=Object.entries({Accept:"application/json",...a,...e.headers}).filter(([i,c])=>g(c)).reduce((i,[c,u])=>({...i,[c]:String(u)}),{});if(A(n)&&(o.Authorization=`Bearer ${n}`),A(r)&&A(s)){const i=M(`${r}:${s}`);o.Authorization=`Basic ${i}`}return e.body!==void 0&&(e.mediaType?o["Content-Type"]=e.mediaType:T(e.body)?o["Content-Type"]=e.body.type||"application/octet-stream":m(e.body)?o["Content-Type"]="text/plain":P(e.body)||(o["Content-Type"]="application/json")),new Headers(o)},Z=t=>{if(t.body!==void 0)return t.mediaType?.includes("/json")?JSON.stringify(t.body):m(t.body)||T(t.body)||P(t.body)?t.body:JSON.stringify(t.body)},X=async(t,e,n,r,s,a,o)=>{const i=new AbortController,c={headers:a,body:r??s,method:e.method,signal:i.signal};return o(()=>i.abort()),await fetch(n,c)},ee=(t,e)=>{if(e){const n=t.headers.get(e);if(m(n))return n}},te=async t=>{if(t.status!==204)try{const e=t.headers.get("Content-Type");if(e)return["application/json","application/problem+json"].some(s=>e.toLowerCase().startsWith(s))?await t.json():await t.text()}catch(e){console.error(e)}},se=(t,e)=>{const r={400:"Bad Request",401:"Unauthorized",403:"Forbidden",404:"Not Found",500:"Internal Server Error",502:"Bad Gateway",503:"Service Unavailable",...t.errors}[e.status];if(r)throw new C(t,e,r);if(!e.ok){const s=e.status??"unknown",a=e.statusText??"unknown",o=(()=>{try{return JSON.stringify(e.body,null,2)}catch{return}})();throw new C(t,e,`Generic Error: status: ${s}; status text: ${a}; body: ${o}`)}},w=(t,e)=>new K(async(n,r,s)=>{try{const a=Q(t,e),o=z(e),i=Z(e),c=await Y(t,e);if(!s.isCancelled){const u=await X(t,e,a,i,o,c,s),q=await te(u),G=ee(u,e.responseHeader),E={url:a,ok:u.ok,status:u.status,statusText:u.statusText,body:G??q};se(e,E),n(E.body)}}catch(a){r(a)}});class re{static calculateSwap(e,n,r,s){return w(l,{method:"GET",url:"/v2/swap/calculate",query:{fromAsset:e,toAsset:n,fromAmount:r,provider:s},errors:{500:"Default Response"}})}static encodeSwap(e){return w(l,{method:"POST",url:"/v2/swap/encode",body:e,mediaType:"application/json",errors:{500:"Default Response"}})}static swapGas(){return w(l,{method:"GET",url:"/v2/swap/gas",errors:{500:"Default Response"}})}static swapAssets(){return w(l,{method:"GET",url:"/v2/swap/assets",errors:{500:"Default Response"}})}}const x=()=>{const t=k();return l.BASE=t.web_swaps_url,{swapService:re,referralAddress:t.web_swaps_referral_address,isSwapsEnabled:!!t.web_swaps_url}},p=y($),h=y(v),ne=y(new d(1)),B=()=>{const[t,e]=f(p),[n,r]=f(h),s=b.useCallback(a=>{D(a.address,h.value.address)&&r(p.value),e(a)},[e,r]);return[t,s]},ae=()=>{const[t,e]=f(h),[n,r]=f(p),s=b.useCallback(a=>{D(a.address,p.value.address)&&r(h.value),e(a)},[e,r]);return[t,s]},oe=()=>f(ne),pe=()=>{const{data:e,isError:n}=ie(),[r]=B(),s=H(r);return j({queryKey:[F.swapMaxValue,e,r.id,s?.toFixed(0)],queryFn:async()=>{if(n)return s;if(!(!s||!e))if(r.id===$.id){const a=new d(e.dedust.tonToJetton),o=new d(e.stonfi.tonToJetton),i=s.minus(d.max(a,o)).minus(1e6);return i.lt(0)?new d(0):i}else return s},enabled:(!!e||n)&&s!==void 0})},ie=()=>{const{swapService:t}=x();return j({queryKey:[F.swapGasConfig],queryFn:async()=>t.swapGas()})},ce=y(void 0),ue=()=>f(ce),he=()=>{const[t]=B(),[e]=ae(),[n]=ue(),{data:r,isLoading:s}=R(_(t.address)),{data:a,isLoading:o}=R(_(e.address)),i=n?.trade;if(!i||o||s)return;if(!r?.prices||!a?.prices)return null;const c=new d(i.from.relativeAmount).multipliedBy(r.prices),u=new d(i.to.relativeAmount).multipliedBy(a.prices);return c.isEqualTo(u)?new d(0):c.minus(u).dividedBy(c)},ye=t=>t?t.isGreaterThan(.05)?"high":t.isGreaterThan(.01)?"medium":"low":"unknown",me=()=>{const[t]=oe();return!t||t.isZero()},de=(t,e,n,r)=>{const s=new URL("https://app.ston.fi/swap");return s.searchParams.append("ft",N(t)),s.searchParams.append("tt",N(e)),s.searchParams.append("referral_address",r||""),s.searchParams.append("utm_source",`tokeeper-${n}`),s.searchParams.append("utm_medium","organic"),s.searchParams.append("utm_campaign","swap_button"),s.searchParams.append("utm_content","TODO"),s.toString()},N=t=>L(t)?"ton":t.toString({urlSafe:!0}),fe=y(!1),Se=()=>{const[t,e]=f(fe),{isSwapsEnabled:n}=x(),r=U(),{tonendpoint:s,env:a}=J(),o=b.useCallback(i=>{if(i&&!n){const c=de(p.value.address,h.value.address,s.targetEnv,a?.stonfiReferralAddress);r.openPage(c)}else e(i)},[e,n,r,s.targetEnv,a?.stonfiReferralAddress]);return[t,o]};export{B as a,x as b,ae as c,oe as d,D as e,ue as f,me as g,pe as h,he as i,ye as p,Se as u};
