import{b8 as A,b9 as f,k as b,av as c,r as k,e2 as y,cy as u,gu as h,gv as O,gK as N,c7 as _,dI as U,a9 as T,bb as q,bx as v,al as W,aa as E,c0 as F,bS as l,bR as w,b$ as M,eT as p,ca as S,cd as i,gx as K,aN as x,gL as I}from"./main.BJ1Zz46B.js";import{b as j}from"./useSwapMobileNotification.i_qU80ol.js";function B(){const{swapService:s}=j(),{data:a}=Q();return A({queryKey:[f.swapAllAssets,a],queryFn:async()=>{try{return(await s.swapAssets()).map(n=>{const t=n.address==="ton"?"TON":u.Address.parse(n.address);return{id:w(l.TON,t),symbol:n.symbol,decimals:n.decimals,name:n.name,image:n.image,blockchain:l.TON,address:t}}).filter(n=>!(a||[]).some(t=>t.id===n.id)).concat(a||[])}catch(e){return console.error(e),[]}},enabled:!!a})}const P=O("");function C(){return h(P)}function J(){const[s]=N(),{data:a}=B(),{data:e}=_(U.TON),{fiat:o}=T();return A({queryKey:[f.swapWalletAssets,a,s,e,o],queryFn:async()=>{if(!s||!a||!e)return[];const n=a.map(t=>{if(M(t.address))return{assetAmount:new S({asset:t,weiAmount:s.ton.info.balance}),fiatAmount:p(new i(s.ton.info.balance)).multipliedBy(e.prices)};const r=s.ton.jettons.balances.find(d=>u.Address.parse(d.jetton.address).equals(t.address));return{assetAmount:new S({asset:t,weiAmount:r?.balance||0}),fiatAmount:p(new i(r?.balance||0),t.decimals).multipliedBy(new i(r?.price?.prices?.[o]||0))}});return n.sort((t,r)=>t.fiatAmount.isZero()&&r.fiatAmount.isZero()?r.assetAmount.weiAmount.comparedTo(t.assetAmount.weiAmount):r.fiatAmount.comparedTo(t.fiatAmount)),n},enabled:!!s&&!!a&&!!e})}const z=()=>{const[s]=C(),{data:a}=J();return k.useMemo(()=>{if(a)return a.filter(e=>{if(!s)return!0;if(y(s))return u.Address.parse(s).equals(e.assetAmount.asset.address);const o=s.toUpperCase();if(e.assetAmount.asset.symbol.toUpperCase().includes(o)||e.assetAmount.asset.name?.toUpperCase().includes(o))return!0})},[s,a])},D=()=>{const[s]=C(),a=y(s),{fiat:e}=T(),o=q(),{data:n}=v();return A({queryKey:[f.swapCustomToken,s,n,e],queryFn:async()=>{if(!a)return null;try{const t=u.Address.parse(s),r=await new K(o.tonApiV2).getJettonInfo({accountId:t.toRawString()}),d={address:t,image:r.preview,blockchain:l.TON,name:r.metadata.name,symbol:r.metadata.symbol,decimals:Number(r.metadata.decimals),id:w(l.TON,t),verification:r.verification},m=n?.balances.find(g=>u.Address.parse(g.jetton.address).equals(t));return{assetAmount:new S({asset:d,weiAmount:m?.balance||new i(0)}),fiatAmount:p(new i(m?.balance||0),d.decimals).multipliedBy(new i(m?.price?.prices?.[e]||0))}}catch(t){return console.error(t),null}},enabled:a&&!!n})},Q=()=>{const s=b();return A([c.SWAP_CUSTOM_ASSETS],async()=>(await s.storage.get(c.SWAP_CUSTOM_ASSETS))?.map(e=>({...e,blockchain:e.blockchain,address:I(e.address),id:w(e.blockchain,e.address),verification:x.Whitelist}))||[])},Z=()=>{const s=b(),a=W();return E(async e=>{const o=await s.storage.get(c.SWAP_CUSTOM_ASSETS)||[];await s.storage.set(c.SWAP_CUSTOM_ASSETS,[...o,{...e,address:F(e.address)}]),await a.invalidateQueries([c.SWAP_CUSTOM_ASSETS])})};export{C as a,D as b,Z as c,z as d,B as u};
