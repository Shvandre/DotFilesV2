import{c as Et,f as Mt,j as Ct,k as It,l as et,n as Ft,p as f,r as Bt,t as x,v as ot,w as lt,y as Rt}from"./chunk-4AX42N6B.js";import{R as Lt,fa as Nt}from"./chunk-XNDOEJ4N.js";import{Dc as pt,Ed as xt,Id as Ut,Jb as wt,ld as Z,od as qt,wd as tt}from"./chunk-HKKBRKQE.js";import{$b as Pt,H as At,I as bt,L as y,Ya as q,_a as Tt,eb as J,ne as X}from"./chunk-3GZCHS7Y.js";import{i as C,l as I}from"./chunk-SK6BTSEQ.js";import{d as b}from"./chunk-BY5XXL4W.js";import{A as mt,P as $}from"./chunk-WP4K54AS.js";import{C as _,u as V,w as ht,z as g}from"./chunk-UCPKAIVR.js";import{V as Q,W as h,Y as O,Z as kt,ba as yt,ca as N,da as vt,u as Y}from"./chunk-NL7NWYRL.js";import{a as w,h as W}from"./chunk-57IY32VM.js";import{f as P,h as r,m as Buffer,n as a}from"./chunk-3KENBVE7.js";r();a();r();a();var Vt=({numSignatures:t,lamportsPerSignature:e,lamportBalance:o,rentExemptionMinimum:n})=>{let i=Q(e).multipliedBy(t),s=o.minus(i);return Q.max(s.minus(n),0)};var qe=({balance:t,rentExemptionMinimum:e})=>{let o=Vt({numSignatures:11,lamportsPerSignature:wt,lamportBalance:Q(t),rentExemptionMinimum:bt(e)});return parseFloat(At(o).toFixed(9))};r();a();r();a();var xe="https://keybase.io/_/api/1.0/user/pic_url.json",nt=async t=>{let e=await C.get(`${xe}?username=${encodeURIComponent(t)}`);if(!I(e)||e.data.status?.code!==0)throw new Error("Couldn't fetch keybase user avatar");return e.data.pic_url};var Ue=t=>{let e=f.keybaseUserAvatar(t);return g({enabled:!!t,queryKey:e,async queryFn(){if(!t)throw new Error("Keybase username is required");return nt(t)},placeholderData:"",staleTime:1/0})};r();a();r();a();var qo=new Error("Missing sender address for staking fungibles."),Dt=new Error("Missing signature from waiting for staking transaction confirmation."),Qt=new Error("PublicKey is required");var Kt=class extends Error{constructor(e){super(e)}};var Le=async(t,e)=>await t.getSignatureStatuses([e],{searchTransactionHistory:!0});function Ee(t,e,o){let n=V(),i=f.signatureStatus(o),s=async()=>{if(!o)throw Dt;let c=await Le(t,o);return{...c,value:c.value[0]}},p=n.getQueryData(i)?.value?.confirmationStatus;return g({queryKey:i,queryFn:s,enabled:!!o&&p!=="finalized",refetchInterval:e,staleTime:1/0})}r();a();var Me=t=>async()=>await t.getMinimumBalanceForRentExemption(y.StakeProgram.space);function Ce(t){let e=f.stakeAccountMinBalance(),o=Me(t);return g({queryKey:e,queryFn:o,placeholderData:0,staleTime:1/0})}r();a();var Fe=async(t,e,o,n="confirmed")=>await t.getInflationReward(e,o,n),Be=async(t,e)=>{let o=[];e.ownerPublicKey&&o.push({memcmp:{offset:44,bytes:e.ownerPublicKey}}),e.voteAccountPublicKey&&o.push({dataSize:200},{memcmp:{offset:124,bytes:e.voteAccountPublicKey}});let n=await t.getParsedProgramAccounts(y.StakeProgram.programId,{filters:o}),i=[];if(e.fetchInflationRewards)try{i=await Fe(t,n.map(({pubkey:s})=>s))}catch(s){let u=s;!u.message.includes("RPC request timed out")&&_.captureError(u,"staking")}return n.map((s,u)=>({pubkey:s.pubkey.toString(),lamports:s.account.lamports,inflationReward:i[u]?.amount,...s.account.data.parsed}))},Re=(t,e)=>f.stakeAccounts(t,e),Ne=(t,e)=>()=>Be(t,{ownerPublicKey:e,fetchInflationRewards:!0});function Ve(t,e){let o=Re(e,t.rpcEndpoint),n=Ne(t,e);return g({queryKey:o,queryFn:n,placeholderData:[],staleTime:1/0})}r();a();r();a();r();a();r();a();function rt(t,e){for(let o of e)if(o.epoch===t)return o;return null}var Ot=.09;function Ke(t,e,o){if(t.activationEpoch===t.deactivationEpoch)return{effective:BigInt(0),activating:BigInt(0)};if(e===t.activationEpoch)return{effective:BigInt(0),activating:t.stake};if(e<t.activationEpoch)return{effective:BigInt(0),activating:BigInt(0)};let n=t.activationEpoch,i=rt(n,o);if(i!==null){let s=BigInt(0);for(;i!==null;){n++;let u=t.stake-s,p=Number(u)/Number(i.activating),l=Number(i.effective)*Ot,c=BigInt(Math.max(1,Math.round(p*l)));if(s+=c,s>=t.stake){s=t.stake;break}if(n>=e||n>=t.deactivationEpoch)break;i=rt(n,o)}return{effective:s,activating:t.stake-s}}else return{effective:t.stake,activating:BigInt(0)}}function _t(t,e,o){let{effective:n,activating:i}=Ke(t,e,o);if(e<t.deactivationEpoch)return{effective:n,activating:i,deactivating:BigInt(0)};if(e==t.deactivationEpoch)return{effective:n,activating:BigInt(0),deactivating:n};let s=t.deactivationEpoch,u=rt(s,o);if(u!==null){let p=n;for(;u!==null&&(s++,u.deactivating!==BigInt(0));){let l=Number(p)/Number(u.deactivating),c=Number(u.effective)*Ot,S=BigInt(Math.max(1,Math.round(l*c)));if(p-=S,p<=0){p=BigInt(0);break}if(s>=e)break;u=rt(s,o)}return{effective:p,deactivating:p,activating:BigInt(0)}}else return{effective:BigInt(0),activating:BigInt(0),deactivating:BigInt(0)}}r();a();var Ht=function(t){if(t.value===null||t.value.data instanceof Buffer)throw new Error("Account not found");let e=[];return t.value.data.parsed.info.forEach(o=>{e.push({epoch:BigInt(o.epoch),effective:BigInt(o.stakeHistory.effective),activating:BigInt(o.stakeHistory.activating),deactivating:BigInt(o.stakeHistory.deactivating)})}),e},Gt=function(t){let e=BigInt(0);if(t.value===null||t.value.data instanceof Buffer)throw new Error("Account not found");return t.value.data.parsed.type==="delegated"&&(e=BigInt(1)),{discriminant:e,meta:{rentExemptReserve:BigInt(t.value.data.parsed.info.meta.rentExemptReserve),authorized:{staker:t.value.data.parsed.info.meta.authorized.staker,withdrawer:t.value.data.parsed.info.meta.authorized.withdrawer},lockup:{unixTimestamp:BigInt(t.value.data.parsed.info.meta.lockup.unixTimestamp),epoch:BigInt(t.value.data.parsed.info.meta.lockup.epoch),custodian:t.value.data.parsed.info.meta.lockup.custodian}},stake:{delegation:{voterPubkey:t.value.data.parsed.info.stake.delegation.voterPubkey,stake:BigInt(t.value.data.parsed.info.stake.delegation.stake),activationEpoch:BigInt(t.value.data.parsed.info.stake.delegation.activationEpoch),deactivationEpoch:BigInt(t.value.data.parsed.info.stake.delegation.deactivationEpoch)},creditsObserved:BigInt(t.value.data.parsed.info.stake.creditsObserved)}}};async function H(t,e){let o=new y.PublicKey("SysvarStakeHistory1111111111111111111111111"),n=await t.getParsedAccountInfo(e);if(n===null||n.value===null)throw new Error("Account not found");let i=await t.getParsedAccountInfo(o);if(i===null)throw new Error("StakeHistory not found");let s=Ht(i),u=await t.getEpochInfo(),p=Gt(n),{effective:l,activating:c,deactivating:S}=_t(p.stake.delegation,BigInt(u.epoch),s),d;S>0?d="deactivating":c>0?d="activating":l>0?d="active":d="inactive";let A=BigInt(n.value.lamports)-l-p.meta.rentExemptReserve;return{state:d,active:Number(l),inactive:Number(A)}}function De(t,e){let o=f.stakeActivationData(e);return g({queryKey:o,queryFn:async()=>{if(!e)throw Qt;return await H(t,new y.PublicKey(e))},enabled:!!e,staleTime:1/0})}r();a();r();a();var jt=new Error("Failed to fetch staking APY");async function zt(){try{let t=await C.api().get("/staking/v1/apy");if(!I(t))throw jt;let e=t.data;return et.parse(e).apy}catch{throw jt}}var Qe=()=>{let t=f.stakeApy();return g({enabled:!0,queryKey:t,gcTime:ot.Short,staleTime:1/0,async queryFn(){return zt()}})};r();a();r();a();var G=P(w());r();a();r();a();var Wt=new Error("Failed to fetch Average Validator APY");async function Yt(){let t=await C.api().get("/staking/v1/avg-validator-apy");if(!I(t))throw Wt;let e=et.safeParse(t.data);if(e.success)return e.data.apy;throw Wt}var $t=()=>{let t=f.averageValidatorApy();return g({enabled:!0,queryKey:t,gcTime:Y({hours:1}),staleTime:1/0,async queryFn(){return Yt()}})};r();a();r();a();var Jt=new Error("Failed to fetch liquid staking supported tokens"),Oe=new Error("Missing supported tokens in response");async function Xt(){try{let t=await C.api().get("/liquid-staking/v1/supported-tokens");if(!I(t))throw Jt;let e=Ft.safeParse(t.data.supportedTokens);if(!e.success)throw Oe;return e.data}catch{throw Jt}}var at=()=>{let t=f.liquidStakingSupportedTokens();return g({queryKey:t,staleTime:Y({minutes:15}),async queryFn(){return await Xt()}})};var Zt=t=>{let e=x(k=>k.provider),o=x(k=>k.setProvider),n=x(k=>k.setFungibleToStake),i=x(k=>k.setSkipDismissRouting),s=(0,G.useMemo)(()=>t?J(Z(t)):"",[t]),{data:u,isPending:p}=$t(),l=u?u/100:null,{data:c={},isPending:S}=at(),d=(0,G.useMemo)(()=>c[s]??[],[s,c]),A=d?d[0]:void 0,U=(0,G.useCallback)((k,M)=>{if(!t||!A)return;let L=d.find(F=>F.stakePoolTokenMetadata.caip19===M);if(M){L&&(o(L),n(t),i(k));return}o(A),n(t),i(k)},[t,A,n,o,i,d]);return{isLoading:S||p,isSupported:d.length>0,providers:d,initLiquidStake:U,defaultProvider:A,avgValidatorApy:l,activeProvider:e}};var j=t=>{let e=Et.get(t);return Zt(e)};r();a();var te=P(w());var _e=({onLiquidStake:t,onNativeStake:e})=>{let o=Mt,{avgValidatorApy:n,activeProvider:i}=j(Tt.Solana.Mainnet);return{options:(0,te.useMemo)(()=>[{type:"liquid",isRecommended:!0,title:b.t("stakeMethodSelectionLiquidStakingTitle"),description:b.t("stakeMethodSelectionLiquidStakingDescription",{poolTokenSymbol:i?.stakePoolTokenMetadata?.metadata?.symbol}),apy:i?b.t("stakeMethodEstApy",{apy:O(parseFloat(i.apy))}):null,onClick:t??(()=>{})},{type:"native",isRecommended:!1,title:b.t("stakeMethodSelectionNativeStakingTitle"),description:b.t("stakeMethodSelectionNativeStakingDescription"),apy:n?b.t("stakeMethodEstApy",{apy:O(n)}):null,onClick:e}],[n,i,t,e]),learnMoreLink:o}};r();a();r();a();var K=P(w());r();a();var ee=P(w());var He=t=>{let e=[];return t.ownerPublicKey&&e.push({memcmp:{offset:44,bytes:t.ownerPublicKey}}),t.voteAccountPublicKey&&e.push({dataSize:200},{memcmp:{offset:124,bytes:t.voteAccountPublicKey}}),e},oe=async(t,e,o)=>{let n=He(e),i=await t.getParsedProgramAccounts(y.StakeProgram.programId,{filters:n}),u=(await Promise.allSettled(i.map(c=>H(t,c.pubkey)))).map(c=>{if(c.status==="fulfilled")return c.value.state}),l=(await Promise.allSettled(i.map(c=>{let S=c.account.data?.parsed?.info?.stake?.delegation?.voter,d=o.get(S),A=d?.info?.keybaseUsername,U=d?.info?.iconUrl;return U?new Promise(k=>k(U)):A?nt(A):new Promise(k=>k(null))}))).map(c=>{if(c.status==="fulfilled"&&c.value!==null)return c.value});return i.map((c,S)=>({pubkey:c.pubkey.toString(),lamports:c.account.lamports,activationState:u[S],imageUri:l[S],...c.account.data.parsed}))},ne=(t,e)=>f.convertStakeAccountList(t,e),Ge=(t,e,o)=>()=>oe(t,{ownerPublicKey:e},o);function re(t,e,o,n=!0){let i=ne(e,t.rpcEndpoint),s=Ge(t,e,o);return g({queryKey:i,queryFn:s,enabled:!!e&&n,staleTime:1/0})}var Ir=(t,e,o,n)=>{let i=V();return(0,ee.useCallback)(async()=>{n&&await i.prefetchQuery({queryKey:ne(e,t.rpcEndpoint),queryFn:()=>oe(t,{ownerPublicKey:e},o)})},[i,e,t,o,n])};var je=t=>{let{data:[e]}=$(["kill-liquid-staking-convert"]),o=t?.validators,n=(0,K.useMemo)(()=>o?new Map(o.map(v=>[v.vote_account,v])):new Map,[o]),{connection:i}=pt(),{data:s}=X("solana"),{results:u,isFetched:p,isError:l}=lt(i),c=(0,K.useMemo)(()=>new Map(u.map(v=>[v.voteAccountPubkey,v])),[u]),{data:S,isLoading:d,isFetching:A,error:U,refetch:k}=re(i,s?.address??"",c,p||l),M=d||A,L=(0,K.useMemo)(()=>M||!S?[]:S.map(v=>ze(v,c,n)).sort((v,ut)=>v.lamports>ut.lamports?-1:1),[M,S,c,n]),F=(0,K.useMemo)(()=>L.filter(v=>v.eligible),[L]),D=(0,K.useMemo)(()=>L.filter(v=>!v.eligible),[L]);return t?.stakePoolTokenMetadata.caip19===tt?{hasConvertibleStakeAccounts:!1,eligibleStakeAccounts:[],inelegibleStakeAccounts:[],isLoadingList:!1,error:null,refetch:()=>{}}:{hasConvertibleStakeAccounts:!e&&F.length>0,eligibleStakeAccounts:F,inelegibleStakeAccounts:D,isLoadingList:M,error:U,refetch:k}},ze=(t,e,o)=>{let n=Rt(t,o),i=We(t,e),s=t.lamports;return{...t,amount:s,eligible:n,title:i,imageUri:t.imageUri}},We=(t,e)=>{let o="";if(t.type==="delegated"){let{voter:n}=t.info.stake.delegation,i=e.get(n),s=i?.info?.keybaseUsername;o=i?.info?.name??s??Pt(n)}else t.type==="initialized"&&(o=t.pubkey);return o};r();a();var ie=P(w());function Ye(t){return typeof t=="string"?t:t?J(Z(t)):""}var $e=t=>{let e=Ye(t),{data:[o]}=$(["enable-psol-staking"]),{data:n={}}=at(),i=(0,ie.useMemo)(()=>!!Object.values(n).flat().find(u=>u.stakePoolTokenMetadata.caip19===e),[e,n]);return e===tt?o&&i:i};r();a();var me=P(w());r();a();var it=P(w());r();a();function se({key:t,queryKey:e,defaultValue:o=null}){let n=mt();return g({enabled:!0,queryKey:e,gcTime:ot.Long,staleTime:1/0,async queryFn(){try{return await n.get(t)}catch(i){return i instanceof Error&&_.captureError(i,"staking"),o}}})}function ue({key:t,queryKey:e}){let o=mt(),n=V();return ht({async mutationFn(i){try{return await o.set(t,i)}catch(s){s instanceof Error&&_.captureError(s,"staking");return}},async onMutate(i){await n.cancelQueries({queryKey:e});let s=n.getQueryData(e);return n.setQueryData(e,i),{previousValue:s}},onError(i,s,u){n.setQueryData(e,u?.previousValue)}})}var Je=W.object({convert:W.boolean(),mint:W.boolean()}),dt={convert:!1,mint:!1},Xe=JSON.stringify(dt),ce=()=>{let{data:t}=se({key:"featureUsed",queryKey:f.featureUsed(),defaultValue:Xe}),e=(0,it.useMemo)(()=>{if(!t)return dt;let i=Je.safeParse(JSON.parse(t));return i.success?i.data:dt},[t]),{mutateAsync:o}=ue({key:"featureUsed",queryKey:f.featureUsed()}),n=(0,it.useCallback)(async i=>{let s={...e,...i};await o(JSON.stringify(s))},[o,e]);return{usageState:e,setUsageState:n}};var Ze=({method:t,goToInfoPage:e,goToInitFlowPage:o})=>{let{usageState:n}=ce();return(0,me.useCallback)(()=>{n[t]?o():e()},[e,o,t,n])};r();a();var T=P(w());r();a();var to=1,pe=({caip19:t,networkID:e})=>{let{data:o}=Lt({encodedCaip19:t,legacyKey:null}),n=q.getAddressType(e),i=xt(e,n),{fungible:s}=qt({key:i}),u=h(o?.totalQuantityString??0),p=h(to),l=h(u),c=h.max(l,0),S=h(It).plus(Ct),d=h(s?.data.amount??0);return{minAmount:p,maxAmount:c,balance:u,minNativeBalance:S,nativeBalance:d}};var eo=({goBack:t,goToStatusPage:e,lstCaip19:o})=>{let n=x(E=>E.provider),i=x(E=>E.amount),s=x(E=>E.setAmount),u=n?.stakePoolTokenMetadata.metadata,p=u?.symbol??"",l=u?.decimals??0,[c,S]=(0,T.useState)(i?vt(i,l):""),{data:d}=X("solana"),{initLiquidStake:A}=j(q.solana.mainnetID);(0,T.useEffect)(()=>{A(void 0,o)},[A,o]),Nt(d,"STAKE_FUNGIBLE");let{minAmount:U,maxAmount:k,balance:M,nativeBalance:L,minNativeBalance:F}=pe({caip19:o??"",networkID:q.solana.mainnetID}),D=N(k,l),v=N(U,l),ut=N(M,l),le=N(F,q.getTokenDecimals(q.solana.mainnetID)),B=yt(c,l).toString(),ct=h(B),de=ct.isLessThan(U),fe=ct.isGreaterThan(k),ge=ct.isFinite(),Se=L.isLessThan(F),ft=B&&de?b.t("unstakeLiquidStakeAmountMinRequired",{symbol:p,amount:v}):B&&fe?b.t("unstakeLiquidStakeAmountInsufficientBalance"):B&&Se?b.t("unstakeLiquidStakeAmountInsufficientNativeBalance",{symbol:q.getTokenSymbol(q.solana.mainnetID),amount:le}):void 0,ke=ge&&!ft,ye=(0,T.useMemo)(()=>{if(!n)return;let E=O(Number.parseFloat(n.apy)),{address:z,name:gt,symbol:St,logoURI:Te}=n.stakePoolTokenMetadata.metadata,Pe=h(1).dividedBy(h(n.convertRatio)),we=`1 ${p} \u2248 ${Ut(Pe)} ${St}`;return{identifier:z,apy:E,name:gt,symbol:St,rate:we,logoURI:Te}},[n,p]),ve=(0,T.useCallback)(()=>{D.isFinite()&&S(String(D))},[D]),Ae=(0,T.useCallback)(E=>{let z=kt(E);Bt(z,l??9)&&S(z)},[l]),be=(0,T.useCallback)(()=>{s(B),e(B)},[B,e,s]),he=(0,T.useCallback)(()=>{s(""),t()},[s,t]);return{amount:c,amountError:ft,balance:ut,symbol:p,poolToken:ye,canSubmit:ke,onBack:he,onContinue:be,onChangeAmount:Ae,onSetMax:ve}};r();a();var st=P(w());r();a();r();a();var oo=P(w());r();a();export{qe as a,Ue as b,qo as c,Kt as d,Ee as e,Ce as f,Ve as g,De as h,Qe as i,Ir as j,je as k,$e as l,Zt as m,j as n,ce as o,Ze as p,_e as q,eo as r};
//# sourceMappingURL=chunk-QNLMWMRR.js.map
