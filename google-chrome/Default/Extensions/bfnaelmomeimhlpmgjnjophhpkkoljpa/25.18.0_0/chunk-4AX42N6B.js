import{Ab as oe,Ec as ae,Ka as Ht,gb as At,kb as $,ob as Qt,pb as Xt,qb as Zt,rb as te,tb as ht,ub as ee,vd as ne}from"./chunk-HKKBRKQE.js";import{ja as re}from"./chunk-LWEFQGDN.js";import{$a as bt,J as O,K as J,L as u,Ya as M,_a as Gt,c as je,oc as Yt,r as Wt,re as $t}from"./chunk-3GZCHS7Y.js";import{x as Jt}from"./chunk-BY5XXL4W.js";import{C as gt,h as rt,u as zt,w as jt,z as at}from"./chunk-UCPKAIVR.js";import{U as Bt,V as Ut,W as kt,u as Y}from"./chunk-NL7NWYRL.js";import{a as Ge,c as ft,d as H,e as U,f as Ft,g as qt,h as y}from"./chunk-57IY32VM.js";import{c as Ue,f as F,h as s,l as ze,m as Buffer,n as c}from"./chunk-3KENBVE7.js";var Te=Ue(l=>{"use strict";s();c();var Ko=l&&l.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(l,"__esModule",{value:!0});l.map=l.array=l.rustEnum=l.str=l.vecU8=l.tagged=l.vec=l.bool=l.option=l.publicKey=l.i256=l.u256=l.i128=l.u128=l.i64=l.u64=l.struct=l.f64=l.f32=l.i32=l.u32=l.i16=l.u16=l.i8=l.u8=void 0;var w=At(),No=Wt(),Oo=Ko(rt()),q=At();Object.defineProperty(l,"u8",{enumerable:!0,get:function(){return q.u8}});Object.defineProperty(l,"i8",{enumerable:!0,get:function(){return q.s8}});Object.defineProperty(l,"u16",{enumerable:!0,get:function(){return q.u16}});Object.defineProperty(l,"i16",{enumerable:!0,get:function(){return q.s16}});Object.defineProperty(l,"u32",{enumerable:!0,get:function(){return q.u32}});Object.defineProperty(l,"i32",{enumerable:!0,get:function(){return q.s32}});Object.defineProperty(l,"f32",{enumerable:!0,get:function(){return q.f32}});Object.defineProperty(l,"f64",{enumerable:!0,get:function(){return q.f64}});Object.defineProperty(l,"struct",{enumerable:!0,get:function(){return q.struct}});var z=class extends w.Layout{constructor(t,o,r){super(t,r),this.blob=(0,w.blob)(t),this.signed=o}decode(t,o=0){let r=new Oo.default(this.blob.decode(t,o),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,o,r=0){return this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),o,r)}};function Pe(e){return new z(8,!1,e)}l.u64=Pe;function Vo(e){return new z(8,!0,e)}l.i64=Vo;function Ro(e){return new z(16,!1,e)}l.u128=Ro;function Do(e){return new z(16,!0,e)}l.i128=Do;function Co(e){return new z(32,!1,e)}l.u256=Co;function Mo(e){return new z(32,!0,e)}l.i256=Mo;var W=class extends w.Layout{constructor(t,o,r,a){super(t.span,a),this.layout=t,this.decoder=o,this.encoder=r}decode(t,o){return this.decoder(this.layout.decode(t,o))}encode(t,o,r){return this.layout.encode(this.encoder(t),o,r)}getSpan(t,o){return this.layout.getSpan(t,o)}};function Wo(e){return new W((0,w.blob)(32),t=>new No.PublicKey(t),t=>t.toBuffer(),e)}l.publicKey=Wo;var Ot=class extends w.Layout{constructor(t,o){super(-1,o),this.layout=t,this.discriminator=(0,w.u8)()}encode(t,o,r=0){return t==null?this.discriminator.encode(0,o,r):(this.discriminator.encode(1,o,r),this.layout.encode(t,o,r+1)+1)}decode(t,o=0){let r=this.discriminator.decode(t,o);if(r===0)return null;if(r===1)return this.layout.decode(t,o+1);throw new Error("Invalid option "+this.property)}getSpan(t,o=0){let r=this.discriminator.decode(t,o);if(r===0)return 1;if(r===1)return this.layout.getSpan(t,o+1)+1;throw new Error("Invalid option "+this.property)}};function Fo(e,t){return new Ot(e,t)}l.option=Fo;function qo(e){return new W((0,w.u8)(),Bo,Uo,e)}l.bool=qo;function Bo(e){if(e===0)return!1;if(e===1)return!0;throw new Error("Invalid bool: "+e)}function Uo(e){return e?1:0}function zo(e,t){let o=(0,w.u32)("length"),r=(0,w.struct)([o,(0,w.seq)(e,(0,w.offset)(o,-o.span),"values")]);return new W(r,({values:a})=>a,a=>({values:a}),t)}l.vec=zo;function jo(e,t,o){let r=(0,w.struct)([Pe("tag"),t.replicate("data")]);function a({tag:n,data:m}){if(!n.eq(e))throw new Error("Invalid tag, expected: "+e.toString("hex")+", got: "+n.toString("hex"));return m}return new W(r,a,n=>({tag:e,data:n}),o)}l.tagged=jo;function ve(e){let t=(0,w.u32)("length"),o=(0,w.struct)([t,(0,w.blob)((0,w.offset)(t,-t.span),"data")]);return new W(o,({data:r})=>r,r=>({data:r}),e)}l.vecU8=ve;function Go(e){return new W(ve(),t=>t.toString("utf-8"),t=>Buffer.from(t,"utf-8"),e)}l.str=Go;function Yo(e,t,o){let r=(0,w.union)(o??(0,w.u8)(),t);return e.forEach((a,n)=>r.addVariant(n,a,a.property)),r}l.rustEnum=Yo;function Jo(e,t,o){let r=(0,w.struct)([(0,w.seq)(e,t,"values")]);return new W(r,({values:a})=>a,a=>({values:a}),o)}l.array=Jo;var Vt=class extends w.Layout{constructor(t,o,r){super(t.span+o.span,r),this.keyLayout=t,this.valueLayout=o}decode(t,o){o=o||0;let r=this.keyLayout.decode(t,o),a=this.valueLayout.decode(t,o+this.keyLayout.getSpan(t,o));return[r,a]}encode(t,o,r){r=r||0;let a=this.keyLayout.encode(t[0],o,r),n=this.valueLayout.encode(t[1],o,r+a);return a+n}getSpan(t,o){return this.keyLayout.getSpan(t,o)+this.valueLayout.getSpan(t,o)}};function $o(e,t,o){let r=(0,w.u32)("length"),a=(0,w.struct)([r,(0,w.seq)(new Vt(e,t),(0,w.offset)(r,-r.span),"values")]);return new W(a,({values:n})=>new Map(n),n=>({values:Array.from(n.entries())}),o)}l.map=$o});s();c();s();c();var nt=F(je(),1);var se=F(Wt(),1);var ie=(0,nt.struct)([(0,nt.u8)("instruction"),Qt("amount")]);function ce(e,t,o,r,a=[],n=$){let m=te([{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1}],o,a),p=Buffer.alloc(ie.span);return ie.encode({instruction:Xt.Approve,amount:BigInt(r)},p),new se.TransactionInstruction({keys:m,programId:n,data:p})}var ue=new u.PublicKey("Config1111111111111111111111111111111111111"),Ye="https://docs.solana.com/staking",Je="https://docs.solana.com/implemented-proposals/staking-rewards",$e={type:"SolanaNative",data:{amount:"0",balance:new Ut(0),chain:{id:M.solana.mainnetID,imageUrl:M.solana.iconUrl,name:M.solana.name,symbol:M.solana.tokenSymbol},decimals:9,key:"SolanaNative",logoUri:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",name:"Solana",symbol:"SOL",tokenAddress:void 0,walletAddress:"",spamStatus:"NOT_VERIFIED"}},Ar=new Map([[Gt.Solana.Mainnet,$e]]),He="https://www.jito.network/blog/lsts-vs-native-assets/",Qe="https://www.jito.network/staking/?mode=unstake",Xe="https://help.phantom.com/hc/en-us/articles/29846774040467",Ze="https://www.jito.network/blog/reward-bearing-vs-rebasing-solana-liquid-staking-tokens/",to="https://www.jito.network/interceptor",eo="solana:101/address:J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn",hr=4e6,wr=2282880;s();c();function le(e,t){let o=new kt(e/100),r=new kt(t/100);return o.minus(o.times(r)).times(100).decimalPlaces(2).toNumber()}s();c();s();c();s();c();var x="staking";var wt=[x,"stakeAccounts"],Pt=[x,"stakeActivationData"],vt=[x,"convertStakeAccountList"],Tt=[x,"convertStakeTransaction"],It=[x,"mintTokenTransaction"],xt="averageValidatorApy",oo="recommendedValidators",ro="signatureStatus",ao="stakeAccountMinBalance",no="stakeRewardsHistory",io="stakeApy",so="validatorInfo",co="voteAccounts",uo="keybaseUserAvatar",it={keybaseUserAvatar(e){return[x,uo,e]},signatureStatus(e){return[x,ro,e]},stakeAccounts(e,t){return[...wt,e,t]},stakeAccountMinBalance(){return[x,ao]},stakeActivationData(e){return[...Pt,e]},stakeRewardsHistory(e){return[x,no,e]},stakeApy(){return[x,io]},averageValidatorApy(){return[x,xt]},recommendedValidators(){return[x,oo]},validatorInfo(){return[x,so]},voteAccounts(e){return[x,co,e]},convertStakeAccountList(e,t){return[...vt,e,t]},liquidStakingSupportedTokens(){return[x,"liquidStakingSupportedTokens"]},getConvertStakeTransaction(e){return[...Tt,e]},getMintTokenTransaction(e){return[...It,e]},featureUsed(){return[x,"featureUsed"]}};var st=e=>()=>{e.invalidateQueries({predicate:t=>{let o=r=>r.every((a,n)=>t.queryKey[n]===a);return o(wt)||o(Pt)||o(vt)||o(Tt)||o(It)}})};s();c();function de(e,t=9){return e.match(new RegExp(`^\\d*(\\.\\d{0,${t}})?$`))}s();c();var pe={type:"fungible",isNativeOfType:"sol",chain:"solana",name:"Solana",symbol:"SOL",iconUrl:"https://cdn.jsdelivr.net/gh/solana-labs/token-list@main/assets/mainnet/So11111111111111111111111111111111111111112/logo.png",decimals:9},po="stake",me=e=>new Lt(e,po),Lt=class extends re{createStakeAccountAndDelegateStake=t=>{this.analytics.capture("createStakeAccountAndDelegateStake",{data:{...t,...pe}})};deactivateStake=()=>{this.analytics.capture("deactivateStake",{data:{...pe}})}};var Et=Bt(Yt,e=>me(e));s();c();var ct=F(Ge());s();c();var Se=(e,t)=>e+t[1];function fe(e){let t=mo(e),o={commissionWeight:.6,epochCreditsWeight:.1,activatedStakeWeight:.3},r=So(t.maxEpochCredits,t.maxActivatedStake,o);return e.sort(r)}function mo(e){let t={maxEpochCredits:0,maxActivatedStake:0};for(let o of e){let r=o.epochCredits.reduce(Se,0);t.maxEpochCredits<r&&(t.maxEpochCredits=r),t.maxActivatedStake<o.activatedStake&&(t.maxActivatedStake=o.activatedStake)}return t}function yo(e,t,o,r,a){let n=(100-e)/100,m=t/o,p=Math.log10(r+1)/Math.log10(a+1);return{normalizedCommission:n,normalizedEpochCredits:m,normalizedActivatedStake:p}}function ye(e,t,o,r){let{commission:a,epochCredits:n,activatedStake:m}=e,{commissionWeight:p,epochCreditsWeight:A,activatedStakeWeight:S}=r,{normalizedCommission:d,normalizedEpochCredits:h,normalizedActivatedStake:b}=yo(a,n.reduce(Se,0),t,m,o);return(a>10?.5:1)*(p*d+A*h+S*b)}function So(e,t,o){return(r,a)=>{let n=ye(r,e,t,o);return ye(a,e,t,o)-n}}s();c();s();c();var fo=(a=>(a[a.Always=1/0]="Always",a[a.Short=Y({days:1})]="Short",a[a.Medium=Y({days:3})]="Medium",a[a.Long=Y({days:7})]="Long",a))(fo||{}),_t=(n=>(n[n.Immediate=0]="Immediate",n[n.Short=Y({minutes:1})]="Short",n[n.Medium=Y({minutes:2.5})]="Medium",n[n.Long=Y({minutes:5})]="Long",n[n.Never=1/0]="Never",n))(_t||{});var ko=e=>async()=>(await e.getParsedProgramAccounts(ue)).reduce((o,r)=>{if(r.account.data.parsed?.type!=="validatorInfo")return o;let a=r.pubkey.toString(),n=r.account.data.parsed.info.keys,[,m]=n;if(!m.signer)return o;let p=m.pubkey,A=r.account.data.parsed.info.configData;return o.push({identityPubkey:p,infoPubkey:a,info:A}),o},[]);function ke(e){let t=it.validatorInfo(),o=ko(e);return at({queryKey:t,queryFn:o,placeholderData:[],staleTime:1/0})}s();c();var go=async e=>{let t=await e.getVoteAccounts();return[...t.current,...t.delinquent].map(o=>({identityPubkey:o.nodePubkey,voteAccountPubkey:o.votePubkey,commission:o.commission,lastVote:o.lastVote,epochCredits:o.epochCredits,activatedStake:o.activatedStake})).filter(o=>o.commission<99)};function ge(e){let t=it.voteAccounts(e.rpcEndpoint);return at({queryKey:t,queryFn:async()=>go(e),placeholderData:[],staleTime:1/0})}function bo(e){let{isFetched:t,isFetching:o,isPending:r,isSuccess:a,isError:n,dataUpdatedAt:m,errorUpdatedAt:p,error:A,refetch:S,data:d}=ge(e),h=Math.max(m,p),{isFetched:b,isFetching:T,isPending:f,isSuccess:P,isError:I,dataUpdatedAt:v,errorUpdatedAt:L,error:E,refetch:_,data:N}=ke(e),k=Math.max(v,L),V=Math.max(h,k),B=t&&b,D=o||T,C=a||P,et=n||I,ot=A||E,De=r||f,Ce=(0,ct.useCallback)(async()=>{Promise.all([S(),_()])},[_,S]);return{results:(0,ct.useMemo)(()=>{if(!d)return[];if(!N)return[];let Me=fe(d),We=new Map(Me.map(G=>[G.identityPubkey,G])),Fe=new Map(N.map(G=>[G.identityPubkey,G])),Mt=[];for(let[G,qe]of We){let Be=Fe.get(G);Mt.push({...qe,...Be})}return Mt},[N,d]),dataUpdatedAt:V,error:ot,isSuccess:C,isError:et,isFetched:B,isFetching:D,isPending:De,refetch:Ce}}s();c();function Kt(e){let t=!!e?.info.meta.lockup,o=new Date((e?.info.meta.lockup?.unixTimestamp??0)*1e3);return t&&o.getTime()>Date.now()}s();c();s();c();var Ao=y.object({apy:y.number()}),ho=y.object({validators:y.array(y.string())}),be=y.object({epoch:y.number(),effectiveSlot:y.number(),amount:y.number(),postBalance:y.number(),percentChange:y.number(),apr:y.number(),timestamp:y.number()}),wo=y.object({items:y.array(be)}),Po=y.object({address:y.string(),chainId:bt,decimals:y.number(),logoURI:y.string(),name:y.string(),symbol:y.string()}),vo=y.object({caip19:y.string(),metadata:Po}),To=y.object({vote_account:y.string()}),Io=y.object({apy:y.string(),chainId:bt,convertRatio:y.string(),name:y.string(),stakePoolAddress:y.string(),stakePoolTokenMetadata:vo,validators:y.array(To)}),_a=y.record(y.string(),y.array(Io));s();c();s();c();var Ae={transactionData:void 0,fungibleToStake:void 0,provider:void 0,convert:{validatorVote:"",stakeAccount:"",validatorName:"",eligibleAccountsCount:0},amount:"",navigateTo:null,skipDismissRouting:void 0},he=$t(e=>({...Ae,resetStaking:()=>e(Ae),setTransactionData:t=>e({transactionData:t}),setFungibleToStake:t=>e({fungibleToStake:t}),setProvider:t=>e({provider:t}),setConvertStakeAccount:t=>e({convert:t}),setAmount:t=>e({amount:t}),setNavigateTo:t=>e({navigateTo:t}),setSkipDismissRouting:t=>e({skipDismissRouting:t})}));s();c();var xo=["liquidStakingSupportedTokens","featureUsed",xt],Lo=e=>{let t=String(e.queryKey[1]);return xo.includes(t)};s();c();var _o=(e,t)=>{if(e.type==="initialized")return!1;let o=e?.info?.stake?.delegation?.voter??"",r=Kt(e);return e.activationState==="active"&&t.has(o)&&!r};s();c();s();c();var tt=F(rt());s();c();var Nt=F(ze());var Za=new u.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s");var K=new u.PublicKey("SPoo1Ku8WFXoNDMHPsrGSTSG1Y47rzgn41SLUNakuHy");var tn=Nt.Buffer.from("ephemeral"),we=Nt.Buffer.from("transient"),Q=u.LAMPORTS_PER_SOL;s();c();var ut=Object.freeze({DepositStake:{index:9,layout:O.struct([O.u8("instruction")])},DepositSol:{index:14,layout:O.struct([O.u8("instruction"),O.ns64("lamports")])},WithdrawStake:{index:10,layout:O.struct([O.u8("instruction"),O.ns64("poolTokens")])},WithdrawSol:{index:16,layout:O.struct([O.u8("instruction"),O.ns64("poolTokens")])}});function lt(e,t){let o=e.layout.span,r=Buffer.alloc(o),a=Object.assign({instruction:e.index},t);return e.layout.encode(a,r),r}var X=class{static depositStake(t){let{stakePool:o,validatorList:r,depositAuthority:a,withdrawAuthority:n,depositStake:m,validatorStake:p,reserveStake:A,destinationPoolAccount:S,managerFeeAccount:d,referralPoolAccount:h,poolMint:b,referralAccount:T}=t,f=ut.DepositStake,P=lt(f),I=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.SYSVAR_STAKE_HISTORY_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1}];return T&&I.push({pubkey:T,isSigner:!1,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:I,data:P})}static depositSol(t){let{stakePool:o,withdrawAuthority:r,depositAuthority:a,reserveStake:n,fundingAccount:m,destinationPoolAccount:p,managerFeeAccount:A,referralPoolAccount:S,poolMint:d,lamports:h,referralAccount:b}=t,T=ut.DepositSol,f=lt(T,{lamports:h}),P=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!0,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.SystemProgram.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1}];return a&&P.push({pubkey:a,isSigner:!0,isWritable:!1}),b&&P.push({pubkey:b,isSigner:!1,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:P,data:f})}static withdrawStake(t){let{stakePool:o,validatorList:r,withdrawAuthority:a,validatorStake:n,destinationStake:m,destinationStakeAuthority:p,sourceTransferAuthority:A,sourcePoolAccount:S,managerFeeAccount:d,poolMint:h,poolTokens:b}=t,T=ut.WithdrawStake,f=lt(T,{poolTokens:b}),P=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!0,isWritable:!1},{pubkey:S,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:h,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1}];return new J.TransactionInstruction({programId:K,keys:P,data:f})}static withdrawSol(t){let{stakePool:o,withdrawAuthority:r,sourceTransferAuthority:a,sourcePoolAccount:n,reserveStake:m,destinationSystemAccount:p,managerFeeAccount:A,solWithdrawAuthority:S,poolMint:d,poolTokens:h}=t,b=ut.WithdrawSol,T=lt(b,{poolTokens:h}),f=[{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:A,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u.SYSVAR_CLOCK_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.SYSVAR_STAKE_HISTORY_PUBKEY,isSigner:!1,isWritable:!1},{pubkey:u.StakeProgram.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1}];return S&&f.push({pubkey:S,isSigner:!0,isWritable:!1}),new J.TransactionInstruction({programId:K,keys:f,data:T})}};s();c();var i=F(Te());var Ie=F(rt()),xe=F(At());var j=[(0,i.u64)("denominator"),(0,i.u64)("numerator")];var dt=ft().transform(e=>new Ie.default(e,10)),pt=ft().transform(e=>new u.PublicKey(e)),Ho=Ft(["uninitialized","initialized","delegated","rewardsPool"]),Qo=U({rentExemptReserve:dt,authorized:U({staker:pt,withdrawer:pt}),lockup:U({unixTimestamp:H(),epoch:H(),custodian:pt})}),Xo=U({meta:Qo,stake:U({delegation:U({voter:pt,stake:dt,activationEpoch:dt,deactivationEpoch:dt,warmupCooldownRate:H()}),creditsObserved:H()}).nullish().default(null)}),Le=U({type:Ho,info:qt(Xo)}),Dt=class extends xe.Layout{layout;discriminator;constructor(t,o){super(-1,o),this.layout=t,this.discriminator=(0,i.u8)()}encode(t,o,r=0){return t==null?this.discriminator.encode(0,o,r):(this.discriminator.encode(2,o,r),this.layout.encode(t,o,r+1)+1)}decode(t,o=0){let r=this.discriminator.decode(t,o);if(r===0)return null;if(r===1||r===2)return this.layout.decode(t,o+1);throw new Error("Invalid future epoch "+this.property)}getSpan(t,o=0){let r=this.discriminator.decode(t,o);if(r===0)return 1;if(r===1||r===2)return this.layout.getSpan(t,o+1)+1;throw new Error("Invalid future epoch "+this.property)}};function Rt(e,t){return new Dt(e,t)}var Ee=(0,i.struct)([(0,i.u8)("accountType"),(0,i.publicKey)("manager"),(0,i.publicKey)("staker"),(0,i.publicKey)("stakeDepositAuthority"),(0,i.u8)("stakeWithdrawBumpSeed"),(0,i.publicKey)("validatorList"),(0,i.publicKey)("reserveStake"),(0,i.publicKey)("poolMint"),(0,i.publicKey)("managerFeeAccount"),(0,i.publicKey)("tokenProgramId"),(0,i.u64)("totalLamports"),(0,i.u64)("poolTokenSupply"),(0,i.u64)("lastUpdateEpoch"),(0,i.struct)([(0,i.u64)("unixTimestamp"),(0,i.u64)("epoch"),(0,i.publicKey)("custodian")],"lockup"),(0,i.struct)(j,"epochFee"),Rt((0,i.struct)(j),"nextEpochFee"),(0,i.option)((0,i.publicKey)(),"preferredDepositValidatorVoteAddress"),(0,i.option)((0,i.publicKey)(),"preferredWithdrawValidatorVoteAddress"),(0,i.struct)(j,"stakeDepositFee"),(0,i.struct)(j,"stakeWithdrawalFee"),Rt((0,i.struct)(j),"nextStakeWithdrawalFee"),(0,i.u8)("stakeReferralFee"),(0,i.option)((0,i.publicKey)(),"solDepositAuthority"),(0,i.struct)(j,"solDepositFee"),(0,i.u8)("solReferralFee"),(0,i.option)((0,i.publicKey)(),"solWithdrawAuthority"),(0,i.struct)(j,"solWithdrawalFee"),Rt((0,i.struct)(j),"nextSolWithdrawalFee"),(0,i.u64)("lastEpochPoolTokenSupply"),(0,i.u64)("lastEpochTotalLamports")]);var Zo=(0,i.struct)([(0,i.u64)("activeStakeLamports"),(0,i.u64)("transientStakeLamports"),(0,i.u64)("lastUpdateEpoch"),(0,i.u64)("transientSeedSuffixStart"),(0,i.u64)("transientSeedSuffixEnd"),(0,i.u8)("status"),(0,i.publicKey)("voteAccountAddress")]),mt=(0,i.struct)([(0,i.u8)("accountType"),(0,i.u32)("maxValidators"),(0,i.vec)(Zo,"validators")]);s();c();var R=F(rt());function _e(e){return isNaN(e)?0:Number(e*u.LAMPORTS_PER_SOL)}function yt(e,t){let o=t.mul(e.totalLamports),r=e.poolTokenSupply;return o.lt(r)?new R.default(0):o.div(r)}async function Ct(e,t){let[o]=await u.PublicKey.findProgramAddress([t.toBuffer(),Buffer.from("withdraw")],e);return o}async function St(e,t,o,r){let[a]=await u.PublicKey.findProgramAddress([t.toBuffer(),o.toBuffer(),r?new R.default(r).toArrayLike(Buffer,"le",4):Buffer.alloc(0)],e);return a}function Z(e){if(typeof e=="number")return Math.abs(e)/u.LAMPORTS_PER_SOL;if(typeof e=="bigint")return Math.abs(Number(e))/u.LAMPORTS_PER_SOL;let t=1;e.isNeg()&&(t=-1);let r=e.abs().toString(10).padStart(10,"0"),a=r.length-9,n=r.slice(0,a)+"."+r.slice(a);return t*parseFloat(n)}async function tr(e,t,o,r){let[a]=await u.PublicKey.findProgramAddress([we,t.toBuffer(),o.toBuffer(),r.toArrayLike(Buffer,"le",8)],e);return a}function er(e,t){return e.poolTokenSupply.isZero()||e.totalLamports.isZero()?t:t.mul(e.poolTokenSupply).div(e.totalLamports)}async function Ke(e,t,o,r,a,n){let m=await e.getAccountInfo(t.validatorList),p=mt.decode(m?.data);if(!p?.validators||p?.validators.length==0)throw new Error("No accounts found");let A=await e.getMinimumBalanceForRentExemption(u.StakeProgram.space),S=new R.default(A+Q),d=[];for(let v of p.validators){if(v.status!==0)continue;let L=await St(K,v.voteAccountAddress,o);if(!v.activeStakeLamports.isZero()){let _=t?.preferredWithdrawValidatorVoteAddress?.equals(v.voteAccountAddress);d.push({type:_?"preferred":"active",voteAddress:v.voteAccountAddress,stakeAddress:L,lamports:v.activeStakeLamports})}let E=v.transientStakeLamports.sub(S);if(E.gt(new R.default(0))){let _=await tr(K,v.voteAccountAddress,o,v.transientSeedSuffixStart);d.push({type:"transient",voteAddress:v.voteAccountAddress,stakeAddress:_,lamports:E})}}d=d.sort(a||((v,L)=>L.lamports.sub(v.lamports).toNumber()));let h=await e.getAccountInfo(t.reserveStake),b=new R.default((h?.lamports??0)-A);b.gt(new R.default(0))&&d.push({type:"reserve",stakeAddress:t.reserveStake,lamports:b});let T=[],f=new R.default(r),P=t.stakeWithdrawalFee,I={numerator:P.denominator.sub(P.numerator),denominator:P.denominator};for(let v of["preferred","active","transient","reserve"]){let L=d.filter(E=>E.type==v);for(let{stakeAddress:E,voteAddress:_,lamports:N}of L){if(N.lte(S)&&v=="transient")continue;let k=er(t,N);!n&&!I.numerator.isZero()&&(k=k.mul(I.denominator).div(I.numerator));let V=R.default.min(k,f);if(!V.lte(new R.default(0))&&(T.push({stakeAddress:E,voteAddress:_,poolAmount:V}),f=f.sub(V),f.isZero()))break}if(f.isZero())break}if(f.gt(new R.default(0)))throw new Error(`No stake accounts found in this pool with enough balance to withdraw ${Z(r)} pool tokens.`);return T}function Ne(e,t,o){let r=u.Keypair.generate();return t.push(u.SystemProgram.createAccount({fromPubkey:e,newAccountPubkey:r.publicKey,lamports:o,space:u.StakeProgram.space,programId:u.StakeProgram.programId})),r}async function Oe(e,t){let o=await e.getAccountInfo(t);if(!o)throw new Error("Invalid stake pool account");return{pubkey:t,account:{data:Ee.decode(o.data),executable:o.executable,lamports:o.lamports,owner:o.owner}}}async function or(e,t){let o=(await e.getParsedAccountInfo(t)).value;if(!o||!("parsed"in o.data))throw new Error("Invalid stake account");if(o.data.program!="stake")throw new Error("Not a stake account");return Le.parse(o.data.parsed)}async function Nn(e,t,o,r,a,n,m,p){let A=await e.getBalance(o,"confirmed");if(A<r)throw new Error(`Not enough SOL to deposit into pool. Maximum deposit amount is ${Z(A)} SOL.`);let d=(await Oe(e,t)).account.data,h=new u.Keypair,b=[h],T=[];if(T.push(u.SystemProgram.transfer({fromPubkey:o,toPubkey:h.publicKey,lamports:r})),!a){let P=ht(d.poolMint,o);T.push(ee(o,P,o,d.poolMint)),a=P}let f=await Ct(K,t);return T.push(X.depositSol({stakePool:t,reserveStake:d.reserveStake,fundingAccount:h.publicKey,destinationPoolAccount:a,managerFeeAccount:d.managerFeeAccount,referralPoolAccount:m??a,poolMint:d.poolMint,lamports:r,withdrawAuthority:f,depositAuthority:p,referralAccount:n})),{instructions:T,signers:b}}async function Ve(e,t,o,r,a=!1,n,m,p,A){let S=await Oe(e,t),d=new tt.default(_e(r));p||(p=ht(S.account.data.poolMint,o));let h=await Zt(e,p);if(h.amount<d.toNumber())throw new Error(`Not enough token balance to withdraw ${Z(d)} pool tokens.
          Maximum withdraw amount is ${Z(h.amount)} pool tokens.`);let b=await e.getMinimumBalanceForRentExemption(u.StakeProgram.space),T=await Ct(K,t),f=null;m&&(f=await or(e,m));let P=[];if(a)P.push({stakeAddress:S.account.data.reserveStake,voteAddress:void 0,poolAmount:d});else if(f&&f?.type=="delegated"){let k=f.info?.stake?.delegation.voter;if(!k)throw new Error(`Invalid stake reciever ${m} delegation`);let V=await e.getAccountInfo(S.account.data.validatorList),D=mt.decode(V?.data).validators.find(C=>C.voteAccountAddress.equals(k));if(n&&n!==k)throw new Error(`Provided withdrawal vote account ${n} does not match delegation on stake receiver account ${k},
        remove this flag or provide a different stake account delegated to ${n}`);if(D){let C=await St(K,k,t),et=await e.getAccountInfo(C);if(!et)throw new Error("Preferred withdraw valdator's stake account is invalid");let ot=yt(S.account.data,new tt.default(et.lamports-Q-b));if(ot.lt(d))throw new Error(`Not enough lamports available for withdrawal from ${C},
              ${d} asked, ${ot} available.`);P.push({stakeAddress:C,voteAddress:k,poolAmount:d})}else throw new Error(`Provided stake account is delegated to a vote account ${k} which does not exist in the stake pool`)}else if(n){let k=await St(K,n,t),V=await e.getAccountInfo(k);if(!V)throw new Error("Invalid Stake Account");let B=new tt.default(V.lamports-Q-b);if(B.lt(new tt.default(0)))throw new Error("Invalid Stake Account");let D=yt(S.account.data,B);if(D.lt(d))throw new Error(`Not enough lamports available for withdrawal from ${k},
            ${d} asked, ${D} available.`);P.push({stakeAddress:k,voteAddress:n,poolAmount:d})}else{let k=await Ke(e,S.account.data,t,d,A,p.equals(S.account.data.managerFeeAccount));P.push(...k)}let I=[],v=u.Keypair.generate(),L=[v];I.push(ce(p,v.publicKey,o,d.toNumber()));let E=0,_=5,N=0;for(let k of P){if(N>_)break;let B=`Withdrawing \u25CE${yt(S.account.data,k.poolAmount)},
        from stake account ${k.stakeAddress?.toBase58()}`;k.voteAddress&&(B=`${B}, delegated to ${k.voteAddress?.toBase58()}`);let D;if(!m||f&&f.type==="delegated"){let C=Ne(o,I,b);L.push(C),E+=b,D=C.publicKey}else D=m;I.push(X.withdrawStake({stakePool:t,validatorList:S.account.data.validatorList,validatorStake:k.stakeAddress,destinationStake:D,destinationStakeAuthority:o,sourceTransferAuthority:v.publicKey,sourcePoolAccount:p,managerFeeAccount:S.account.data.managerFeeAccount,poolMint:S.account.data.poolMint,poolTokens:k.poolAmount.toNumber(),withdrawAuthority:T})),N++}return m&&f&&f.type==="delegated"&&L.forEach(k=>{I.concat(u.StakeProgram.merge({stakePubkey:m,sourceStakePubKey:k.publicKey,authorizedPubkey:o}).instructions)}),{instructions:I,signers:L,stakeReceiver:m,totalRentFreeBalances:E}}function rr(e){let{t}=Jt(),o=zt(),r=Et(),{mutateAsync:a}=ae(e);return jt({mutationFn:async({stakePoolAddress:p,amount:A,accountIdentifier:S,senderAddress:d})=>{let{networkID:h,address:b}=d,T=new u.PublicKey(b),f=new u.PublicKey(b),{instructions:P,signers:I}=await Ve(e,p,T,A,!1).catch(N=>{throw gt.captureError(N,"staking"),N}),v=new J.Transaction;v.add(...P);let L=await Ht(v,{connection:e}),E={ownerAddress:b??"",networkID:h,data:{signature:""},type:"withdrawStake",display:{summary:{topLeft:{text:t("transactionsPendingWithdrawingStake")}}}};r.approved({chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(h),type:"withdraw-liquid-stake"});let _=await a({accountIdentifier:S,feePayer:f,transaction:L,pendingTransactionInput:E,opts:{additionalSignerAccounts:I}});return r.submittedTransaction(_,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(h),method:"signAndSendTransaction"}),{networkID:h,id:_}},onSuccess:p=>{oe({connection:e,signature:p.id}).then(()=>{r.transactionStatus(p.id,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(p.networkID),status:{type:"confirmed"}}),st(o)()}).catch(A=>{r.transactionStatus(p.id,{chainType:"solana",chainName:"solana",networkId:M.getSolanaNetworkIDValue(p.networkID),status:{type:"error"}}),gt.captureError(A,"staking")})}})}s();c();s();c();var oi={name:"Jito",stakePoolAddress:"Jito4APyf642JPZPx3hGc6WWJ8zPKtRbRs4P815Awbb",apy:"0.0760131222374123",convertRatio:"1.1067926864808721",stakePoolTokenMetadata:{metadata:{address:"J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn",name:"Jito Staked SOL",symbol:"JitoSOL",decimals:9,logoURI:"https://storage.googleapis.com/token-metadata/JitoSOL-256.png",chainId:"solana:101"},caip19:"solana:101/address:J1toso1uCk3RLmjorhTtrVwY9HJ7X8V9yYac6Y7kGCPn"},chainId:"solana:101",validators:[{vote_account:"validator"}]},Re={name:"Phantom Staked SOL",stakePoolAddress:"pSPcvR8GmG9aKDUbn9nbKYjkxt9hxMS7kF1qqKJaPqJ",apy:"0.0950000000000000",convertRatio:"1.0500000000000000",stakePoolTokenMetadata:{metadata:{address:ne,name:"Phantom Staked SOL",symbol:"PSOL",decimals:9,logoURI:"https://storage.googleapis.com/token-metadata/PSOL-256.png",chainId:"solana:101"},caip19:"solana:101/address:pSo1f9nQXWgXibFtKf7NWYxb5enAM4qfP6UJSiXRQfL"},chainId:"solana:101",validators:[{vote_account:"validator"}]};function ar(e){return e?e.stakePoolTokenMetadata.caip19===Re.stakePoolTokenMetadata.caip19:!1}export{Ye as a,Je as b,Ar as c,He as d,Qe as e,Xe as f,Ze as g,to as h,eo as i,hr as j,wr as k,Ao as l,ho as m,_a as n,le as o,it as p,st as q,de as r,Et as s,he as t,Lo as u,fo as v,bo as w,Kt as x,_o as y,Te as z,Nn as A,rr as B,ar as C};
//# sourceMappingURL=chunk-4AX42N6B.js.map
