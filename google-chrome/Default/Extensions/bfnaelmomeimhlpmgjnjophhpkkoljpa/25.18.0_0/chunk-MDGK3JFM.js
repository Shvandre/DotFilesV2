import{fc as Hi}from"./chunk-5HSK4GMQ.js";import{t as ua}from"./chunk-QCTV7K6S.js";import{a as Gi,c as rt}from"./chunk-WN5BOODY.js";import{a as xi}from"./chunk-SK6BTSEQ.js";import{K as ki,L as zi,O as Ki,S as $i,d as ji,e as Ui,f as qi,q as Ve,r as Bi}from"./chunk-WP4K54AS.js";import{C as tt,I as Vi}from"./chunk-UCPKAIVR.js";import{$ as Mi}from"./chunk-NL7NWYRL.js";import{O as Ri,T as yr,_ as et}from"./chunk-57IY32VM.js";import{c as E,f as aa,h as f,i as v,m as Buffer,n as h}from"./chunk-3KENBVE7.js";var ge=E(P=>{"use strict";f();h();Object.defineProperty(P,"__esModule",{value:!0});P.DEFAULT_TLRU_TTL_MS=P.BANDIT_ASSIGNMENT_SHARDS=P.MAX_EVENT_QUEUE_SIZE=P.NULL_SENTINEL=P.SESSION_ASSIGNMENT_CONFIG_LOADED=P.PRECOMPUTED_FLAGS_ENDPOINT=P.PRECOMPUTED_BASE_URL=P.BANDIT_ENDPOINT=P.UFC_ENDPOINT=P.BASE_URL=P.DEFAULT_POLL_CONFIG_REQUEST_RETRIES=P.DEFAULT_INITIAL_CONFIG_REQUEST_RETRIES=P.POLL_JITTER_PCT=P.DEFAULT_POLL_INTERVAL_MS=P.REQUEST_TIMEOUT_MILLIS=P.DEFAULT_REQUEST_TIMEOUT_MS=void 0;P.DEFAULT_REQUEST_TIMEOUT_MS=5e3;P.REQUEST_TIMEOUT_MILLIS=P.DEFAULT_REQUEST_TIMEOUT_MS;P.DEFAULT_POLL_INTERVAL_MS=3e4;P.POLL_JITTER_PCT=.1;P.DEFAULT_INITIAL_CONFIG_REQUEST_RETRIES=1;P.DEFAULT_POLL_CONFIG_REQUEST_RETRIES=7;P.BASE_URL="https://fscdn.eppo.cloud/api";P.UFC_ENDPOINT="/flag-config/v1/config";P.BANDIT_ENDPOINT="/flag-config/v1/bandits";P.PRECOMPUTED_BASE_URL="https://fs-edge-assignment.eppo.cloud";P.PRECOMPUTED_FLAGS_ENDPOINT="/assignments";P.SESSION_ASSIGNMENT_CONFIG_LOADED="eppo-session-assignment-config-loaded";P.NULL_SENTINEL="EPPO_NULL";P.MAX_EVENT_QUEUE_SIZE=100;P.BANDIT_ASSIGNMENT_SHARDS=1e4;P.DEFAULT_TLRU_TTL_MS=6e5});var Ct=E(br=>{"use strict";f();h();Object.defineProperty(br,"__esModule",{value:!0});var At=ge(),_r=class{constructor(e){this.params=e,this.params.baseUrl=e.baseUrl??At.BASE_URL}endpoint(e){let r=new URL(this.params.baseUrl+e);return Object.entries(this.params.queryParams??{}).forEach(([n,i])=>r.searchParams.append(n,i)),r}ufcEndpoint(){return this.endpoint(At.UFC_ENDPOINT)}banditParametersEndpoint(){return this.endpoint(At.BANDIT_ENDPOINT)}precomputedFlagsEndpoint(){return this.endpoint(At.PRECOMPUTED_FLAGS_ENDPOINT)}};br.default=_r});var Qi=E((cd,Ji)=>{"use strict";f();h();function ca(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}Ji.exports=la;function la(t,e,r){var n=r&&r.stringify||ca,i=1;if(typeof t=="object"&&t!==null){var s=e.length+i;if(s===1)return t;var o=new Array(s);o[0]=n(t);for(var a=1;a<s;a++)o[a]=n(e[a]);return o.join(" ")}if(typeof t!="string")return t;var p=e.length;if(p===0)return t;for(var d="",b=1-i,A=-1,T=t&&t.length||0,S=0;S<T;){if(t.charCodeAt(S)===37&&S+1<T){switch(A=A>-1?A:0,t.charCodeAt(S+1)){case 100:case 102:if(b>=p||e[b]==null)break;A<S&&(d+=t.slice(A,S)),d+=Number(e[b]),A=S+2,S++;break;case 105:if(b>=p||e[b]==null)break;A<S&&(d+=t.slice(A,S)),d+=Math.floor(Number(e[b])),A=S+2,S++;break;case 79:case 111:case 106:if(b>=p||e[b]===void 0)break;A<S&&(d+=t.slice(A,S));var C=typeof e[b];if(C==="string"){d+="'"+e[b]+"'",A=S+2,S++;break}if(C==="function"){d+=e[b].name||"<anonymous>",A=S+2,S++;break}d+=n(e[b]),A=S+2,S++;break;case 115:if(b>=p)break;A<S&&(d+=t.slice(A,S)),d+=String(e[b]),A=S+2,S++;break;case 37:A<S&&(d+=t.slice(A,S)),d+="%",A=S+2,S++,b--;break}++b}++S}return A===-1?t:(A<T&&(d+=t.slice(A)),d)}});var ts=E((gd,Tt)=>{"use strict";f();h();var Wi=Qi();Tt.exports=fe;var nt=wa().console||{},da={mapHttpRequest:wt,mapHttpResponse:wt,wrapRequestSerializer:vr,wrapResponseSerializer:vr,wrapErrorSerializer:vr,req:wt,res:wt,err:Yi,errWithCause:Yi};function Ee(t,e){return t==="silent"?1/0:e.levels.values[t]}var Ar=Symbol("pino.logFuncs"),Er=Symbol("pino.hierarchy"),ga={error:"log",fatal:"error",warn:"error",info:"log",debug:"log",trace:"log"};function Zi(t,e){let r={logger:e,parent:t[Er]};e[Er]=r}function fa(t,e,r){let n={};e.forEach(i=>{n[i]=r[i]?r[i]:nt[i]||nt[ga[i]||"log"]||ke}),t[Ar]=n}function ha(t,e){return Array.isArray(t)?t.filter(function(n){return n!=="!stdSerializers.err"}):t===!0?Object.keys(e):!1}function fe(t){t=t||{},t.browser=t.browser||{};let e=t.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");let r=t.browser.write||nt;t.browser.write&&(t.browser.asObject=!0);let n=t.serializers||{},i=ha(t.browser.serialize,n),s=t.browser.serialize;Array.isArray(t.browser.serialize)&&t.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);let o=Object.keys(t.customLevels||{}),a=["error","fatal","warn","info","debug","trace"].concat(o);typeof r=="function"&&a.forEach(function(N){r[N]=r}),(t.enabled===!1||t.browser.disabled)&&(t.level="silent");let p=t.level||"info",d=Object.create(r);d.log||(d.log=ke),fa(d,a,r),Zi({},d),Object.defineProperty(d,"levelVal",{get:A}),Object.defineProperty(d,"level",{get:T,set:S});let b={transmit:e,serialize:i,asObject:t.browser.asObject,formatters:t.browser.formatters,levels:a,timestamp:Sa(t),messageKey:t.messageKey||"msg",onChild:t.onChild||ke};d.levels=pa(t),d.level=p,d.setMaxListeners=d.getMaxListeners=d.emit=d.addListener=d.on=d.prependListener=d.once=d.prependOnceListener=d.removeListener=d.removeAllListeners=d.listeners=d.listenerCount=d.eventNames=d.write=d.flush=ke,d.serializers=n,d._serialize=i,d._stdErrSerialize=s,d.child=function(...N){return C.call(this,b,...N)},e&&(d._logEvent=Sr());function A(){return Ee(this.level,this)}function T(){return this._level}function S(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,Le(this,b,d,"error"),Le(this,b,d,"fatal"),Le(this,b,d,"warn"),Le(this,b,d,"info"),Le(this,b,d,"debug"),Le(this,b,d,"trace"),o.forEach(O=>{Le(this,b,d,O)})}function C(N,O,y){if(!O)throw new Error("missing bindings for child Pino");y=y||{},i&&O.serializers&&(y.serializers=O.serializers);let m=y.serializers;if(i&&m){var c=Object.assign({},n,m),u=t.browser.serialize===!0?Object.keys(c):i;delete O.serializers,Cr([O],u,c,this._stdErrSerialize)}function g(D){this._childLevel=(D._childLevel|0)+1,this.bindings=O,c&&(this.serializers=c,this._serialize=u),e&&(this._logEvent=Sr([].concat(D._logEvent.bindings,O)))}g.prototype=this;let l=new g(this);return Zi(this,l),l.child=function(...D){return C.call(this,N,...D)},l.level=y.level||this.level,N.onChild(l),l}return d}function pa(t){let e=t.customLevels||{},r=Object.assign({},fe.levels.values,e),n=Object.assign({},fe.levels.labels,ma(e));return{values:r,labels:n}}function ma(t){let e={};return Object.keys(t).forEach(function(r){e[t[r]]=r}),e}fe.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};fe.stdSerializers=da;fe.stdTimeFunctions=Object.assign({},{nullTime:Xi,epochTime:es,unixTime:Aa,isoTime:Ca});function ya(t){let e=[];t.bindings&&e.push(t.bindings);let r=t[Er];for(;r.parent;)r=r.parent,r.logger.bindings&&e.push(r.logger.bindings);return e.reverse()}function Le(t,e,r,n){if(Object.defineProperty(t,n,{value:Ee(t.level,r)>Ee(n,r)?ke:r[Ar][n],writable:!0,enumerable:!0,configurable:!0}),t[n]===ke){if(!e.transmit)return;let s=e.transmit.level||t.level,o=Ee(s,r);if(Ee(n,r)<o)return}t[n]=ba(t,e,r,n);let i=ya(t);i.length!==0&&(t[n]=_a(i,t[n]))}function _a(t,e){return function(){return e.apply(this,[...t,...arguments])}}function ba(t,e,r,n){return function(i){return function(){let o=e.timestamp(),a=new Array(arguments.length),p=Object.getPrototypeOf&&Object.getPrototypeOf(this)===nt?nt:this;for(var d=0;d<a.length;d++)a[d]=arguments[d];var b=!1;if(e.serialize&&(Cr(a,this._serialize,this.serializers,this._stdErrSerialize),b=!0),e.asObject||e.formatters?i.call(p,va(this,n,a,o,e)):i.apply(p,a),e.transmit){let A=e.transmit.level||t._level,T=Ee(A,r),S=Ee(n,r);if(S<T)return;Ea(this,{ts:o,methodLevel:n,methodValue:S,transmitLevel:A,transmitValue:r.levels.values[e.transmit.level||t._level],send:e.transmit.send,val:Ee(t._level,r)},a,b)}}}(t[Ar][n])}function va(t,e,r,n,i){let{level:s,log:o=T=>T}=i.formatters||{},a=r.slice(),p=a[0],d={};if(n&&(d.time=n),s){let T=s(e,t.levels.values[e]);Object.assign(d,T)}else d.level=t.levels.values[e];let b=(t._childLevel|0)+1;if(b<1&&(b=1),p!==null&&typeof p=="object"){for(;b--&&typeof a[0]=="object";)Object.assign(d,a.shift());p=a.length?Wi(a.shift(),a):void 0}else typeof p=="string"&&(p=Wi(a.shift(),a));return p!==void 0&&(d[i.messageKey]=p),o(d)}function Cr(t,e,r,n){for(let i in t)if(n&&t[i]instanceof Error)t[i]=fe.stdSerializers.err(t[i]);else if(typeof t[i]=="object"&&!Array.isArray(t[i])&&e)for(let s in t[i])e.indexOf(s)>-1&&s in r&&(t[i][s]=r[s](t[i][s]))}function Ea(t,e,r,n=!1){let i=e.send,s=e.ts,o=e.methodLevel,a=e.methodValue,p=e.val,d=t._logEvent.bindings;n||Cr(r,t._serialize||Object.keys(t.serializers),t.serializers,t._stdErrSerialize===void 0?!0:t._stdErrSerialize),t._logEvent.ts=s,t._logEvent.messages=r.filter(function(b){return d.indexOf(b)===-1}),t._logEvent.level.label=o,t._logEvent.level.value=a,i(o,t._logEvent,p),t._logEvent=Sr(d)}function Sr(t){return{ts:0,messages:[],bindings:t||[],level:{label:"",value:0}}}function Yi(t){let e={type:t.constructor.name,msg:t.message,stack:t.stack};for(let r in t)e[r]===void 0&&(e[r]=t[r]);return e}function Sa(t){return typeof t.timestamp=="function"?t.timestamp:t.timestamp===!1?Xi:es}function wt(){return{}}function vr(t){return t}function ke(){}function Xi(){return!1}function es(){return Date.now()}function Aa(){return Math.round(Date.now()/1e3)}function Ca(){return new Date(Date.now()).toISOString()}function wa(){function t(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return t(self)||t(self)||t(this)||{}}}Tt.exports.default=fe;Tt.exports.pino=fe});var ae=E(ze=>{"use strict";f();h();Object.defineProperty(ze,"__esModule",{value:!0});ze.logger=ze.loggerPrefix=void 0;var Ta=ts();ze.loggerPrefix="[Eppo SDK]";ze.logger=(0,Ta.default)({level:v.LOG_LEVEL??(v.NODE_ENV==="production"?"warn":"info"),browser:{disabled:!0}})});var Or=E((wr,Tr)=>{f();h();(function(t,e){typeof wr=="object"&&typeof Tr<"u"?Tr.exports=e():typeof define=="function"&&define.amd?define(e):function(){var r=t.Base64,n=e();n.noConflict=function(){return t.Base64=r,n},t.Meteor&&(Base64=n),t.Base64=n}()})(typeof self<"u"||typeof self<"u"||typeof self<"u"?self:wr,function(){"use strict";var t="3.7.7",e=t,r=typeof Buffer=="function",n=typeof TextDecoder=="function"?new TextDecoder:void 0,i=typeof TextEncoder=="function"?new TextEncoder:void 0,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=Array.prototype.slice.call(s),a=function(_){var w={};return _.forEach(function(q,te){return w[q]=te}),w}(o),p=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,d=String.fromCharCode.bind(String),b=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):function(_){return new Uint8Array(Array.prototype.slice.call(_,0))},A=function(_){return _.replace(/=/g,"").replace(/[+\/]/g,function(w){return w=="+"?"-":"_"})},T=function(_){return _.replace(/[^A-Za-z0-9\+\/]/g,"")},S=function(_){for(var w,q,te,Pe,de="",mr=_.length%3,St=0;St<_.length;){if((q=_.charCodeAt(St++))>255||(te=_.charCodeAt(St++))>255||(Pe=_.charCodeAt(St++))>255)throw new TypeError("invalid character found");w=q<<16|te<<8|Pe,de+=o[w>>18&63]+o[w>>12&63]+o[w>>6&63]+o[w&63]}return mr?de.slice(0,mr-3)+"===".substring(mr):de},C=typeof btoa=="function"?function(_){return btoa(_)}:r?function(_){return Buffer.from(_,"binary").toString("base64")}:S,N=r?function(_){return Buffer.from(_).toString("base64")}:function(_){for(var w=4096,q=[],te=0,Pe=_.length;te<Pe;te+=w)q.push(d.apply(null,_.subarray(te,te+w)));return C(q.join(""))},O=function(_,w){return w===void 0&&(w=!1),w?A(N(_)):N(_)},y=function(_){if(_.length<2){var w=_.charCodeAt(0);return w<128?_:w<2048?d(192|w>>>6)+d(128|w&63):d(224|w>>>12&15)+d(128|w>>>6&63)+d(128|w&63)}else{var w=65536+(_.charCodeAt(0)-55296)*1024+(_.charCodeAt(1)-56320);return d(240|w>>>18&7)+d(128|w>>>12&63)+d(128|w>>>6&63)+d(128|w&63)}},m=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,c=function(_){return _.replace(m,y)},u=r?function(_){return Buffer.from(_,"utf8").toString("base64")}:i?function(_){return N(i.encode(_))}:function(_){return C(c(_))},g=function(_,w){return w===void 0&&(w=!1),w?A(u(_)):u(_)},l=function(_){return g(_,!0)},D=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,W=function(_){switch(_.length){case 4:var w=(7&_.charCodeAt(0))<<18|(63&_.charCodeAt(1))<<12|(63&_.charCodeAt(2))<<6|63&_.charCodeAt(3),q=w-65536;return d((q>>>10)+55296)+d((q&1023)+56320);case 3:return d((15&_.charCodeAt(0))<<12|(63&_.charCodeAt(1))<<6|63&_.charCodeAt(2));default:return d((31&_.charCodeAt(0))<<6|63&_.charCodeAt(1))}},Z=function(_){return _.replace(D,W)},be=function(_){if(_=_.replace(/\s+/g,""),!p.test(_))throw new TypeError("malformed base64.");_+="==".slice(2-(_.length&3));for(var w,q="",te,Pe,de=0;de<_.length;)w=a[_.charAt(de++)]<<18|a[_.charAt(de++)]<<12|(te=a[_.charAt(de++)])<<6|(Pe=a[_.charAt(de++)]),q+=te===64?d(w>>16&255):Pe===64?d(w>>16&255,w>>8&255):d(w>>16&255,w>>8&255,w&255);return q},ve=typeof atob=="function"?function(_){return atob(T(_))}:r?function(_){return Buffer.from(_,"base64").toString("binary")}:be,Ze=r?function(_){return b(Buffer.from(_,"base64"))}:function(_){return b(ve(_).split("").map(function(w){return w.charCodeAt(0)}))},vt=function(_){return Ze(Et(_))},Q=r?function(_){return Buffer.from(_,"base64").toString("utf8")}:n?function(_){return n.decode(Ze(_))}:function(_){return Z(ve(_))},Et=function(_){return T(_.replace(/[-_]/g,function(w){return w=="-"?"+":"/"}))},Ye=function(_){return Q(Et(_))},pr=function(_){if(typeof _!="string")return!1;var w=_.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(w)||!/[^\s0-9a-zA-Z\-_]/.test(w)},Li=function(_){return{value:_,enumerable:!1,writable:!0,configurable:!0}},Fi=function(){var _=function(w,q){return Object.defineProperty(String.prototype,w,Li(q))};_("fromBase64",function(){return Ye(this)}),_("toBase64",function(w){return g(this,w)}),_("toBase64URI",function(){return g(this,!0)}),_("toBase64URL",function(){return g(this,!0)}),_("toUint8Array",function(){return vt(this)})},Di=function(){var _=function(w,q){return Object.defineProperty(Uint8Array.prototype,w,Li(q))};_("toBase64",function(w){return O(this,w)}),_("toBase64URI",function(){return O(this,!0)}),_("toBase64URL",function(){return O(this,!0)})},oa=function(){Fi(),Di()},Xe={version:t,VERSION:e,atob:ve,atobPolyfill:be,btoa:C,btoaPolyfill:S,fromBase64:Ye,toBase64:g,encode:g,encodeURI:l,encodeURL:l,utob:c,btou:Z,decode:Ye,isValid:pr,fromUint8Array:O,toUint8Array:vt,extendString:Fi,extendUint8Array:Di,extendBuiltins:oa};return Xe.Base64={},Object.keys(Xe).forEach(function(_){return Xe.Base64[_]=Xe[_]}),Xe})});var is=E((rs,ns)=>{f();h();(function(t){if(typeof rs=="object")ns.exports=t();else if(typeof define=="function"&&define.amd)define(t);else{var e;try{e=self}catch{e=self}e.SparkMD5=t()}})(function(t){"use strict";var e=function(y,m){return y+m&4294967295},r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function n(y,m,c,u,g,l){return m=e(e(m,y),e(u,l)),e(m<<g|m>>>32-g,c)}function i(y,m){var c=y[0],u=y[1],g=y[2],l=y[3];c+=(u&g|~u&l)+m[0]-680876936|0,c=(c<<7|c>>>25)+u|0,l+=(c&u|~c&g)+m[1]-389564586|0,l=(l<<12|l>>>20)+c|0,g+=(l&c|~l&u)+m[2]+606105819|0,g=(g<<17|g>>>15)+l|0,u+=(g&l|~g&c)+m[3]-1044525330|0,u=(u<<22|u>>>10)+g|0,c+=(u&g|~u&l)+m[4]-176418897|0,c=(c<<7|c>>>25)+u|0,l+=(c&u|~c&g)+m[5]+1200080426|0,l=(l<<12|l>>>20)+c|0,g+=(l&c|~l&u)+m[6]-1473231341|0,g=(g<<17|g>>>15)+l|0,u+=(g&l|~g&c)+m[7]-45705983|0,u=(u<<22|u>>>10)+g|0,c+=(u&g|~u&l)+m[8]+1770035416|0,c=(c<<7|c>>>25)+u|0,l+=(c&u|~c&g)+m[9]-1958414417|0,l=(l<<12|l>>>20)+c|0,g+=(l&c|~l&u)+m[10]-42063|0,g=(g<<17|g>>>15)+l|0,u+=(g&l|~g&c)+m[11]-1990404162|0,u=(u<<22|u>>>10)+g|0,c+=(u&g|~u&l)+m[12]+1804603682|0,c=(c<<7|c>>>25)+u|0,l+=(c&u|~c&g)+m[13]-40341101|0,l=(l<<12|l>>>20)+c|0,g+=(l&c|~l&u)+m[14]-1502002290|0,g=(g<<17|g>>>15)+l|0,u+=(g&l|~g&c)+m[15]+1236535329|0,u=(u<<22|u>>>10)+g|0,c+=(u&l|g&~l)+m[1]-165796510|0,c=(c<<5|c>>>27)+u|0,l+=(c&g|u&~g)+m[6]-1069501632|0,l=(l<<9|l>>>23)+c|0,g+=(l&u|c&~u)+m[11]+643717713|0,g=(g<<14|g>>>18)+l|0,u+=(g&c|l&~c)+m[0]-373897302|0,u=(u<<20|u>>>12)+g|0,c+=(u&l|g&~l)+m[5]-701558691|0,c=(c<<5|c>>>27)+u|0,l+=(c&g|u&~g)+m[10]+38016083|0,l=(l<<9|l>>>23)+c|0,g+=(l&u|c&~u)+m[15]-660478335|0,g=(g<<14|g>>>18)+l|0,u+=(g&c|l&~c)+m[4]-405537848|0,u=(u<<20|u>>>12)+g|0,c+=(u&l|g&~l)+m[9]+568446438|0,c=(c<<5|c>>>27)+u|0,l+=(c&g|u&~g)+m[14]-1019803690|0,l=(l<<9|l>>>23)+c|0,g+=(l&u|c&~u)+m[3]-187363961|0,g=(g<<14|g>>>18)+l|0,u+=(g&c|l&~c)+m[8]+1163531501|0,u=(u<<20|u>>>12)+g|0,c+=(u&l|g&~l)+m[13]-1444681467|0,c=(c<<5|c>>>27)+u|0,l+=(c&g|u&~g)+m[2]-51403784|0,l=(l<<9|l>>>23)+c|0,g+=(l&u|c&~u)+m[7]+1735328473|0,g=(g<<14|g>>>18)+l|0,u+=(g&c|l&~c)+m[12]-1926607734|0,u=(u<<20|u>>>12)+g|0,c+=(u^g^l)+m[5]-378558|0,c=(c<<4|c>>>28)+u|0,l+=(c^u^g)+m[8]-2022574463|0,l=(l<<11|l>>>21)+c|0,g+=(l^c^u)+m[11]+1839030562|0,g=(g<<16|g>>>16)+l|0,u+=(g^l^c)+m[14]-35309556|0,u=(u<<23|u>>>9)+g|0,c+=(u^g^l)+m[1]-1530992060|0,c=(c<<4|c>>>28)+u|0,l+=(c^u^g)+m[4]+1272893353|0,l=(l<<11|l>>>21)+c|0,g+=(l^c^u)+m[7]-155497632|0,g=(g<<16|g>>>16)+l|0,u+=(g^l^c)+m[10]-1094730640|0,u=(u<<23|u>>>9)+g|0,c+=(u^g^l)+m[13]+681279174|0,c=(c<<4|c>>>28)+u|0,l+=(c^u^g)+m[0]-358537222|0,l=(l<<11|l>>>21)+c|0,g+=(l^c^u)+m[3]-722521979|0,g=(g<<16|g>>>16)+l|0,u+=(g^l^c)+m[6]+76029189|0,u=(u<<23|u>>>9)+g|0,c+=(u^g^l)+m[9]-640364487|0,c=(c<<4|c>>>28)+u|0,l+=(c^u^g)+m[12]-421815835|0,l=(l<<11|l>>>21)+c|0,g+=(l^c^u)+m[15]+530742520|0,g=(g<<16|g>>>16)+l|0,u+=(g^l^c)+m[2]-995338651|0,u=(u<<23|u>>>9)+g|0,c+=(g^(u|~l))+m[0]-198630844|0,c=(c<<6|c>>>26)+u|0,l+=(u^(c|~g))+m[7]+1126891415|0,l=(l<<10|l>>>22)+c|0,g+=(c^(l|~u))+m[14]-1416354905|0,g=(g<<15|g>>>17)+l|0,u+=(l^(g|~c))+m[5]-57434055|0,u=(u<<21|u>>>11)+g|0,c+=(g^(u|~l))+m[12]+1700485571|0,c=(c<<6|c>>>26)+u|0,l+=(u^(c|~g))+m[3]-1894986606|0,l=(l<<10|l>>>22)+c|0,g+=(c^(l|~u))+m[10]-1051523|0,g=(g<<15|g>>>17)+l|0,u+=(l^(g|~c))+m[1]-2054922799|0,u=(u<<21|u>>>11)+g|0,c+=(g^(u|~l))+m[8]+1873313359|0,c=(c<<6|c>>>26)+u|0,l+=(u^(c|~g))+m[15]-30611744|0,l=(l<<10|l>>>22)+c|0,g+=(c^(l|~u))+m[6]-1560198380|0,g=(g<<15|g>>>17)+l|0,u+=(l^(g|~c))+m[13]+1309151649|0,u=(u<<21|u>>>11)+g|0,c+=(g^(u|~l))+m[4]-145523070|0,c=(c<<6|c>>>26)+u|0,l+=(u^(c|~g))+m[11]-1120210379|0,l=(l<<10|l>>>22)+c|0,g+=(c^(l|~u))+m[2]+718787259|0,g=(g<<15|g>>>17)+l|0,u+=(l^(g|~c))+m[9]-343485551|0,u=(u<<21|u>>>11)+g|0,y[0]=c+y[0]|0,y[1]=u+y[1]|0,y[2]=g+y[2]|0,y[3]=l+y[3]|0}function s(y){var m=[],c;for(c=0;c<64;c+=4)m[c>>2]=y.charCodeAt(c)+(y.charCodeAt(c+1)<<8)+(y.charCodeAt(c+2)<<16)+(y.charCodeAt(c+3)<<24);return m}function o(y){var m=[],c;for(c=0;c<64;c+=4)m[c>>2]=y[c]+(y[c+1]<<8)+(y[c+2]<<16)+(y[c+3]<<24);return m}function a(y){var m=y.length,c=[1732584193,-271733879,-1732584194,271733878],u,g,l,D,W,Z;for(u=64;u<=m;u+=64)i(c,s(y.substring(u-64,u)));for(y=y.substring(u-64),g=y.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<g;u+=1)l[u>>2]|=y.charCodeAt(u)<<(u%4<<3);if(l[u>>2]|=128<<(u%4<<3),u>55)for(i(c,l),u=0;u<16;u+=1)l[u]=0;return D=m*8,D=D.toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(D[2],16),Z=parseInt(D[1],16)||0,l[14]=W,l[15]=Z,i(c,l),c}function p(y){var m=y.length,c=[1732584193,-271733879,-1732584194,271733878],u,g,l,D,W,Z;for(u=64;u<=m;u+=64)i(c,o(y.subarray(u-64,u)));for(y=u-64<m?y.subarray(u-64):new Uint8Array(0),g=y.length,l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],u=0;u<g;u+=1)l[u>>2]|=y[u]<<(u%4<<3);if(l[u>>2]|=128<<(u%4<<3),u>55)for(i(c,l),u=0;u<16;u+=1)l[u]=0;return D=m*8,D=D.toString(16).match(/(.*?)(.{0,8})$/),W=parseInt(D[2],16),Z=parseInt(D[1],16)||0,l[14]=W,l[15]=Z,i(c,l),c}function d(y){var m="",c;for(c=0;c<4;c+=1)m+=r[y>>c*8+4&15]+r[y>>c*8&15];return m}function b(y){var m;for(m=0;m<y.length;m+=1)y[m]=d(y[m]);return y.join("")}b(a("hello"))!=="5d41402abc4b2a76b9719d911017c592"&&(e=function(y,m){var c=(y&65535)+(m&65535),u=(y>>16)+(m>>16)+(c>>16);return u<<16|c&65535}),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function y(m,c){return m=m|0||0,m<0?Math.max(m+c,0):Math.min(m,c)}ArrayBuffer.prototype.slice=function(m,c){var u=this.byteLength,g=y(m,u),l=u,D,W,Z,be;return c!==t&&(l=y(c,u)),g>l?new ArrayBuffer(0):(D=l-g,W=new ArrayBuffer(D),Z=new Uint8Array(W),be=new Uint8Array(this,g,D),Z.set(be),W)}}();function A(y){return/[\u0080-\uFFFF]/.test(y)&&(y=unescape(encodeURIComponent(y))),y}function T(y,m){var c=y.length,u=new ArrayBuffer(c),g=new Uint8Array(u),l;for(l=0;l<c;l+=1)g[l]=y.charCodeAt(l);return m?g:u}function S(y){return String.fromCharCode.apply(null,new Uint8Array(y))}function C(y,m,c){var u=new Uint8Array(y.byteLength+m.byteLength);return u.set(new Uint8Array(y)),u.set(new Uint8Array(m),y.byteLength),c?u:u.buffer}function N(y){var m=[],c=y.length,u;for(u=0;u<c-1;u+=2)m.push(parseInt(y.substr(u,2),16));return String.fromCharCode.apply(String,m)}function O(){this.reset()}return O.prototype.append=function(y){return this.appendBinary(A(y)),this},O.prototype.appendBinary=function(y){this._buff+=y,this._length+=y.length;var m=this._buff.length,c;for(c=64;c<=m;c+=64)i(this._hash,s(this._buff.substring(c-64,c)));return this._buff=this._buff.substring(c-64),this},O.prototype.end=function(y){var m=this._buff,c=m.length,u,g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],l;for(u=0;u<c;u+=1)g[u>>2]|=m.charCodeAt(u)<<(u%4<<3);return this._finish(g,c),l=b(this._hash),y&&(l=N(l)),this.reset(),l},O.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},O.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},O.prototype.setState=function(y){return this._buff=y.buff,this._length=y.length,this._hash=y.hash,this},O.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},O.prototype._finish=function(y,m){var c=m,u,g,l;if(y[c>>2]|=128<<(c%4<<3),c>55)for(i(this._hash,y),c=0;c<16;c+=1)y[c]=0;u=this._length*8,u=u.toString(16).match(/(.*?)(.{0,8})$/),g=parseInt(u[2],16),l=parseInt(u[1],16)||0,y[14]=g,y[15]=l,i(this._hash,y)},O.hash=function(y,m){return O.hashBinary(A(y),m)},O.hashBinary=function(y,m){var c=a(y),u=b(c);return m?N(u):u},O.ArrayBuffer=function(){this.reset()},O.ArrayBuffer.prototype.append=function(y){var m=C(this._buff.buffer,y,!0),c=m.length,u;for(this._length+=y.byteLength,u=64;u<=c;u+=64)i(this._hash,o(m.subarray(u-64,u)));return this._buff=u-64<c?new Uint8Array(m.buffer.slice(u-64)):new Uint8Array(0),this},O.ArrayBuffer.prototype.end=function(y){var m=this._buff,c=m.length,u=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],g,l;for(g=0;g<c;g+=1)u[g>>2]|=m[g]<<(g%4<<3);return this._finish(u,c),l=b(this._hash),y&&(l=N(l)),this.reset(),l},O.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},O.ArrayBuffer.prototype.getState=function(){var y=O.prototype.getState.call(this);return y.buff=S(y.buff),y},O.ArrayBuffer.prototype.setState=function(y){return y.buff=T(y.buff,!0),O.prototype.setState.call(this,y)},O.ArrayBuffer.prototype.destroy=O.prototype.destroy,O.ArrayBuffer.prototype._finish=O.prototype._finish,O.ArrayBuffer.hash=function(y,m){var c=p(new Uint8Array(y)),u=b(c);return m?N(u):u},O})});var he=E(Se=>{"use strict";f();h();Object.defineProperty(Se,"__esModule",{value:!0});Se.getMD5Hash=Ir;Se.encodeBase64=ie;Se.attributeEncodeBase64=as;Se.decodeBase64=Ia;Se.obfuscatePrecomputedBanditMap=Na;Se.obfuscatePrecomputedFlags=La;var os=Or(),Oa=is();function Ir(t,e=""){return new Oa().append(e).append(t).end()}function ie(t){return os.encode(t)}function as(t){return ie(typeof t!="string"?String(t):t)}function Ia(t){return os.decode(t)}function Na(t,e){return Object.fromEntries(Object.entries(e).map(([r,n])=>[Ir(r,t),Pa(n)]))}function Pa(t){return{banditKey:ie(t.banditKey),action:ie(t.action),actionProbability:t.actionProbability,optimalityGap:t.optimalityGap,modelVersion:ie(t.modelVersion),actionNumericAttributes:ss(t.actionNumericAttributes),actionCategoricalAttributes:ss(t.actionCategoricalAttributes)}}function ss(t){return Object.fromEntries(Object.entries(t).map(([e,r])=>[ie(e),as(r)]))}function La(t,e){let r={};return Object.keys(e).forEach(n=>{let i=e[n],s=Object.fromEntries(Object.entries(i.extraLogging??{}).map(a=>a.map(ie))),o=Ir(n,t);r[o]={flagKey:o,variationType:i.variationType,extraLogging:s,doLog:i.doLog,allocationKey:ie(i.allocationKey??""),variationKey:ie(i.variationKey??""),variationValue:ie(i.variationValue)}}),r}});var it=E(Ke=>{"use strict";f();h();Object.defineProperty(Ke,"__esModule",{value:!0});Ke.AbstractAssignmentCache=void 0;Ke.assignmentCacheKeyToString=Nr;Ke.assignmentCacheValueToString=Pr;var us=he();function Nr({subjectKey:t,flagKey:e}){return(0,us.getMD5Hash)([t,e].join(";"))}function Pr(t){return(0,us.getMD5Hash)(Object.values(t).join(";"))}var Lr=class{constructor(e){this.delegate=e}has(e){return this.get(e)===Pr(e)}get(e){return this.delegate.get(Nr(e))}set(e){this.delegate.set(Nr(e),Pr(e))}entries(){return this.delegate.entries()}};Ke.AbstractAssignmentCache=Lr});var Dr=E(Ot=>{"use strict";f();h();Object.defineProperty(Ot,"__esModule",{value:!0});Ot.LRUCache=void 0;var Fr=class{constructor(e){this.capacity=e,this.cache=new Map,this.size=this.cache.size}[Symbol.iterator](){return this.cache[Symbol.iterator]()}forEach(e,r){this.cache.forEach(e,r)}entries(){return this.cache.entries()}clear(){this.cache.clear()}delete(e){return this.cache.delete(e)}keys(){return this.cache.keys()}values(){return this.cache.values()}has(e){return this.cache.has(e)}get(e){if(!this.has(e))return;let r=this.cache.get(e);return r!==void 0&&(this.delete(e),this.cache.set(e,r)),r}set(e,r){if(this.capacity===0)return this;if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.capacity){let n=this.cache.keys().next().value;n&&this.delete(n)}return this.cache.set(e,r),this}};Ot.LRUCache=Fr});var Nt=E(It=>{"use strict";f();h();Object.defineProperty(It,"__esModule",{value:!0});It.LRUInMemoryAssignmentCache=void 0;var Fa=it(),Da=Dr(),Mr=class extends Fa.AbstractAssignmentCache{constructor(e){super(new Da.LRUCache(e))}};It.LRUInMemoryAssignmentCache=Mr});var Lt=E(Pt=>{"use strict";f();h();Object.defineProperty(Pt,"__esModule",{value:!0});Pt.NonExpiringInMemoryAssignmentCache=void 0;var Ma=it(),Rr=class extends Ma.AbstractAssignmentCache{constructor(e=new Map){super(e)}};Pt.NonExpiringInMemoryAssignmentCache=Rr});var cs=E(xr=>{"use strict";f();h();Object.defineProperty(xr,"__esModule",{value:!0});xr.default="ffffffff-ffff-ffff-ffff-ffffffffffff"});var ls=E(jr=>{"use strict";f();h();Object.defineProperty(jr,"__esModule",{value:!0});jr.default="00000000-0000-0000-0000-000000000000"});var ds=E(Ur=>{"use strict";f();h();Object.defineProperty(Ur,"__esModule",{value:!0});Ur.default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i});var st=E(qr=>{"use strict";f();h();Object.defineProperty(qr,"__esModule",{value:!0});var Ra=ds();function xa(t){return typeof t=="string"&&Ra.default.test(t)}qr.default=xa});var ot=E(Br=>{"use strict";f();h();Object.defineProperty(Br,"__esModule",{value:!0});var ja=st();function Ua(t){if(!(0,ja.default)(t))throw TypeError("Invalid UUID");let e;return Uint8Array.of((e=parseInt(t.slice(0,8),16))>>>24,e>>>16&255,e>>>8&255,e&255,(e=parseInt(t.slice(9,13),16))>>>8,e&255,(e=parseInt(t.slice(14,18),16))>>>8,e&255,(e=parseInt(t.slice(19,23),16))>>>8,e&255,(e=parseInt(t.slice(24,36),16))/1099511627776&255,e/4294967296&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255)}Br.default=Ua});var pe=E(at=>{"use strict";f();h();Object.defineProperty(at,"__esModule",{value:!0});at.unsafeStringify=void 0;var qa=st(),B=[];for(let t=0;t<256;++t)B.push((t+256).toString(16).slice(1));function gs(t,e=0){return(B[t[e+0]]+B[t[e+1]]+B[t[e+2]]+B[t[e+3]]+"-"+B[t[e+4]]+B[t[e+5]]+"-"+B[t[e+6]]+B[t[e+7]]+"-"+B[t[e+8]]+B[t[e+9]]+"-"+B[t[e+10]]+B[t[e+11]]+B[t[e+12]]+B[t[e+13]]+B[t[e+14]]+B[t[e+15]]).toLowerCase()}at.unsafeStringify=gs;function Ba(t,e=0){let r=gs(t,e);if(!(0,qa.default)(r))throw TypeError("Stringified UUID is invalid");return r}at.default=Ba});var Ft=E(kr=>{"use strict";f();h();Object.defineProperty(kr,"__esModule",{value:!0});var Vr,Va=new Uint8Array(16);function ka(){if(!Vr){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Vr=self.crypto.getRandomValues.bind(self.crypto)}return Vr(Va)}kr.default=ka});var zr=E(ct=>{"use strict";f();h();Object.defineProperty(ct,"__esModule",{value:!0});ct.updateV1State=void 0;var fs=Ft(),za=pe(),ut={};function Ka(t,e,r){let n,i=t?._v6??!1;if(t){let s=Object.keys(t);s.length===1&&s[0]==="_v6"&&(t=void 0)}if(t)n=hs(t.random??t.rng?.()??(0,fs.default)(),t.msecs,t.nsecs,t.clockseq,t.node,e,r);else{let s=Date.now(),o=(0,fs.default)();ps(ut,s,o),n=hs(o,ut.msecs,ut.nsecs,i?void 0:ut.clockseq,i?void 0:ut.node,e,r)}return e?n:(0,za.unsafeStringify)(n)}function ps(t,e,r){return t.msecs??=-1/0,t.nsecs??=0,e===t.msecs?(t.nsecs++,t.nsecs>=1e4&&(t.node=void 0,t.nsecs=0)):e>t.msecs?t.nsecs=0:e<t.msecs&&(t.node=void 0),t.node||(t.node=r.slice(10,16),t.node[0]|=1,t.clockseq=(r[8]<<8|r[9])&16383),t.msecs=e,t}ct.updateV1State=ps;function hs(t,e,r,n,i,s,o=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(!s)s=new Uint8Array(16),o=0;else if(o<0||o+16>s.length)throw new RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);e??=Date.now(),r??=0,n??=(t[8]<<8|t[9])&16383,i??=t.slice(10,16),e+=122192928e5;let a=((e&268435455)*1e4+r)%4294967296;s[o++]=a>>>24&255,s[o++]=a>>>16&255,s[o++]=a>>>8&255,s[o++]=a&255;let p=e/4294967296*1e4&268435455;s[o++]=p>>>8&255,s[o++]=p&255,s[o++]=p>>>24&15|16,s[o++]=p>>>16&255,s[o++]=n>>>8|128,s[o++]=n&255;for(let d=0;d<6;++d)s[o++]=i[d];return s}ct.default=Ka});var $r=E(Kr=>{"use strict";f();h();Object.defineProperty(Kr,"__esModule",{value:!0});var $a=ot(),Ga=pe();function Ha(t){let e=typeof t=="string"?(0,$a.default)(t):t,r=Ja(e);return typeof t=="string"?(0,Ga.unsafeStringify)(r):r}Kr.default=Ha;function Ja(t){return Uint8Array.of((t[6]&15)<<4|t[7]>>4&15,(t[7]&15)<<4|(t[4]&240)>>4,(t[4]&15)<<4|(t[5]&240)>>4,(t[5]&15)<<4|(t[0]&240)>>4,(t[0]&15)<<4|(t[1]&240)>>4,(t[1]&15)<<4|(t[2]&240)>>4,96|t[2]&15,t[3],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}});var ys=E(Gr=>{"use strict";f();h();Object.defineProperty(Gr,"__esModule",{value:!0});function Qa(t){let e=Ya(t),r=Za(e,t.length*8);return Wa(r)}function Wa(t){let e=new Uint8Array(t.length*4);for(let r=0;r<t.length*4;r++)e[r]=t[r>>2]>>>r%4*8&255;return e}function ms(t){return(t+64>>>9<<4)+14+1}function Za(t,e){let r=new Uint32Array(ms(e)).fill(0);r.set(t),r[e>>5]|=128<<e%32,r[r.length-1]=e,t=r;let n=1732584193,i=-271733879,s=-1732584194,o=271733878;for(let a=0;a<t.length;a+=16){let p=n,d=i,b=s,A=o;n=z(n,i,s,o,t[a],7,-680876936),o=z(o,n,i,s,t[a+1],12,-389564586),s=z(s,o,n,i,t[a+2],17,606105819),i=z(i,s,o,n,t[a+3],22,-1044525330),n=z(n,i,s,o,t[a+4],7,-176418897),o=z(o,n,i,s,t[a+5],12,1200080426),s=z(s,o,n,i,t[a+6],17,-1473231341),i=z(i,s,o,n,t[a+7],22,-45705983),n=z(n,i,s,o,t[a+8],7,1770035416),o=z(o,n,i,s,t[a+9],12,-1958414417),s=z(s,o,n,i,t[a+10],17,-42063),i=z(i,s,o,n,t[a+11],22,-1990404162),n=z(n,i,s,o,t[a+12],7,1804603682),o=z(o,n,i,s,t[a+13],12,-40341101),s=z(s,o,n,i,t[a+14],17,-1502002290),i=z(i,s,o,n,t[a+15],22,1236535329),n=K(n,i,s,o,t[a+1],5,-165796510),o=K(o,n,i,s,t[a+6],9,-1069501632),s=K(s,o,n,i,t[a+11],14,643717713),i=K(i,s,o,n,t[a],20,-373897302),n=K(n,i,s,o,t[a+5],5,-701558691),o=K(o,n,i,s,t[a+10],9,38016083),s=K(s,o,n,i,t[a+15],14,-660478335),i=K(i,s,o,n,t[a+4],20,-405537848),n=K(n,i,s,o,t[a+9],5,568446438),o=K(o,n,i,s,t[a+14],9,-1019803690),s=K(s,o,n,i,t[a+3],14,-187363961),i=K(i,s,o,n,t[a+8],20,1163531501),n=K(n,i,s,o,t[a+13],5,-1444681467),o=K(o,n,i,s,t[a+2],9,-51403784),s=K(s,o,n,i,t[a+7],14,1735328473),i=K(i,s,o,n,t[a+12],20,-1926607734),n=$(n,i,s,o,t[a+5],4,-378558),o=$(o,n,i,s,t[a+8],11,-2022574463),s=$(s,o,n,i,t[a+11],16,1839030562),i=$(i,s,o,n,t[a+14],23,-35309556),n=$(n,i,s,o,t[a+1],4,-1530992060),o=$(o,n,i,s,t[a+4],11,1272893353),s=$(s,o,n,i,t[a+7],16,-155497632),i=$(i,s,o,n,t[a+10],23,-1094730640),n=$(n,i,s,o,t[a+13],4,681279174),o=$(o,n,i,s,t[a],11,-358537222),s=$(s,o,n,i,t[a+3],16,-722521979),i=$(i,s,o,n,t[a+6],23,76029189),n=$(n,i,s,o,t[a+9],4,-640364487),o=$(o,n,i,s,t[a+12],11,-421815835),s=$(s,o,n,i,t[a+15],16,530742520),i=$(i,s,o,n,t[a+2],23,-995338651),n=G(n,i,s,o,t[a],6,-198630844),o=G(o,n,i,s,t[a+7],10,1126891415),s=G(s,o,n,i,t[a+14],15,-1416354905),i=G(i,s,o,n,t[a+5],21,-57434055),n=G(n,i,s,o,t[a+12],6,1700485571),o=G(o,n,i,s,t[a+3],10,-1894986606),s=G(s,o,n,i,t[a+10],15,-1051523),i=G(i,s,o,n,t[a+1],21,-2054922799),n=G(n,i,s,o,t[a+8],6,1873313359),o=G(o,n,i,s,t[a+15],10,-30611744),s=G(s,o,n,i,t[a+6],15,-1560198380),i=G(i,s,o,n,t[a+13],21,1309151649),n=G(n,i,s,o,t[a+4],6,-145523070),o=G(o,n,i,s,t[a+11],10,-1120210379),s=G(s,o,n,i,t[a+2],15,718787259),i=G(i,s,o,n,t[a+9],21,-343485551),n=Ae(n,p),i=Ae(i,d),s=Ae(s,b),o=Ae(o,A)}return Uint32Array.of(n,i,s,o)}function Ya(t){if(t.length===0)return new Uint32Array;let e=new Uint32Array(ms(t.length*8)).fill(0);for(let r=0;r<t.length;r++)e[r>>2]|=(t[r]&255)<<r%4*8;return e}function Ae(t,e){let r=(t&65535)+(e&65535);return(t>>16)+(e>>16)+(r>>16)<<16|r&65535}function Xa(t,e){return t<<e|t>>>32-e}function Dt(t,e,r,n,i,s){return Ae(Xa(Ae(Ae(e,t),Ae(n,s)),i),r)}function z(t,e,r,n,i,s,o){return Dt(e&r|~e&n,t,e,i,s,o)}function K(t,e,r,n,i,s,o){return Dt(e&n|r&~n,t,e,i,s,o)}function $(t,e,r,n,i,s,o){return Dt(e^r^n,t,e,i,s,o)}function G(t,e,r,n,i,s,o){return Dt(r^(e|~n),t,e,i,s,o)}Gr.default=Qa});var lt=E(me=>{"use strict";f();h();Object.defineProperty(me,"__esModule",{value:!0});me.URL=me.DNS=me.stringToBytes=void 0;var _s=ot(),eu=pe();function bs(t){t=unescape(encodeURIComponent(t));let e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r);return e}me.stringToBytes=bs;me.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";me.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function tu(t,e,r,n,i,s){let o=typeof r=="string"?bs(r):r,a=typeof n=="string"?(0,_s.default)(n):n;if(typeof n=="string"&&(n=(0,_s.default)(n)),n?.length!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let p=new Uint8Array(16+o.length);if(p.set(a),p.set(o,a.length),p=e(p),p[6]=p[6]&15|t,p[8]=p[8]&63|128,i){s=s||0;for(let d=0;d<16;++d)i[s+d]=p[d];return i}return(0,eu.unsafeStringify)(p)}me.default=tu});var Es=E(Fe=>{"use strict";f();h();Object.defineProperty(Fe,"__esModule",{value:!0});Fe.URL=Fe.DNS=void 0;var ru=ys(),Hr=lt(),vs=lt();Object.defineProperty(Fe,"DNS",{enumerable:!0,get:function(){return vs.DNS}});Object.defineProperty(Fe,"URL",{enumerable:!0,get:function(){return vs.URL}});function Jr(t,e,r,n){return(0,Hr.default)(48,ru.default,t,e,r,n)}Jr.DNS=Hr.DNS;Jr.URL=Hr.URL;Fe.default=Jr});var Ss=E(Qr=>{"use strict";f();h();Object.defineProperty(Qr,"__esModule",{value:!0});var nu=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto);Qr.default={randomUUID:nu}});var Cs=E(Wr=>{"use strict";f();h();Object.defineProperty(Wr,"__esModule",{value:!0});var As=Ss(),iu=Ft(),su=pe();function ou(t,e,r){if(As.default.randomUUID&&!e&&!t)return As.default.randomUUID();t=t||{};let n=t.random??t.rng?.()??(0,iu.default)();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,e){if(r=r||0,r<0||r+16>e.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let i=0;i<16;++i)e[r+i]=n[i];return e}return(0,su.unsafeStringify)(n)}Wr.default=ou});var ws=E(Yr=>{"use strict";f();h();Object.defineProperty(Yr,"__esModule",{value:!0});function au(t,e,r,n){switch(t){case 0:return e&r^~e&n;case 1:return e^r^n;case 2:return e&r^e&n^r&n;case 3:return e^r^n}}function Zr(t,e){return t<<e|t>>>32-e}function uu(t){let e=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520],n=new Uint8Array(t.length+1);n.set(t),n[t.length]=128,t=n;let i=t.length/4+2,s=Math.ceil(i/16),o=new Array(s);for(let a=0;a<s;++a){let p=new Uint32Array(16);for(let d=0;d<16;++d)p[d]=t[a*64+d*4]<<24|t[a*64+d*4+1]<<16|t[a*64+d*4+2]<<8|t[a*64+d*4+3];o[a]=p}o[s-1][14]=(t.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(t.length-1)*8&4294967295;for(let a=0;a<s;++a){let p=new Uint32Array(80);for(let C=0;C<16;++C)p[C]=o[a][C];for(let C=16;C<80;++C)p[C]=Zr(p[C-3]^p[C-8]^p[C-14]^p[C-16],1);let d=r[0],b=r[1],A=r[2],T=r[3],S=r[4];for(let C=0;C<80;++C){let N=Math.floor(C/20),O=Zr(d,5)+au(N,b,A,T)+S+e[N]+p[C]>>>0;S=T,T=A,A=Zr(b,30)>>>0,b=d,d=O}r[0]=r[0]+d>>>0,r[1]=r[1]+b>>>0,r[2]=r[2]+A>>>0,r[3]=r[3]+T>>>0,r[4]=r[4]+S>>>0}return Uint8Array.of(r[0]>>24,r[0]>>16,r[0]>>8,r[0],r[1]>>24,r[1]>>16,r[1]>>8,r[1],r[2]>>24,r[2]>>16,r[2]>>8,r[2],r[3]>>24,r[3]>>16,r[3]>>8,r[3],r[4]>>24,r[4]>>16,r[4]>>8,r[4])}Yr.default=uu});var Os=E(De=>{"use strict";f();h();Object.defineProperty(De,"__esModule",{value:!0});De.URL=De.DNS=void 0;var cu=ws(),Xr=lt(),Ts=lt();Object.defineProperty(De,"DNS",{enumerable:!0,get:function(){return Ts.DNS}});Object.defineProperty(De,"URL",{enumerable:!0,get:function(){return Ts.URL}});function en(t,e,r,n){return(0,Xr.default)(80,cu.default,t,e,r,n)}en.DNS=Xr.DNS;en.URL=Xr.URL;De.default=en});var Is=E(tn=>{"use strict";f();h();Object.defineProperty(tn,"__esModule",{value:!0});var lu=pe(),du=zr(),gu=$r();function fu(t,e,r){t??={},r??=0;let n=(0,du.default)({...t,_v6:!0},new Uint8Array(16));if(n=(0,gu.default)(n),e){for(let i=0;i<16;i++)e[r+i]=n[i];return e}return(0,lu.unsafeStringify)(n)}tn.default=fu});var Ns=E(rn=>{"use strict";f();h();Object.defineProperty(rn,"__esModule",{value:!0});var hu=ot(),pu=pe();function mu(t){let e=typeof t=="string"?(0,hu.default)(t):t,r=yu(e);return typeof t=="string"?(0,pu.unsafeStringify)(r):r}rn.default=mu;function yu(t){return Uint8Array.of((t[3]&15)<<4|t[4]>>4&15,(t[4]&15)<<4|(t[5]&240)>>4,(t[5]&15)<<4|t[6]&15,t[7],(t[1]&15)<<4|(t[2]&240)>>4,(t[2]&15)<<4|(t[3]&240)>>4,16|(t[0]&240)>>4,(t[0]&15)<<4|(t[1]&240)>>4,t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}});var Ds=E(dt=>{"use strict";f();h();Object.defineProperty(dt,"__esModule",{value:!0});dt.updateV7State=void 0;var Ps=Ft(),_u=pe(),nn={};function bu(t,e,r){let n;if(t)n=Ls(t.random??t.rng?.()??(0,Ps.default)(),t.msecs,t.seq,e,r);else{let i=Date.now(),s=(0,Ps.default)();Fs(nn,i,s),n=Ls(s,nn.msecs,nn.seq,e,r)}return e?n:(0,_u.unsafeStringify)(n)}function Fs(t,e,r){return t.msecs??=-1/0,t.seq??=0,e>t.msecs?(t.seq=r[6]<<23|r[7]<<16|r[8]<<8|r[9],t.msecs=e):(t.seq=t.seq+1|0,t.seq===0&&t.msecs++),t}dt.updateV7State=Fs;function Ls(t,e,r,n,i=0){if(t.length<16)throw new Error("Random bytes length must be >= 16");if(!n)n=new Uint8Array(16),i=0;else if(i<0||i+16>n.length)throw new RangeError(`UUID byte range ${i}:${i+15} is out of buffer bounds`);return e??=Date.now(),r??=t[6]*127<<24|t[7]<<16|t[8]<<8|t[9],n[i++]=e/1099511627776&255,n[i++]=e/4294967296&255,n[i++]=e/16777216&255,n[i++]=e/65536&255,n[i++]=e/256&255,n[i++]=e&255,n[i++]=112|r>>>28&15,n[i++]=r>>>20&255,n[i++]=128|r>>>14&63,n[i++]=r>>>6&255,n[i++]=r<<2&255|t[10]&3,n[i++]=t[11],n[i++]=t[12],n[i++]=t[13],n[i++]=t[14],n[i++]=t[15],n}dt.default=bu});var Ms=E(sn=>{"use strict";f();h();Object.defineProperty(sn,"__esModule",{value:!0});var vu=st();function Eu(t){if(!(0,vu.default)(t))throw TypeError("Invalid UUID");return parseInt(t.slice(14,15),16)}sn.default=Eu});var Rs=E(L=>{"use strict";f();h();Object.defineProperty(L,"__esModule",{value:!0});L.version=L.validate=L.v7=L.v6ToV1=L.v6=L.v5=L.v4=L.v3=L.v1ToV6=L.v1=L.stringify=L.parse=L.NIL=L.MAX=void 0;var Su=cs();Object.defineProperty(L,"MAX",{enumerable:!0,get:function(){return Su.default}});var Au=ls();Object.defineProperty(L,"NIL",{enumerable:!0,get:function(){return Au.default}});var Cu=ot();Object.defineProperty(L,"parse",{enumerable:!0,get:function(){return Cu.default}});var wu=pe();Object.defineProperty(L,"stringify",{enumerable:!0,get:function(){return wu.default}});var Tu=zr();Object.defineProperty(L,"v1",{enumerable:!0,get:function(){return Tu.default}});var Ou=$r();Object.defineProperty(L,"v1ToV6",{enumerable:!0,get:function(){return Ou.default}});var Iu=Es();Object.defineProperty(L,"v3",{enumerable:!0,get:function(){return Iu.default}});var Nu=Cs();Object.defineProperty(L,"v4",{enumerable:!0,get:function(){return Nu.default}});var Pu=Os();Object.defineProperty(L,"v5",{enumerable:!0,get:function(){return Pu.default}});var Lu=Is();Object.defineProperty(L,"v6",{enumerable:!0,get:function(){return Lu.default}});var Fu=Ns();Object.defineProperty(L,"v6ToV1",{enumerable:!0,get:function(){return Fu.default}});var Du=Ds();Object.defineProperty(L,"v7",{enumerable:!0,get:function(){return Du.default}});var Mu=st();Object.defineProperty(L,"validate",{enumerable:!0,get:function(){return Mu.default}});var Ru=Ms();Object.defineProperty(L,"version",{enumerable:!0,get:function(){return Ru.default}})});var an=E(Me=>{"use strict";f();h();Object.defineProperty(Me,"__esModule",{value:!0});Me.isInstanceOfContextualAttributes=Mt;Me.ensureNonContextualSubjectAttributes=xu;Me.ensureContextualSubjectAttributes=ju;Me.deduceAttributeContext=on;Me.ensureActionsWithContextualAttributes=Uu;function Mt(t){return!!(typeof t=="object"&&t&&"numericAttributes"in t&&"categoricalAttributes"in t)}function xu(t){let e;if(Mt(t)){let r=t;e={...r.numericAttributes,...r.categoricalAttributes}}else e=t;return e}function ju(t){return Mt(t)?t:on(t)}function on(t){let e={numericAttributes:{},categoricalAttributes:{}};return Object.entries(t).forEach(([r,n])=>{typeof n=="number"?e.numericAttributes[r]=n:e.categoricalAttributes[r]=n}),e}function Uu(t){let e={};return Array.isArray(t)?t.forEach(r=>{e[r]={numericAttributes:{},categoricalAttributes:{}}}):Object.values(t).every(Mt)?e=t:Object.entries(t).forEach(([r,n])=>{e[r]=on(n)}),e}});var ln=E(Ce=>{"use strict";f();h();Object.defineProperty(Ce,"__esModule",{value:!0});Ce.DeterministicSharder=Ce.MD5Sharder=Ce.Sharder=void 0;var qu=he(),gt=class{};Ce.Sharder=gt;var un=class extends gt{getShard(e,r){let n=(0,qu.getMD5Hash)(e);return parseInt(n.slice(0,8),16)%r}};Ce.MD5Sharder=un;var cn=class extends gt{constructor(e){super(),this.lookup=e}getShard(e,r){return this.lookup[e]??0}};Ce.DeterministicSharder=cn});var xs=E(Rt=>{"use strict";f();h();Object.defineProperty(Rt,"__esModule",{value:!0});Rt.BanditEvaluator=void 0;var Bu=ge(),Vu=ln(),dn=class{constructor(){this.assignmentShards=Bu.BANDIT_ASSIGNMENT_SHARDS,this.sharder=new Vu.MD5Sharder}evaluateBestBanditAction(e,r,n){let i=this.scoreActions(e,r,n),{topAction:s}=this.getTopScore(i);return s}evaluateBandit(e,r,n,i,s){let o=this.scoreActions(n,i,s),a=this.weighActions(o,s.gamma,s.actionProbabilityFloor),p=this.selectAction(e,r,a),b=Object.values(o).reduce((A,T)=>T>A?T:A,-1/0)-o[p];return{flagKey:e,subjectKey:r,subjectAttributes:n,actionKey:p,actionAttributes:i[p],actionScore:o[p],actionWeight:a[p],gamma:s.gamma,optimalityGap:b}}scoreActions(e,r,n){let i={};return Object.entries(r).forEach(([s,o])=>{let a=n.defaultActionScore,p=n.coefficients[s];p&&(a=p.intercept,a+=this.scoreNumericAttributes(p.subjectNumericCoefficients,e.numericAttributes),a+=this.scoreCategoricalAttributes(p.subjectCategoricalCoefficients,e.categoricalAttributes),a+=this.scoreNumericAttributes(p.actionNumericCoefficients,o.numericAttributes),a+=this.scoreCategoricalAttributes(p.actionCategoricalCoefficients,o.categoricalAttributes)),i[s]=a}),i}scoreNumericAttributes(e,r){return e.reduce((n,i)=>{let s=r[i.attributeKey];return typeof s=="number"&&isFinite(s)?n+=s*i.coefficient:n+=i.missingValueCoefficient,n},0)}scoreCategoricalAttributes(e,r){return e.reduce((n,i)=>{let s=r[i.attributeKey]?.toString(),o=s&&i.valueCoefficients[s];return n+=typeof o=="number"?o:i.missingValueCoefficient,n},0)}weighActions(e,r,n){let i={},s=Object.entries(e);if(!s.length)return i;let{topScore:o,topAction:a}=this.getTopScore(e);if(o===null||a===null)throw new Error("Unable to find top score");let p=o,d=a,b=s.length,A=n/b,T=0;return s.forEach(([S,C])=>{if(S===d)return;let N=1/(b+r*(p-C)),O=Math.max(N,A);T+=O,i[S]=O}),i[d]=Math.max(1-T,0),i}selectAction(e,r,n){let i=Object.entries(n).sort((d,b)=>{let A=this.sharder.getShard(`${e}-${r}-${d[0]}`,this.assignmentShards),T=this.sharder.getShard(`${e}-${r}-${b[0]}`,this.assignmentShards),S=A-T;return S===0&&(S=d[0]<b[0]?-1:1),S}),o=this.sharder.getShard(`${e}-${r}`,this.assignmentShards)/this.assignmentShards,a=0,p=null;for(let d of i)if(a+=d[1],a>o){p=d[0];break}if(p===null)throw new Error(`No bandit action selected for flag "${e}" and subject "${r}"`);return p}getTopScore(e){let r=Object.entries(e),n=null,i=null;return r.forEach(([s,o])=>{(n===null||i===null||o>n||o===n&&s<i)&&(n=o,i=s)}),{topScore:n,topAction:i}}};Rt.BanditEvaluator=dn});var js=E(xt=>{"use strict";f();h();Object.defineProperty(xt,"__esModule",{value:!0});xt.TLRUCache=void 0;var ku=Dr(),gn=class extends ku.LRUCache{constructor(e,r){super(e),this.maxSize=e,this.ttl=r,this.cacheEntriesTTLRegistry=new Map}getCacheEntryEvictionTime(){return new Date(Date.now()+this.ttl)}clearCacheEntryEvictionTimeIfExists(e){this.cacheEntriesTTLRegistry.has(e)&&this.cacheEntriesTTLRegistry.delete(e)}isCacheEntryValid(e){let r=new Date(Date.now()),n=this.cacheEntriesTTLRegistry.get(e);return n!==void 0?r<n:!1}setCacheEntryEvictionTime(e){this.cacheEntriesTTLRegistry.set(e,this.getCacheEntryEvictionTime())}resetCacheEntryEvictionTime(e){this.clearCacheEntryEvictionTimeIfExists(e),this.setCacheEntryEvictionTime(e)}evictExpiredCacheEntries(){let e;for(e of this.cache.keys())if(!this.isCacheEntryValid(e))this.delete(e);else break}entries(){return this.evictExpiredCacheEntries(),super.entries()}keys(){return this.evictExpiredCacheEntries(),super.keys()}values(){return this.evictExpiredCacheEntries(),super.values()}delete(e){return this.clearCacheEntryEvictionTimeIfExists(e),super.delete(e)}has(e){return this.isCacheEntryValid(e)?this.cache.has(e):(this.delete(e),!1)}get(e){if(!this.isCacheEntryValid(e)){this.delete(e);return}let r=super.get(e);return r!==void 0&&this.resetCacheEntryEvictionTime(e),r}set(e,r){let n=super.set(e,r);return this.resetCacheEntryEvictionTime(e),n}};xt.TLRUCache=gn});var Us=E(jt=>{"use strict";f();h();Object.defineProperty(jt,"__esModule",{value:!0});jt.TLRUInMemoryAssignmentCache=void 0;var zu=ge(),Ku=it(),$u=js(),fn=class extends Ku.AbstractAssignmentCache{constructor(e,r=zu.DEFAULT_TLRU_TTL_MS){super(new $u.TLRUCache(e,r))}};jt.TLRUInMemoryAssignmentCache=fn});var ye=E(we=>{"use strict";f();h();Object.defineProperty(we,"__esModule",{value:!0});we.FormatEnum=we.UNKNOWN_ENVIRONMENT_NAME=we.VariationType=void 0;var qs;(function(t){t.STRING="STRING",t.INTEGER="INTEGER",t.NUMERIC="NUMERIC",t.BOOLEAN="BOOLEAN",t.JSON="JSON"})(qs||(we.VariationType=qs={}));we.UNKNOWN_ENVIRONMENT_NAME="UNKNOWN";var Bs;(function(t){t.SERVER="SERVER",t.CLIENT="CLIENT",t.PRECOMPUTED="PRECOMPUTED"})(Bs||(we.FormatEnum=Bs={}))});var ks=E(ue=>{"use strict";f();h();Object.defineProperty(ue,"__esModule",{value:!0});ue.ConfigurationWireV1=ue.ObfuscatedPrecomputedConfigurationResponse=ue.PrecomputedConfigurationResponse=ue.PrecomputedConfiguration=void 0;var Gu=ye(),Vs=he(),Ut=class{constructor(e,r,n){this.subjectKey=e,this.subjectAttributes=r,this.environment=n,this.format=Gu.FormatEnum.PRECOMPUTED,this.createdAt=new Date().toISOString()}},hn=class t{constructor(e,r,n){this.response=e,this.subjectKey=r,this.subjectAttributes=n}static obfuscated(e,r,n,i,s,o){let a=new Bt(e,r,n,i,s,o);return new t(JSON.stringify(a),e,s)}static unobfuscated(e,r,n,i,s){let o=new qt(e,r,n,i,s);return new t(JSON.stringify(o),e,i)}};ue.PrecomputedConfiguration=hn;var qt=class extends Ut{constructor(e,r,n,i,s){super(e,i,s),this.flags=r,this.bandits=n,this.obfuscated=!1}};ue.PrecomputedConfigurationResponse=qt;var Bt=class extends Ut{constructor(e,r,n,i,s,o){super(e,s,o),this.obfuscated=!0,this.salt=i,this.bandits=(0,Vs.obfuscatePrecomputedBanditMap)(this.salt,n),this.flags=(0,Vs.obfuscatePrecomputedFlags)(this.salt,r)}};ue.ObfuscatedPrecomputedConfigurationResponse=Bt;var pn=class{constructor(e){this.precomputed=e,this.version=1}};ue.ConfigurationWireV1=pn});var yn=E(mn=>{"use strict";f();h();Object.defineProperty(mn,"__esModule",{value:!0});mn.hydrateConfigurationStore=Hu;async function Hu(t,e){t&&await t.setEntries(e.entries)&&(t.setEnvironment(e.environment),t.setConfigFetchedAt(new Date().toISOString()),t.setConfigPublishedAt(e.createdAt),t.setFormat(e.format),t.salt=e.salt)}});var En=E(vn=>{"use strict";f();h();Object.defineProperty(vn,"__esModule",{value:!0});var _n=yn(),bn=class{constructor(e,r,n,i){this.httpClient=e,this.flagConfigurationStore=r,this.banditVariationConfigurationStore=n,this.banditModelConfigurationStore=i,this.banditModelVersions=[]}async fetchAndStoreConfigurations(){let e=await this.httpClient.getUniversalFlagConfiguration();if(!e?.flags)return;await(0,_n.hydrateConfigurationStore)(this.flagConfigurationStore,{entries:e.flags,environment:e.environment,createdAt:e.createdAt,format:e.format});let r=Object.keys(e.banditReferences??{}).length>0,n=!!(this.banditVariationConfigurationStore&&this.banditModelConfigurationStore);if(r&&n){let i=this.indexBanditVariationsByFlagKey(e.banditReferences);if(await(0,_n.hydrateConfigurationStore)(this.banditVariationConfigurationStore,{entries:i,environment:e.environment,createdAt:e.createdAt,format:e.format}),this.requiresBanditModelConfigurationStoreUpdate(this.banditModelVersions,e.banditReferences)){let s=await this.httpClient.getBanditParameters();s?.bandits&&(await(0,_n.hydrateConfigurationStore)(this.banditModelConfigurationStore,{entries:s.bandits,environment:e.environment,createdAt:e.createdAt,format:e.format}),this.banditModelVersions=this.getLoadedBanditModelVersionsFromStore(this.banditModelConfigurationStore))}}}getLoadedBanditModelVersionsFromStore(e){return e===null?[]:Object.values(e.entries()).map(r=>r.modelVersion)}requiresBanditModelConfigurationStoreUpdate(e,r){return!Object.values(r).map(i=>i.modelVersion).every(i=>e.includes(i))}indexBanditVariationsByFlagKey(e){let r={};return Object.values(e).forEach(n=>{n.flagVariations.forEach(i=>{let s=r[i.flagKey];s||(s=[],r[i.flagKey]=s),s.push(i)})}),r}};vn.default=bn});var kt=E(re=>{"use strict";f();h();Object.defineProperty(re,"__esModule",{value:!0});re.decodeFlag=Ju;re.decodeVariations=zs;re.decodeValue=An;re.decodeAllocation=Ks;re.decodeSplit=$s;re.decodeShard=Gs;re.decodeObject=Vt;re.decodeObjectTo=Cn;re.decodePrecomputedFlag=Qu;re.decodePrecomputedBandit=Wu;var Sn=ye(),H=he();function Ju(t){return{...t,variations:zs(t.variations,t.variationType),allocations:t.allocations.map(Ks)}}function zs(t,e){return Object.fromEntries(Object.entries(t).map(([,r])=>{let n=(0,H.decodeBase64)(r.key);return[n,{key:n,value:An(r.value,e)}]}))}function An(t,e){switch(e){case Sn.VariationType.INTEGER:case Sn.VariationType.NUMERIC:return Number((0,H.decodeBase64)(t));case Sn.VariationType.BOOLEAN:return(0,H.decodeBase64)(t)==="true";default:return(0,H.decodeBase64)(t)}}function Ks(t){return{...t,key:(0,H.decodeBase64)(t.key),splits:t.splits.map($s),startAt:t.startAt?new Date((0,H.decodeBase64)(t.startAt)).toISOString():void 0,endAt:t.endAt?new Date((0,H.decodeBase64)(t.endAt)).toISOString():void 0}}function $s(t){return{extraLogging:t.extraLogging?Vt(t.extraLogging):void 0,variationKey:(0,H.decodeBase64)(t.variationKey),shards:t.shards.map(Gs)}}function Gs(t){return{...t,salt:(0,H.decodeBase64)(t.salt)}}function Vt(t){return Cn(t,e=>e)}function Cn(t,e){return Object.fromEntries(Object.entries(t).map(([r,n])=>[(0,H.decodeBase64)(r),e((0,H.decodeBase64)(n))]))}function Qu(t){return{...t,allocationKey:(0,H.decodeBase64)(t.allocationKey??""),variationKey:(0,H.decodeBase64)(t.variationKey??""),variationValue:An(t.variationValue,t.variationType),extraLogging:Vt(t.extraLogging??{})}}function Wu(t){return{...t,banditKey:(0,H.decodeBase64)(t.banditKey),action:(0,H.decodeBase64)(t.action),modelVersion:(0,H.decodeBase64)(t.modelVersion),actionNumericAttributes:Cn(t.actionNumericAttributes??{},e=>+e),actionCategoricalAttributes:Vt(t.actionCategoricalAttributes??{})}}});var Hs=E($e=>{"use strict";f();h();Object.defineProperty($e,"__esModule",{value:!0});$e.EppoValue=$e.EppoValueType=void 0;var ft=ye(),Zu=he(),ne;(function(t){t[t.NullType=0]="NullType",t[t.BoolType=1]="BoolType",t[t.NumericType=2]="NumericType",t[t.StringType=3]="StringType",t[t.JSONType=4]="JSONType"})(ne||($e.EppoValueType=ne={}));var wn=class t{constructor(e,r,n,i,s){this.valueType=e,this.boolValue=r,this.numericValue=n,this.stringValue=i,this.objectValue=s}static valueOf(e,r){if(e==null)return t.Null();switch(r){case ft.VariationType.BOOLEAN:return t.Bool(e);case ft.VariationType.NUMERIC:return t.Numeric(e);case ft.VariationType.INTEGER:return t.Numeric(e);case ft.VariationType.STRING:return t.String(e);case ft.VariationType.JSON:return t.JSON(e);default:return t.String(e)}}toString(){switch(this.valueType){case ne.NullType:return"null";case ne.BoolType:return this.boolValue?"true":"false";case ne.NumericType:return this.numericValue?this.numericValue.toString():"0";case ne.StringType:return this.stringValue??"";case ne.JSONType:try{return JSON.stringify(this.objectValue)??""}catch{return this.stringValue??""}}}toHashedString(){let e=this.toString();return(0,Zu.getMD5Hash)(e)}static Bool(e){return new t(ne.BoolType,e,void 0,void 0,void 0)}static Numeric(e){return new t(ne.NumericType,void 0,e,void 0,void 0)}static String(e){return new t(ne.StringType,void 0,void 0,e,void 0)}static JSON(e){return new t(ne.JSONType,void 0,void 0,void 0,typeof e=="string"?JSON.parse(e):e)}static Null(){return new t(ne.NullType,void 0,void 0,void 0,void 0)}};$e.EppoValue=wn});var On=E(Te=>{"use strict";f();h();Object.defineProperty(Te,"__esModule",{value:!0});Te.FlagEvaluationDetailsBuilder=Te.AllocationEvaluationCode=Te.flagEvaluationCodes=void 0;var Yu=ye();Te.flagEvaluationCodes=["MATCH","FLAG_UNRECOGNIZED_OR_DISABLED","TYPE_MISMATCH","ASSIGNMENT_ERROR","DEFAULT_ALLOCATION_NULL","NO_ACTIONS_SUPPLIED_FOR_BANDIT","BANDIT_ERROR"];var zt;(function(t){t.UNEVALUATED="UNEVALUATED",t.MATCH="MATCH",t.BEFORE_START_TIME="BEFORE_START_TIME",t.TRAFFIC_EXPOSURE_MISS="TRAFFIC_EXPOSURE_MISS",t.AFTER_END_TIME="AFTER_END_TIME",t.FAILING_RULE="FAILING_RULE"})(zt||(Te.AllocationEvaluationCode=zt={}));var Tn=class{constructor(e,r,n,i){this.environmentName=e,this.allocations=r,this.configFetchedAt=n,this.configPublishedAt=i,this.variationKey=null,this.variationValue=null,this.matchedRule=null,this.matchedAllocation=null,this.unmatchedAllocations=[],this.addUnmatchedAllocation=s=>{this.unmatchedAllocations.push(s)},this.setNone=()=>(this.variationKey=null,this.variationValue=null,this.matchedRule=null,this.matchedAllocation=null,this),this.setMatch=(s,o,a,p,d)=>(this.variationKey=o.key,this.variationValue=d===Yu.VariationType.JSON&&typeof o.value=="string"?JSON.parse(o.value):o.value,this.matchedRule=p,this.matchedAllocation={key:a.key,allocationEvaluationCode:zt.MATCH,orderPosition:s+1},this),this.buildForNoneResult=(s,o)=>this.setNone().build(s,o),this.build=(s,o)=>({environmentName:this.environmentName,flagEvaluationCode:s,flagEvaluationDescription:o,variationKey:this.variationKey,variationValue:this.variationValue,banditKey:null,banditAction:null,configFetchedAt:this.configFetchedAt,configPublishedAt:this.configPublishedAt,matchedRule:this.matchedRule,matchedAllocation:this.matchedAllocation,unmatchedAllocations:this.unmatchedAllocations,unevaluatedAllocations:this.calculateUnevaluatedAllocations()}),this.gracefulBuild=(s,o)=>{try{return this.build(s,o)}catch{return null}},this.calculateUnevaluatedAllocations=()=>{let s=this.matchedAllocation?this.unmatchedAllocations.length+1:this.unmatchedAllocations.length,o=s+1;return this.allocations.slice(s).map((a,p)=>({key:a.key,allocationEvaluationCode:zt.UNEVALUATED,orderPosition:o+p}))},this.setNone()}};Te.FlagEvaluationDetailsBuilder=Tn});var Nn=E(Kt=>{"use strict";f();h();Object.defineProperty(Kt,"__esModule",{value:!0});Kt.FlagEvaluationError=void 0;var In=class extends Error{};Kt.FlagEvaluationError=In});var eo=E(xe=>{"use strict";f();h();Object.defineProperty(xe,"__esModule",{value:!0});xe.ObfuscatedOperatorType=xe.OperatorType=void 0;xe.matchesRule=Xu;var se=ua(),Re=he(),V;(function(t){t.MATCHES="MATCHES",t.NOT_MATCHES="NOT_MATCHES",t.GTE="GTE",t.GT="GT",t.LTE="LTE",t.LT="LT",t.ONE_OF="ONE_OF",t.NOT_ONE_OF="NOT_ONE_OF",t.IS_NULL="IS_NULL"})(V||(xe.OperatorType=V={}));var k;(function(t){t.MATCHES="05015086bdd8402218f6aad6528bef08",t.NOT_MATCHES="8323761667755378c3a78e0a6ed37a78",t.GTE="32d35312e8f24bc1669bd2b45c00d47c",t.GT="cd6a9bd2a175104eed40f0d33a8b4020",t.LTE="cc981ecc65ecf63ad1673cbec9c64198",t.LT="c562607189d77eb9dfb707464c1e7b0b",t.ONE_OF="27457ce369f2a74203396a35ef537c0b",t.NOT_ONE_OF="602f5ee0b6e84fe29f43ab48b9e1addf",t.IS_NULL="dbd9c38e0339e6c34bd48cafc59be388"})(k||(xe.ObfuscatedOperatorType=k={}));var _e;(function(t){t.PLAIN_STRING="PLAIN_STRING",t.STRING_ARRAY="STRING_ARRAY",t.SEM_VER="SEM_VER",t.NUMERIC="NUMERIC"})(_e||(_e={}));function Xu(t,e,r){return!ec(e,t.conditions,r).includes(!1)}function ec(t,e,r){return e.map(n=>r?rc(Object.entries(t).reduce((i,[s,o])=>({[(0,Re.getMD5Hash)(s)]:o,...i}),{}),n):tc(t,n))}function tc(t,e){let r=t[e.attribute];if(e.operator===V.IS_NULL)return e.value?r==null:r!=null;if(r!=null)switch(e.operator){case V.GTE:case V.GT:case V.LTE:case V.LT:{if(Xs(e.value)===_e.SEM_VER){let s=e.operator===V.GTE?se.gte:e.operator===V.GT?se.gt:e.operator===V.LTE?se.lte:se.lt;return Ys(r,e.value,s)}let i=(s,o)=>e.operator===V.GTE?s>=o:e.operator===V.GT?s>o:e.operator===V.LTE?s<=o:s<o;return Zs(r,e.value,i)}case V.MATCHES:return new RegExp(e.value).test(r);case V.NOT_MATCHES:return!new RegExp(e.value).test(r);case V.ONE_OF:return Js(r.toString(),e.value);case V.NOT_ONE_OF:return Qs(r.toString(),e.value)}return!1}function rc(t,e){let r=t[e.attribute];if(e.operator===k.IS_NULL)return e.value===(0,Re.getMD5Hash)("true")?r==null:r!=null;if(r!=null)switch(e.operator){case k.GTE:case k.GT:case k.LTE:case k.LT:{let n=(0,Re.decodeBase64)(e.value);if(Xs(n)===_e.SEM_VER){let o=e.operator===k.GTE?se.gte:e.operator===k.GT?se.gt:e.operator===k.LTE?se.lte:se.lt;return Ys(r,n,o)}let s=(o,a)=>e.operator===k.GTE?o>=a:e.operator===k.GT?o>a:e.operator===k.LTE?o<=a:o<a;return Zs(r,Number(n),s)}case k.MATCHES:return new RegExp((0,Re.decodeBase64)(e.value)).test(r);case k.NOT_MATCHES:return!new RegExp((0,Re.decodeBase64)(e.value)).test(r);case k.ONE_OF:return Js((0,Re.getMD5Hash)(r.toString()),e.value);case k.NOT_ONE_OF:return Qs((0,Re.getMD5Hash)(r.toString()),e.value)}return!1}function Js(t,e){return Ws(t,e).length>0}function Qs(t,e){return Ws(t,e).length===0}function Ws(t,e){return e.filter(r=>r===t)}function Zs(t,e,r){return r(Number(t),Number(e))}function Ys(t,e,r){return!!(0,se.valid)(t)&&!!(0,se.valid)(e)&&r(t,e)}function Xs(t){return typeof t=="number"?_e.NUMERIC:Array.isArray(t)?_e.STRING_ARRAY:typeof t=="string"&&(0,se.valid)(t)?_e.SEM_VER:isNaN(Number(t))?_e.PLAIN_STRING:_e.NUMERIC}});var io=E(Oe=>{"use strict";f();h();Object.defineProperty(Oe,"__esModule",{value:!0});Oe.Evaluator=void 0;Oe.isInShardRange=to;Oe.hashKey=ro;Oe.noneResult=Ln;Oe.matchesRules=no;var nc=$t(),ht=On(),ic=Nn(),sc=eo(),oc=ln(),Pn=class{constructor(e){this.getMatchedEvaluationCodeAndDescription=(r,n,i,s,o)=>{if(!(0,nc.checkValueTypeMatch)(o,r.value)){let{key:A,value:T}=r;return{flagEvaluationCode:"ASSIGNMENT_ERROR",flagEvaluationDescription:`Variation (${A}) is configured for type ${o}, but is set to incompatible value (${T})`}}let a=!!n.rules?.length,p=n.splits.length>1,d=i.shards.length>1,b=p||d;return a&&b?{flagEvaluationCode:"MATCH",flagEvaluationDescription:`Supplied attributes match rules defined in allocation "${n.key}" and ${s} belongs to the range of traffic assigned to "${i.variationKey}".`}:a&&!b?{flagEvaluationCode:"MATCH",flagEvaluationDescription:`Supplied attributes match rules defined in allocation "${n.key}".`}:{flagEvaluationCode:"MATCH",flagEvaluationDescription:`${s} belongs to the range of traffic assigned to "${i.variationKey}" defined in allocation "${n.key}".`}},this.sharder=e??new oc.MD5Sharder}evaluateFlag(e,r,n,i,s,o){let a=new ht.FlagEvaluationDetailsBuilder(r.configEnvironment.name,e.allocations,r.configFetchedAt,r.configPublishedAt);try{if(!e.enabled)return Ln(e.key,n,i,a.buildForNoneResult("FLAG_UNRECOGNIZED_OR_DISABLED",`Unrecognized or disabled flag: ${e.key}`),r.configFormat);let p=new Date;for(let d=0;d<e.allocations.length;d++){let b=e.allocations[d],A=C=>{a.addUnmatchedAllocation({key:b.key,allocationEvaluationCode:C,orderPosition:d+1})};if(b.startAt&&p<new Date(b.startAt)){A(ht.AllocationEvaluationCode.BEFORE_START_TIME);continue}if(b.endAt&&p>new Date(b.endAt)){A(ht.AllocationEvaluationCode.AFTER_END_TIME);continue}let{matched:T,matchedRule:S}=no(b?.rules??[],{id:n,...i},s);if(T){for(let C of b.splits)if(C.shards.every(N=>this.matchesShard(N,n,e.totalShards))){let N=e.variations[C.variationKey],{flagEvaluationCode:O,flagEvaluationDescription:y}=this.getMatchedEvaluationCodeAndDescription(N,b,C,n,o),m=a.setMatch(d,N,b,S,o).build(O,y);return{flagKey:e.key,format:r.configFormat,subjectKey:n,subjectAttributes:i,allocationKey:b.key,variation:N,extraLogging:C.extraLogging??{},doLog:b.doLog,flagEvaluationDetails:m}}A(ht.AllocationEvaluationCode.TRAFFIC_EXPOSURE_MISS)}else A(ht.AllocationEvaluationCode.FAILING_RULE)}return Ln(e.key,n,i,a.buildForNoneResult("DEFAULT_ALLOCATION_NULL",'No allocations matched. Falling back to "Default Allocation", serving NULL'),r.configFormat)}catch(p){console.error(">>>>",p);let d=a.gracefulBuild("ASSIGNMENT_ERROR",`Assignment Error: ${p.message}`);if(d){let b=new ic.FlagEvaluationError(p.message);throw b.flagEvaluationDetails=d,b}throw p}}matchesShard(e,r,n){let i=this.sharder.getShard(ro(e.salt,r),n);return e.ranges.some(s=>to(i,s))}};Oe.Evaluator=Pn;function to(t,e){return e.start<=t&&t<e.end}function ro(t,e){return`${t}-${e}`}function Ln(t,e,r,n,i){return{flagKey:t,format:i,subjectKey:e,subjectAttributes:r,allocationKey:null,variation:null,extraLogging:{},doLog:!1,flagEvaluationDetails:n}}function no(t,e,r){if(!t.length)return{matched:!0,matchedRule:null};let n=null;return t.some(s=>{let o=(0,sc.matchesRule)(s,e,r);return o&&(n=s),o})?{matched:!0,matchedRule:n}:{matched:!1,matchedRule:null}}});var Dn=E(Gt=>{"use strict";f();h();Object.defineProperty(Gt,"__esModule",{value:!0});Gt.BoundedEventQueue=void 0;var ac=ae(),uc=ge(),Fn=class{constructor(e,r=new Array,n=uc.MAX_EVENT_QUEUE_SIZE){this.name=e,this.queue=r,this.maxSize=n}get length(){return this.queue.length}splice(e){return this.queue.splice(e)}isEmpty(){return this.queue.length===0}[Symbol.iterator](){return this.queue[Symbol.iterator]()}push(...e){let{name:r,maxSize:n,queue:i}=this;for(;i.length<n&&e.length>0;)i.push(...e.splice(0,1));e.length>0&&ac.logger.warn(`Dropping ${e.length} events for queue ${r} since maxSize of ${n} reached.`)}flush(){let e=[...this.queue];return this.queue.length=0,e}};Gt.BoundedEventQueue=Fn});var xn=E(Rn=>{"use strict";f();h();Object.defineProperty(Rn,"__esModule",{value:!0});var Mn=class{dispatch(e){}};Rn.default=Mn});var Ht=E(pt=>{"use strict";f();h();Object.defineProperty(pt,"__esModule",{value:!0});pt.HttpRequestError=void 0;var oe=class extends Error{constructor(e,r,n){super(e),this.message=e,this.status=r,this.cause=n,n&&(this.cause=n)}};pt.HttpRequestError=oe;var jn=class{constructor(e,r){this.apiEndpoints=e,this.timeout=r}async getUniversalFlagConfiguration(){let e=this.apiEndpoints.ufcEndpoint();return await this.rawGet(e)}async getBanditParameters(){let e=this.apiEndpoints.banditParametersEndpoint();return await this.rawGet(e)}async getPrecomputedFlags(e){let r=this.apiEndpoints.precomputedFlagsEndpoint();return await this.rawPost(r,e)}async rawGet(e){try{let r=new AbortController,n=r.signal,i=setTimeout(()=>r.abort(),this.timeout),s=await fetch(e.toString(),{signal:n});if(clearTimeout(i),!s?.ok)throw new oe("Failed to fetch data",s?.status);return await s.json()}catch(r){throw r.name==="AbortError"?new oe("Request timed out",408,r):r instanceof oe?r:new oe("Network error",0,r)}}async rawPost(e,r){try{let n=new AbortController,i=n.signal,s=setTimeout(()=>n.abort(),this.timeout),o=await fetch(e.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r),signal:i});if(clearTimeout(s),!o?.ok){let a=await o.text();throw new oe(a||"Failed to post data",o?.status)}return await o.json()}catch(n){throw n.name==="AbortError"?new oe("Request timed out",408,n):n instanceof oe?n:new oe("Network error",0,n)}}};pt.default=jn});var so=E(Un=>{"use strict";f();h();Object.defineProperty(Un,"__esModule",{value:!0});Un.waitForMs=cc;async function cc(t){await new Promise(e=>setTimeout(e,t))}});var Bn=E(qn=>{"use strict";f();h();Object.defineProperty(qn,"__esModule",{value:!0});qn.default=dc;var X=ae(),Jt=ge(),lc=so();function dc(t,e,r){let n=!1,i=0,s=t,o=!1,a,p=async()=>{n=!1;let A=!1,T=r?.skipInitialPoll?0:1+(r?.maxStartRetries??Jt.DEFAULT_INITIAL_CONFIG_REQUEST_RETRIES),S=null;for(;!A&&T>0;)try{await e(),A=!0,o=!1,X.logger.info("Eppo SDK successfully requested initial configuration")}catch(N){if(o=!0,X.logger.warn(`Eppo SDK encountered an error with initial poll of configurations: ${N.message}`),--T>0){let O=oo(t);X.logger.warn(`Eppo SDK will retry the initial poll again in ${O} ms (${T} attempts remaining)`),await(0,lc.waitForMs)(O)}else r?.pollAfterFailedStart?X.logger.warn("Eppo SDK initial poll failed; will attempt regular polling"):(X.logger.error("Eppo SDK initial poll failed. Aborting polling"),d()),r?.errorOnFailedStart&&(S=N)}if(!n&&(A&&r?.pollAfterSuccessfulStart||!A&&r?.pollAfterFailedStart)?(X.logger.info(`Eppo SDK starting regularly polling every ${t} ms`),a=setTimeout(b,t)):X.logger.info("Eppo SDK will not poll for configuration updates"),S)throw X.logger.info("Eppo SDK rethrowing start error"),S},d=()=>{n||(n=!0,a&&clearTimeout(a),X.logger.info("Eppo SDK polling stopped"))};async function b(){if(!n){try{await e(),i=0,s=t,o&&(o=!1,X.logger.info("Eppo SDK poll successful; resuming normal polling"))}catch(A){o=!0,X.logger.warn(`Eppo SDK encountered an error polling configurations: ${A.message}`);let T=1+(r?.maxPollRetries??Jt.DEFAULT_POLL_CONFIG_REQUEST_RETRIES);if(++i<T){let S=Math.pow(2,i),C=oo(t);s=S*t+C,X.logger.warn(`Eppo SDK will try polling again in ${s} ms (${T-i} attempts remaining)`)}else X.logger.error(`Eppo SDK reached maximum of ${i} failed polling attempts. Stopping polling`),d()}setTimeout(b,s)}}return{start:p,stop:d}}function oo(t){let e=t*Jt.POLL_JITTER_PCT/2,r=Math.max(Math.floor(Math.random()*t*Jt.POLL_JITTER_PCT/2),1);return e+r}});var Wt=E(mt=>{"use strict";f();h();Object.defineProperty(mt,"__esModule",{value:!0});mt.InvalidArgumentError=void 0;mt.validateNotBlank=gc;var Qt=class extends Error{};mt.InvalidArgumentError=Qt;function gc(t,e){if(t==null||t.length===0)throw new Qt(e)}});var ao=E((rh,fc)=>{fc.exports={name:"@eppo/js-client-sdk-common",version:"4.8.4",description:"Common library for Eppo JavaScript SDKs (web, react native, and node)",main:"dist/index.js",files:["/dist","/src","!*.spec.ts"],types:"./dist/index.d.ts",engines:{node:">=18.x"},exports:{".":{types:"./dist/index.d.ts",default:"./dist/index.js"}},scripts:{lint:"eslint '**/*.{ts,tsx}' --cache","lint:fix":"eslint --fix '**/*.{ts,tsx}' --cache","lint:fix-pre-commit":"eslint -c .eslintrc.pre-commit.js --fix '**/*.{ts,tsx}' --no-eslintrc --cache",prepare:"make prepare","pre-commit":"lint-staged && tsc",typecheck:"tsc",test:"yarn test:unit","test:unit":"NODE_ENV=test jest '.*\\.spec\\.ts'","obfuscate-mock-ufc":"ts-node test/writeObfuscatedMockUFC"},jsdelivr:"dist/eppo-sdk.js",repository:{type:"git",url:"git+https://github.com/Eppo-exp/js-client-sdk-common.git"},author:"",license:"MIT",bugs:{url:"https://github.com/Eppo-exp/js-client-sdk-common/issues"},homepage:"https://github.com/Eppo-exp/js-client-sdk-common#readme",devDependencies:{"@types/jest":"^29.5.11","@types/js-base64":"^3.3.1","@types/lodash":"^4.17.5","@types/semver":"^7.5.6","@types/spark-md5":"^3.0.5","@types/uuid":"^10.0.0","@typescript-eslint/eslint-plugin":"^5.13.0","@typescript-eslint/parser":"^5.13.0",eslint:"^8.17.0","eslint-config-prettier":"^10.0.1","eslint-import-resolver-typescript":"^3.7.0","eslint-plugin-import":"^2.25.4","eslint-plugin-prettier":"5.0.0","eslint-plugin-promise":"^7.2.1","eslint-plugin-unused-imports":"^4.1.4",jest:"^29.7.0","jest-environment-jsdom":"^29.7.0",lodash:"^4.17.21",prettier:"^3.4.2","terser-webpack-plugin":"^5.3.3",testdouble:"^3.20.1","ts-jest":"^29.1.1","ts-loader":"^9.3.1","ts-node":"^10.9.1",typescript:"^5.7.2",webpack:"^5.73.0","webpack-cli":"^6.0.1"},dependencies:{buffer:"npm:@eppo/buffer@6.2.0","js-base64":"^3.7.7",pino:"^9.5.0",semver:"^7.5.4","spark-md5":"^3.0.2",uuid:"^11.0.5"},packageManager:"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e"}});var Vn=E(Zt=>{"use strict";f();h();Object.defineProperty(Zt,"__esModule",{value:!0});Zt.LIB_VERSION=void 0;var hc=ao();Zt.LIB_VERSION=hc.version});var $t=E(_t=>{"use strict";f();h();Object.defineProperty(_t,"__esModule",{value:!0});_t.checkTypeMatch=ho;_t.checkValueTypeMatch=Ic;var pc=Rs(),mc=Ct(),j=ae(),je=an(),yc=xs(),_c=Nt(),uo=Lt(),bc=Us(),co=ks(),vc=En(),yt=ge(),Ec=kt(),Ue=Hs(),Yt=io(),lo=Dn(),Sc=xn(),go=On(),Ac=Nn(),Cc=Ht(),ce=ye(),wc=he(),Tc=Bn(),fo=Wt(),Oc=Vn(),kn=class{constructor({eventDispatcher:e=new Sc.default,isObfuscated:r=!1,flagConfigurationStore:n,banditVariationConfigurationStore:i,banditModelConfigurationStore:s,configurationRequestParameters:o}){this.assignmentEventsQueue=new lo.BoundedEventQueue("assignments"),this.banditEventsQueue=new lo.BoundedEventQueue("bandit"),this.banditEvaluator=new yc.BanditEvaluator,this.isGracefulFailureMode=!0,this.evaluator=new Yt.Evaluator,this.eventDispatcher=e,this.flagConfigurationStore=n,this.banditVariationConfigurationStore=i,this.banditModelConfigurationStore=s,this.configurationRequestParameters=o,this.isObfuscated=r}setConfigurationRequestParameters(e){this.configurationRequestParameters=e}setFlagConfigurationStore(e){this.flagConfigurationStore=e}setBanditVariationConfigurationStore(e){this.banditVariationConfigurationStore=e}setEventDispatcher(e){this.eventDispatcher=e}setBanditModelConfigurationStore(e){this.banditModelConfigurationStore=e}setIsObfuscated(e){this.isObfuscated=e}async fetchFlagConfigurations(){if(!this.configurationRequestParameters)throw new Error("Eppo SDK unable to fetch flag configurations without configuration request parameters");this.requestPoller?.stop();let{apiKey:e,sdkName:r,sdkVersion:n,baseUrl:i,requestTimeoutMs:s=yt.DEFAULT_REQUEST_TIMEOUT_MS,numInitialRequestRetries:o=yt.DEFAULT_INITIAL_CONFIG_REQUEST_RETRIES,numPollRequestRetries:a=yt.DEFAULT_POLL_CONFIG_REQUEST_RETRIES,pollAfterSuccessfulInitialization:p=!1,pollAfterFailedInitialization:d=!1,throwOnFailedInitialization:b=!1,skipInitialPoll:A=!1}=this.configurationRequestParameters,{pollingIntervalMs:T=yt.DEFAULT_POLL_INTERVAL_MS}=this.configurationRequestParameters;T<=0&&(j.logger.error("pollingIntervalMs must be greater than 0. Using default"),T=yt.DEFAULT_POLL_INTERVAL_MS);let S=new mc.default({baseUrl:i,queryParams:{apiKey:e,sdkName:r,sdkVersion:n}}),C=new Cc.default(S,s),N=new vc.default(C,this.flagConfigurationStore,this.banditVariationConfigurationStore??null,this.banditModelConfigurationStore??null),O=async()=>{if(await this.flagConfigurationStore.isExpired())return N.fetchAndStoreConfigurations()};this.requestPoller=(0,Tc.default)(T,O,{maxStartRetries:o,maxPollRetries:a,pollAfterSuccessfulStart:p,pollAfterFailedStart:d,errorOnFailedStart:b,skipInitialPoll:A}),await this.requestPoller.start()}stopPolling(){this.requestPoller&&this.requestPoller.stop()}getStringAssignment(e,r,n,i){return this.getStringAssignmentDetails(e,r,n,i).variation}getStringAssignmentDetails(e,r,n,i){let{eppoValue:s,flagEvaluationDetails:o}=this.getAssignmentVariation(e,r,n,Ue.EppoValue.String(i),ce.VariationType.STRING);return{variation:s.stringValue??i,action:null,evaluationDetails:o}}getBoolAssignment(e,r,n,i){return this.getBooleanAssignment(e,r,n,i)}getBooleanAssignment(e,r,n,i){return this.getBooleanAssignmentDetails(e,r,n,i).variation}getBooleanAssignmentDetails(e,r,n,i){let{eppoValue:s,flagEvaluationDetails:o}=this.getAssignmentVariation(e,r,n,Ue.EppoValue.Bool(i),ce.VariationType.BOOLEAN);return{variation:s.boolValue??i,action:null,evaluationDetails:o}}getIntegerAssignment(e,r,n,i){return this.getIntegerAssignmentDetails(e,r,n,i).variation}getIntegerAssignmentDetails(e,r,n,i){let{eppoValue:s,flagEvaluationDetails:o}=this.getAssignmentVariation(e,r,n,Ue.EppoValue.Numeric(i),ce.VariationType.INTEGER);return{variation:s.numericValue??i,action:null,evaluationDetails:o}}getNumericAssignment(e,r,n,i){return this.getNumericAssignmentDetails(e,r,n,i).variation}getNumericAssignmentDetails(e,r,n,i){let{eppoValue:s,flagEvaluationDetails:o}=this.getAssignmentVariation(e,r,n,Ue.EppoValue.Numeric(i),ce.VariationType.NUMERIC);return{variation:s.numericValue??i,action:null,evaluationDetails:o}}getJSONAssignment(e,r,n,i){return this.getJSONAssignmentDetails(e,r,n,i).variation}getJSONAssignmentDetails(e,r,n,i){let{eppoValue:s,flagEvaluationDetails:o}=this.getAssignmentVariation(e,r,n,Ue.EppoValue.JSON(i),ce.VariationType.JSON);return{variation:s.objectValue??i,action:null,evaluationDetails:o}}getBanditAction(e,r,n,i,s){let{variation:o,action:a}=this.getBanditActionDetails(e,r,n,i,s);return{variation:o,action:a}}getBestAction(e,r,n,i){let s=null,a=this.banditVariationConfigurationStore?.get(e)?.at(0)?.key;if(a){let p=this.getBandit(a);if(p){let d=(0,je.ensureContextualSubjectAttributes)(r),b=(0,je.ensureActionsWithContextualAttributes)(n);s=this.banditEvaluator.evaluateBestBanditAction(d,b,p.modelData)}}return s??i}getBanditActionDetails(e,r,n,i,s){let o=s,a=null,p=this.newFlagEvaluationDetailsBuilder(e).buildForNoneResult("ASSIGNMENT_ERROR","Unexpected error getting assigned variation for bandit action");try{let d=(0,je.ensureNonContextualSubjectAttributes)(n),{variation:b,evaluationDetails:A}=this.getStringAssignmentDetails(e,r,d,s);o=b,p=A;let T=this.findBanditByVariation(e,o);if(!T)return{variation:o,action:null,evaluationDetails:p};p.banditKey=T.banditKey;let S=this.evaluateBanditAction(e,r,n,i,T.modelData);if(S?.actionKey){a=S.actionKey;let C={timestamp:new Date().toISOString(),featureFlag:e,bandit:T.banditKey,subject:r,action:a,actionProbability:S.actionWeight,optimalityGap:S.optimalityGap,modelVersion:T.modelVersion,subjectNumericAttributes:S.subjectAttributes.numericAttributes,subjectCategoricalAttributes:S.subjectAttributes.categoricalAttributes,actionNumericAttributes:S.actionAttributes.numericAttributes,actionCategoricalAttributes:S.actionAttributes.categoricalAttributes,metaData:this.buildLoggerMetadata(),evaluationDetails:p};try{this.logBanditAction(C)}catch(N){j.logger.error("Error logging bandit event",N)}p.banditAction=a}}catch(d){if(j.logger.error("Error determining bandit action",d),!this.isGracefulFailureMode)throw d;o&&(p.flagEvaluationCode="BANDIT_ERROR"),p.flagEvaluationDescription=`Error evaluating bandit action: ${d.message}`}return{variation:o,action:a,evaluationDetails:p}}getExperimentContainerEntry(e,r,n){let{flagKey:i,controlVariationEntry:s,treatmentVariationEntries:o}=e,a=this.getStringAssignment(i,r,n,"control");if(a==="control")return s;if(!a.startsWith("treatment-"))return j.logger.warn(`Variation '${a}' cannot be mapped to a container. Defaulting to control variation.`),s;let p=Number.parseInt(a.split("-")[1])-1;return isNaN(p)?(j.logger.warn(`Variation '${a}' cannot be mapped to a container. Defaulting to control variation.`),s):p>=o.length?(j.logger.warn(`Selected treatment variation (${p}) index is out of bounds. Defaulting to control variation.`),s):o[p]}evaluateBanditAction(e,r,n,i,s){if(!Object.keys(i).length)return null;let o=(0,je.ensureContextualSubjectAttributes)(n),a=(0,je.ensureActionsWithContextualAttributes)(i);return this.banditEvaluator.evaluateBandit(e,r,o,a,s)}logBanditAction(e){let r=e.subject,n=e.featureFlag,i=e.bandit,s=e.action??"__eppo_no_action",o={flagKey:n,subjectKey:r,banditKey:i,actionKey:s};if(!this.banditAssignmentCache?.has(o))try{this.banditLogger?this.banditLogger.logBanditAction(e):this.banditEventsQueue.push(e),this.banditAssignmentCache?.set(o)}catch(a){j.logger.warn("Error encountered logging bandit action",a)}}getAssignmentVariation(e,r,n,i,s){try{let o=this.getAssignmentDetail(e,r,n,s);return this.parseVariationWithDetails(o,i,s)}catch(o){let a=this.rethrowIfNotGraceful(o,i);if(o instanceof Ac.FlagEvaluationError&&o.flagEvaluationDetails)return{eppoValue:a,flagEvaluationDetails:o.flagEvaluationDetails};{let p=new go.FlagEvaluationDetailsBuilder("",[],"","").buildForNoneResult("ASSIGNMENT_ERROR",`Assignment Error: ${o.message}`);return{eppoValue:a,flagEvaluationDetails:p}}}}parseVariationWithDetails({flagEvaluationDetails:e,variation:r},n,i){try{return!r||e.flagEvaluationCode!=="MATCH"?{eppoValue:n,flagEvaluationDetails:e}:{eppoValue:Ue.EppoValue.valueOf(r.value,i),flagEvaluationDetails:e}}catch(s){return{eppoValue:this.rethrowIfNotGraceful(s,n),flagEvaluationDetails:e}}}rethrowIfNotGraceful(e,r){if(this.isGracefulFailureMode)return j.logger.error(`${j.loggerPrefix} Error getting assignment: ${e.message}`),r??Ue.EppoValue.Null();throw e}getAllAssignments(e,r={}){let n=this.getConfigDetails(),i=this.getFlagKeys(),s={};return i.forEach(o=>{let a=this.getFlag(o);if(!a){j.logger.debug(`${j.loggerPrefix} No assigned variation. Flag does not exist.`);return}let p=this.evaluator.evaluateFlag(a,n,e,r,this.isObfuscated);if(!p.variation||!p.allocationKey){j.logger.debug(`${j.loggerPrefix} No assigned variation: ${o}`);return}s[o]={flagKey:o,allocationKey:p.allocationKey,doLog:p.doLog,extraLogging:p.extraLogging,variationKey:p.variation.key,variationType:a.variationType,variationValue:p.variation.value.toString()}}),s}getPrecomputedConfiguration(e,r={},n={},i){let s=this.getConfigDetails(),o=(0,je.ensureContextualSubjectAttributes)(r),a=(0,je.ensureNonContextualSubjectAttributes)(r),p=this.getAllAssignments(e,a),d=this.computeBanditsForFlags(e,o,n,p),b=co.PrecomputedConfiguration.obfuscated(e,p,d,i??"",o,s.configEnvironment),A=new co.ConfigurationWireV1(b);return JSON.stringify(A)}getAssignmentDetail(e,r,n={},i){(0,fo.validateNotBlank)(r,"Invalid argument: subjectKey cannot be blank"),(0,fo.validateNotBlank)(e,"Invalid argument: flagKey cannot be blank");let s=this.newFlagEvaluationDetailsBuilder(e),o=this.getConfigDetails(),a=this.getFlag(e);if(a===null){j.logger.warn(`${j.loggerPrefix} No assigned variation. Flag not found: ${e}`);let d=s.buildForNoneResult("FLAG_UNRECOGNIZED_OR_DISABLED",`Unrecognized or disabled flag: ${e}`);return(0,Yt.noneResult)(e,r,n,d,o.configFormat)}if(!ho(i,a.variationType)){let d=`Variation value does not have the correct type. Found ${a.variationType}, but expected ${i} for flag ${e}`;if(this.isGracefulFailureMode){let b=s.buildForNoneResult("TYPE_MISMATCH",d);return(0,Yt.noneResult)(e,r,n,b,o.configFormat)}throw new TypeError(d)}if(!a.enabled){j.logger.info(`${j.loggerPrefix} No assigned variation. Flag is disabled: ${e}`);let d=s.buildForNoneResult("FLAG_UNRECOGNIZED_OR_DISABLED",`Unrecognized or disabled flag: ${e}`);return(0,Yt.noneResult)(e,r,n,d,o.configFormat)}let p=this.evaluator.evaluateFlag(a,o,r,n,this.isObfuscated,i);this.isObfuscated&&(p.flagKey=e);try{p?.doLog&&this.maybeLogAssignment(p)}catch(d){j.logger.error(`${j.loggerPrefix} Error logging assignment event: ${d}`)}return p}track(e,r){this.eventDispatcher.dispatch({uuid:(0,pc.v4)(),type:e,timestamp:new Date().getTime(),payload:r})}newFlagEvaluationDetailsBuilder(e){let r=this.getFlag(e),n=this.getConfigDetails();return new go.FlagEvaluationDetailsBuilder(n.configEnvironment.name,r?.allocations??[],n.configFetchedAt,n.configPublishedAt)}getConfigDetails(){return{configFetchedAt:this.flagConfigurationStore.getConfigFetchedAt()??"",configPublishedAt:this.flagConfigurationStore.getConfigPublishedAt()??"",configEnvironment:this.flagConfigurationStore.getEnvironment()??{name:""},configFormat:this.flagConfigurationStore.getFormat()??""}}getFlag(e){return this.isObfuscated?this.getObfuscatedFlag(e):this.flagConfigurationStore.get(e)}getObfuscatedFlag(e){let r=this.flagConfigurationStore.get((0,wc.getMD5Hash)(e));return r?(0,Ec.decodeFlag)(r):null}getBandit(e){return this.banditModelConfigurationStore?.get(e)??null}getFlagKeys(){return this.flagConfigurationStore.getKeys()}isInitialized(){return this.flagConfigurationStore.isInitialized()&&(!this.banditVariationConfigurationStore||this.banditVariationConfigurationStore.isInitialized())&&(!this.banditModelConfigurationStore||this.banditModelConfigurationStore.isInitialized())}setLogger(e){this.setAssignmentLogger(e)}setAssignmentLogger(e){this.assignmentLogger=e,this.flushQueuedEvents(this.assignmentEventsQueue,this.assignmentLogger?.logAssignment)}setBanditLogger(e){this.banditLogger=e,this.flushQueuedEvents(this.banditEventsQueue,this.banditLogger?.logBanditAction)}disableAssignmentCache(){this.assignmentCache=void 0}useNonExpiringInMemoryAssignmentCache(){this.assignmentCache=new uo.NonExpiringInMemoryAssignmentCache}useLRUInMemoryAssignmentCache(e){this.assignmentCache=new _c.LRUInMemoryAssignmentCache(e)}useCustomAssignmentCache(e){this.assignmentCache=e}disableBanditAssignmentCache(){this.banditAssignmentCache=void 0}useNonExpiringInMemoryBanditAssignmentCache(){this.banditAssignmentCache=new uo.NonExpiringInMemoryAssignmentCache}useExpiringInMemoryBanditAssignmentCache(e,r){this.banditAssignmentCache=new bc.TLRUInMemoryAssignmentCache(e,r)}useCustomBanditAssignmentCache(e){this.banditAssignmentCache=e}setIsGracefulFailureMode(e){this.isGracefulFailureMode=e}getFlagConfigurations(){return this.flagConfigurationStore.entries()}flushQueuedEvents(e,r){let n=e.flush();r&&n.forEach(i=>{try{r(i)}catch(s){j.logger.error(`${j.loggerPrefix} Error flushing event to logger: ${s.message}`)}})}maybeLogAssignment(e){let{flagKey:r,format:n,subjectKey:i,allocationKey:s,subjectAttributes:o,variation:a}=e,p={...e.extraLogging??{},allocation:s??null,experiment:s?`${r}-${s}`:null,featureFlag:r,format:n,variation:a?.key??null,subject:i,timestamp:new Date().toISOString(),subjectAttributes:o,metaData:this.buildLoggerMetadata(),evaluationDetails:e.flagEvaluationDetails};if(!(a&&s&&this.assignmentCache?.has({flagKey:r,subjectKey:i,allocationKey:s,variationKey:a.key})))try{this.assignmentLogger?this.assignmentLogger.logAssignment(p):this.assignmentEventsQueue.push(p),this.assignmentCache?.set({flagKey:r,subjectKey:i,allocationKey:s??"__eppo_no_allocation",variationKey:a?.key??"__eppo_no_variation"})}catch(d){j.logger.error(`${j.loggerPrefix} Error logging assignment event: ${d.message}`)}}buildLoggerMetadata(){return{obfuscated:this.isObfuscated,sdkLanguage:"javascript",sdkLibVersion:Oc.LIB_VERSION}}computeBanditsForFlags(e,r,n,i){let s={};return Object.keys(n).forEach(o=>{let a=i[o];if(a){let p=this.getPrecomputedBandit(o,a.variationValue,e,r,n[o]);p&&(s[o]=p)}}),s}findBanditByVariation(e,r){let i=this.banditVariationConfigurationStore?.get(e)?.find(s=>s.variationValue===r)?.key;return i?this.getBandit(i):null}getPrecomputedBandit(e,r,n,i,s){let o=this.findBanditByVariation(e,r);if(!o)return null;let a=this.evaluateBanditAction(e,n,i,s,o.modelData);return a?{banditKey:o.banditKey,action:a.actionKey,actionNumericAttributes:a.actionAttributes.numericAttributes,actionCategoricalAttributes:a.actionAttributes.categoricalAttributes,actionProbability:a.actionWeight,modelVersion:o.modelVersion,optimalityGap:a.optimalityGap}:null}};_t.default=kn;function ho(t,e){return t===void 0||e===t}function Ic(t,e){if(t==null)return!0;switch(t){case ce.VariationType.STRING:return typeof e=="string";case ce.VariationType.BOOLEAN:return typeof e=="boolean";case ce.VariationType.INTEGER:return typeof e=="number"&&Number.isInteger(e);case ce.VariationType.NUMERIC:return typeof e=="number";case ce.VariationType.JSON:return typeof e=="string";default:return!1}}});var yo=E(Kn=>{"use strict";f();h();Object.defineProperty(Kn,"__esModule",{value:!0});var po=yn(),mo=ye(),zn=class{constructor(e,r,n,i,s,o){this.httpClient=e,this.precomputedFlagStore=r,this.subjectKey=n,this.subjectAttributes=i,this.precomputedBanditsStore=s,this.banditActions=o}async fetchAndStorePrecomputedFlags(){let e=await this.httpClient.getPrecomputedFlags({subject_key:this.subjectKey,subject_attributes:this.subjectAttributes,bandit_actions:this.banditActions});if(!e)return;let r=[];r.push((0,po.hydrateConfigurationStore)(this.precomputedFlagStore,{entries:e.flags,environment:e.environment??{name:mo.UNKNOWN_ENVIRONMENT_NAME},createdAt:e.createdAt,format:e.format,salt:e.salt})),this.precomputedBanditsStore&&r.push((0,po.hydrateConfigurationStore)(this.precomputedBanditsStore,{entries:e.bandits,environment:e.environment??{name:mo.UNKNOWN_ENVIRONMENT_NAME},createdAt:e.createdAt,format:e.format,salt:e.salt}))}};Kn.default=zn});var Eo=E(Gn=>{"use strict";f();h();Object.defineProperty(Gn,"__esModule",{value:!0});var Nc=Ct(),M=ae(),_o=an(),Pc=Nt(),Lc=Lt(),qe=ge(),bo=kt(),Fc=Ht(),bt=ye(),vo=he(),Dc=Bn(),Mc=yo(),Rc=Wt(),xc=Vn(),jc=$t(),$n=class{constructor(e){this.queuedAssignmentEvents=[],this.banditEventsQueue=[],this.precomputedFlagStore=e.precomputedFlagStore,this.precomputedBanditStore=e.precomputedBanditStore;let{subjectKey:r,subjectAttributes:n}=e.subject;this.subject={subjectKey:r,subjectAttributes:(0,_o.ensureContextualSubjectAttributes)(n)},this.banditActions=e.banditActions,e.requestParameters?this.requestParameters=e.requestParameters:(this.precomputedFlagStore.isInitialized()||M.logger.error(`${M.loggerPrefix} EppoPrecomputedClient requires an initialized precomputedFlagStore if requestParameters are not provided`),this.precomputedBanditStore&&!this.precomputedBanditStore.isInitialized()&&M.logger.error(`${M.loggerPrefix} Passing banditOptions without requestParameters requires an initialized precomputedBanditStore`),this.precomputedFlagStore.salt||M.logger.error(`${M.loggerPrefix} EppoPrecomputedClient requires a precomputedFlagStore with a salt if requestParameters are not provided`),this.precomputedBanditStore&&!this.precomputedBanditStore.salt&&M.logger.warn(`${M.loggerPrefix} EppoPrecomputedClient missing or empty salt for precomputedBanditStore`))}async fetchPrecomputedFlags(){if(!this.requestParameters)throw new Error("Eppo SDK unable to fetch precomputed flags without the request parameters");this.requestPoller?.stop();let{apiKey:e,sdkName:r,sdkVersion:n,baseUrl:i,requestTimeoutMs:s=qe.DEFAULT_REQUEST_TIMEOUT_MS,numInitialRequestRetries:o=qe.DEFAULT_INITIAL_CONFIG_REQUEST_RETRIES,numPollRequestRetries:a=qe.DEFAULT_POLL_CONFIG_REQUEST_RETRIES,pollAfterSuccessfulInitialization:p=!1,pollAfterFailedInitialization:d=!1,throwOnFailedInitialization:b=!1,skipInitialPoll:A=!1}=this.requestParameters,{subjectKey:T,subjectAttributes:S}=this.subject,{pollingIntervalMs:C=qe.DEFAULT_POLL_INTERVAL_MS}=this.requestParameters;C<=0&&(M.logger.error("pollingIntervalMs must be greater than 0. Using default"),C=qe.DEFAULT_POLL_INTERVAL_MS);let N=new Nc.default({baseUrl:i??qe.PRECOMPUTED_BASE_URL,queryParams:{apiKey:e,sdkName:r,sdkVersion:n}}),O=new Fc.default(N,s),y=new Mc.default(O,this.precomputedFlagStore,T,S,this.precomputedBanditStore,this.banditActions),m=async()=>{if(await this.precomputedFlagStore.isExpired())return y.fetchAndStorePrecomputedFlags()};this.requestPoller=(0,Dc.default)(C,m,{maxStartRetries:o,maxPollRetries:a,pollAfterSuccessfulStart:p,pollAfterFailedStart:d,errorOnFailedStart:b,skipInitialPoll:A}),await this.requestPoller.start()}stopPolling(){this.requestPoller&&this.requestPoller.stop()}getPrecomputedAssignment(e,r,n,i=s=>s){(0,Rc.validateNotBlank)(e,"Invalid argument: flagKey cannot be blank");let s=this.getPrecomputedFlag(e);if(s==null)return M.logger.warn(`${M.loggerPrefix} No assigned variation. Flag not found: ${e}`),r;if(!(0,jc.checkTypeMatch)(n,s.variationType)){let a=`${M.loggerPrefix} Type mismatch: expected ${n} but flag ${e} has type ${s.variationType}`;return M.logger.error(a),r}let o={flagKey:e,format:this.precomputedFlagStore.getFormat()??"",subjectKey:this.subject.subjectKey??"",subjectAttributes:(0,_o.ensureNonContextualSubjectAttributes)(this.subject.subjectAttributes??{}),variation:{key:s.variationKey??"",value:s.variationValue},allocationKey:s.allocationKey??"",extraLogging:s.extraLogging??{},doLog:s.doLog};try{o?.doLog&&this.logAssignment(o)}catch(a){M.logger.error(`${M.loggerPrefix} Error logging assignment event: ${a}`)}try{return o.variation?.value!==void 0?i(o.variation.value):r}catch(a){return M.logger.error(`${M.loggerPrefix} Error transforming value: ${a}`),r}}getStringAssignment(e,r){return this.getPrecomputedAssignment(e,r,bt.VariationType.STRING)}getBooleanAssignment(e,r){return this.getPrecomputedAssignment(e,r,bt.VariationType.BOOLEAN)}getIntegerAssignment(e,r){return this.getPrecomputedAssignment(e,r,bt.VariationType.INTEGER)}getNumericAssignment(e,r){return this.getPrecomputedAssignment(e,r,bt.VariationType.NUMERIC)}getJSONAssignment(e,r){return this.getPrecomputedAssignment(e,r,bt.VariationType.JSON,n=>typeof n=="string"?JSON.parse(n):r)}getBanditAction(e,r){let n=this.getPrecomputedBandit(e);if(n==null)return M.logger.warn(`${M.loggerPrefix} No assigned variation. Bandit not found: ${e}`),{variation:r,action:null};let i=this.getStringAssignment(e,r),s={timestamp:new Date().toISOString(),featureFlag:e,bandit:n.banditKey,subject:this.subject.subjectKey??"",action:n.action,actionProbability:n.actionProbability,optimalityGap:n.optimalityGap,modelVersion:n.modelVersion,subjectNumericAttributes:n.actionNumericAttributes,subjectCategoricalAttributes:n.actionCategoricalAttributes,actionNumericAttributes:n.actionNumericAttributes,actionCategoricalAttributes:n.actionCategoricalAttributes,metaData:this.buildLoggerMetadata(),evaluationDetails:null};try{this.logBanditAction(s)}catch(o){M.logger.error(`${M.loggerPrefix} Error logging bandit action: ${o}`)}return{variation:i,action:s.action}}getPrecomputedFlag(e){return this.getObfuscatedFlag(e)}getObfuscatedFlag(e){let r=this.precomputedFlagStore.salt,n=(0,vo.getMD5Hash)(e,r),i=this.precomputedFlagStore.get(n);return i?(0,bo.decodePrecomputedFlag)(i):null}getPrecomputedBandit(e){let r=this.getObfuscatedPrecomputedBandit(e);return r?(0,bo.decodePrecomputedBandit)(r):null}getObfuscatedPrecomputedBandit(e){let r=this.precomputedBanditStore?.salt,n=(0,vo.getMD5Hash)(e,r);return this.precomputedBanditStore?.get(n)??null}isInitialized(){return this.precomputedFlagStore.isInitialized()}setAssignmentLogger(e){this.assignmentLogger=e,this.flushQueuedEvents(this.queuedAssignmentEvents,this.assignmentLogger?.logAssignment)}setBanditLogger(e){this.banditLogger=e,this.flushQueuedEvents(this.banditEventsQueue,this.banditLogger?.logBanditAction)}disableAssignmentCache(){this.assignmentCache=void 0}useNonExpiringInMemoryAssignmentCache(){this.assignmentCache=new Lc.NonExpiringInMemoryAssignmentCache}useLRUInMemoryAssignmentCache(e){this.assignmentCache=new Pc.LRUInMemoryAssignmentCache(e)}useCustomAssignmentCache(e){this.assignmentCache=e}flushQueuedEvents(e,r){let n=[...e];e.length=0,r&&n.forEach(i=>{try{r(i)}catch(s){M.logger.error(`${M.loggerPrefix} Error flushing event to logger: ${s.message}`)}})}logAssignment(e){let{flagKey:r,subjectKey:n,allocationKey:i,subjectAttributes:s,variation:o,format:a}=e,p={...e.extraLogging??{},allocation:i??null,experiment:i?`${r}-${i}`:null,featureFlag:r,format:a,variation:o?.key??null,subject:n,timestamp:new Date().toISOString(),subjectAttributes:s,metaData:this.buildLoggerMetadata(),evaluationDetails:null};if(!(o&&i&&this.assignmentCache?.has({flagKey:r,subjectKey:n,allocationKey:i,variationKey:o.key})))try{this.assignmentLogger?this.assignmentLogger.logAssignment(p):this.queuedAssignmentEvents.length<qe.MAX_EVENT_QUEUE_SIZE&&this.queuedAssignmentEvents.push(p),this.assignmentCache?.set({flagKey:r,subjectKey:n,allocationKey:i??"__eppo_no_allocation",variationKey:o?.key??"__eppo_no_variation"})}catch(d){M.logger.error(`${M.loggerPrefix} Error logging assignment event: ${d.message}`)}}logBanditAction(e){let r=e.subject,n=e.featureFlag,i=e.bandit,s=e.action??"__eppo_no_action",o={flagKey:n,subjectKey:r,banditKey:i,actionKey:s};if(!this.banditAssignmentCache?.has(o))try{this.banditLogger?this.banditLogger.logBanditAction(e):this.banditEventsQueue.push(e),this.banditAssignmentCache?.set(o)}catch(a){M.logger.warn("Error encountered logging bandit action",a)}}buildLoggerMetadata(){return{obfuscated:!0,sdkLanguage:"javascript",sdkLibVersion:xc.LIB_VERSION}}};Gn.default=$n});var So=E(er=>{"use strict";f();h();Object.defineProperty(er,"__esModule",{value:!0});er.HybridConfigurationStore=void 0;var Xt=ae(),Hn=class{constructor(e,r){this.servingStore=e,this.persistentStore=r,this.environment=null,this.configFetchedAt=null,this.configPublishedAt=null,this.format=null}async init(){if(!this.persistentStore)return;this.persistentStore.isInitialized()||Xt.logger.warn(`${Xt.loggerPrefix} Persistent store is not initialized from remote configuration. Serving assignments that may be stale.`);let e=await this.persistentStore.entries();this.servingStore.setEntries(e)}isInitialized(){return this.servingStore.isInitialized()&&(this.persistentStore?.isInitialized()??!0)}async isExpired(){return await this.persistentStore?.isExpired()??!0}get(e){return this.servingStore.isInitialized()||Xt.logger.warn(`${Xt.loggerPrefix} getting a value from a ServingStore that is not initialized.`),this.servingStore.get(e)}entries(){return this.servingStore.entries()}getKeys(){return this.servingStore.getKeys()}async setEntries(e){return this.persistentStore&&await this.persistentStore.setEntries(e),this.servingStore.setEntries(e),!0}setEnvironment(e){this.environment=e}getEnvironment(){return this.environment}getConfigFetchedAt(){return this.configFetchedAt}setConfigFetchedAt(e){this.configFetchedAt=e}getConfigPublishedAt(){return this.configPublishedAt}setConfigPublishedAt(e){this.configPublishedAt=e}getFormat(){return this.format}setFormat(e){this.format=e}};er.HybridConfigurationStore=Hn});var Ao=E(Ge=>{"use strict";f();h();Object.defineProperty(Ge,"__esModule",{value:!0});Ge.MemoryOnlyConfigurationStore=Ge.MemoryStore=void 0;var tr=class{constructor(){this.store={},this.initialized=!1}get(e){return this.store[e]??null}entries(){return this.store}getKeys(){return Object.keys(this.store)}isInitialized(){return this.initialized}setEntries(e){this.store={...e},this.initialized=!0}};Ge.MemoryStore=tr;var Jn=class{constructor(){this.servingStore=new tr,this.initialized=!1,this.configFetchedAt=null,this.configPublishedAt=null,this.environment=null,this.format=null}init(){return this.initialized=!0,Promise.resolve()}get(e){return this.servingStore.get(e)}entries(){return this.servingStore.entries()}getKeys(){return this.servingStore.getKeys()}async isExpired(){return!0}isInitialized(){return this.initialized}async setEntries(e){return this.servingStore.setEntries(e),this.initialized=!0,!0}getEnvironment(){return this.environment}setEnvironment(e){this.environment=e}getConfigFetchedAt(){return this.configFetchedAt}setConfigFetchedAt(e){this.configFetchedAt=e}getConfigPublishedAt(){return this.configPublishedAt}setConfigPublishedAt(e){this.configPublishedAt=e}getFormat(){return this.format}setFormat(e){this.format=e}};Ge.MemoryOnlyConfigurationStore=Jn});var Zn=E(Wn=>{"use strict";f();h();Object.defineProperty(Wn,"__esModule",{value:!0});var Uc=100,qc=1e4,Qn=class{constructor(e,r){this.eventQueue=e,this.batchSize=Math.max(Uc,Math.min(qc,r))}nextBatch(){return this.eventQueue.splice(this.batchSize)}push(...e){this.eventQueue.push(...e)}isEmpty(){return this.eventQueue.isEmpty()}};Wn.default=Qn});var Co=E(ei=>{"use strict";f();h();Object.defineProperty(ei,"__esModule",{value:!0});var Yn=ae(),Xn=class{constructor(e,r){this.delivery=e,this.config=r}async retry(e,r=0){let{retryIntervalMs:n,maxRetryDelayMs:i,maxRetries:s}=this.config,o=Math.min(n*Math.pow(2,r),i);Yn.logger.info(`[BatchRetryManager] Retrying batch delivery of ${e.length} events in ${o}ms...`),await new Promise(p=>setTimeout(p,o));let{failedEvents:a}=await this.delivery.deliver(e);return a.length===0?(Yn.logger.info(`[BatchRetryManager] Batch delivery successfully after ${r+1} tries.`),[]):r<s-1?this.retry(a,r+1):(Yn.logger.warn(`[BatchRetryManager] Failed to deliver batch after ${s} tries, bailing`),e)}};ei.default=Xn});var wo=E(ri=>{"use strict";f();h();Object.defineProperty(ri,"__esModule",{value:!0});var rr=ae(),ti=class{constructor(e,r){this.sdkKey=e,this.ingestionUrl=r}async deliver(e){try{rr.logger.info(`[EventDispatcher] Delivering batch of ${e.length} events to ${this.ingestionUrl}...`);let r=await fetch(this.ingestionUrl,{method:"POST",headers:{"Content-Type":"application/json","x-eppo-token":this.sdkKey},body:JSON.stringify({eppo_events:e})});return r.ok?await this.parseFailedEvents(r,e):{failedEvents:e}}catch(r){return rr.logger.warn("Failed to upload event batch",r),{failedEvents:e}}}async parseFailedEvents(e,r){rr.logger.info("[EventDispatcher] Batch delivered successfully.");let n=await e.json(),i=new Set(n?.failed_events||[]);return i.size>0?(rr.logger.warn(`[EventDispatcher] ${i.size}/${r.length} events failed ingestion.`),{failedEvents:r.filter(({uuid:s})=>i.has(s))}):{failedEvents:[]}}};ri.default=ti});var Oo=E(ii=>{"use strict";f();h();Object.defineProperty(ii,"__esModule",{value:!0});var Bc=Or(),To="v0/i",ni=class{decodeEventIngestionUrl(e){let r=e.split(".")[1];if(!r)return null;let n=Bc.Base64.decode(r),s=new URLSearchParams(n).get("eh");if(!s)return null;let o=s.endsWith("/")?`${s}${To}`:`${s}/${To}`;return!o.startsWith("http://")&&!o.startsWith("https://")?`https://${o}`:o}};ii.default=ni});var Io=E(le=>{"use strict";f();h();Object.defineProperty(le,"__esModule",{value:!0});le.DEFAULT_EVENT_DISPATCHER_CONFIG=le.DEFAULT_EVENT_DISPATCHER_BATCH_SIZE=void 0;le.newDefaultEventDispatcher=Gc;var He=ae(),Vc=Zn(),kc=Co(),zc=wo(),Kc=xn(),$c=Oo();le.DEFAULT_EVENT_DISPATCHER_BATCH_SIZE=1e3;le.DEFAULT_EVENT_DISPATCHER_CONFIG={deliveryIntervalMs:1e4,retryIntervalMs:5e3,maxRetryDelayMs:3e4,maxRetries:3};var nr=class{constructor(e,r,n){this.batchProcessor=e,this.networkStatusListener=r,this.dispatchTimer=null,this.isOffline=!1,this.ensureConfigFields(n);let{sdkKey:i,ingestionUrl:s,retryIntervalMs:o,maxRetryDelayMs:a,maxRetries:p=3}=n;this.eventDelivery=new zc.default(i,s),this.retryManager=new kc.default(this.eventDelivery,{retryIntervalMs:o,maxRetryDelayMs:a,maxRetries:p}),this.deliveryIntervalMs=n.deliveryIntervalMs,this.networkStatusListener.onNetworkStatusChange(d=>{He.logger.info(`[EventDispatcher] Network status change, isOffline=${d}.`),this.isOffline=d,d?this.dispatchTimer=null:this.maybeScheduleNextDelivery()})}dispatch(e){this.batchProcessor.push(e),this.maybeScheduleNextDelivery()}async deliverNextBatch(){if(this.isOffline){He.logger.warn("[EventDispatcher] Skipping delivery; network status is offline.");return}let e=this.batchProcessor.nextBatch();if(e.length===0){this.dispatchTimer=null;return}let{failedEvents:r}=await this.eventDelivery.deliver(e);if(r.length>0){He.logger.warn("[EventDispatcher] Failed to deliver some events from batch, retrying...");let n=await this.retryManager.retry(r);n.length>0&&this.batchProcessor.push(...n)}He.logger.debug(`[EventDispatcher] Delivered batch of ${e.length} events.`),this.dispatchTimer=null,this.maybeScheduleNextDelivery()}maybeScheduleNextDelivery(){!this.isOffline&&!this.batchProcessor.isEmpty()&&!this.dispatchTimer&&(He.logger.info(`[EventDispatcher] Scheduling next delivery in ${this.deliveryIntervalMs}ms.`),this.dispatchTimer=setTimeout(()=>this.deliverNextBatch(),this.deliveryIntervalMs))}ensureConfigFields(e){if(!e.ingestionUrl)throw new Error("Missing required ingestionUrl in EventDispatcherConfig");if(!e.deliveryIntervalMs)throw new Error("Missing required deliveryIntervalMs in EventDispatcherConfig");if(!e.retryIntervalMs)throw new Error("Missing required retryIntervalMs in EventDispatcherConfig");if(!e.maxRetryDelayMs)throw new Error("Missing required maxRetryDelayMs in EventDispatcherConfig")}};le.default=nr;function Gc(t,e,r,n=le.DEFAULT_EVENT_DISPATCHER_BATCH_SIZE,i=le.DEFAULT_EVENT_DISPATCHER_CONFIG){let o=new $c.default().decodeEventIngestionUrl(r);return o?new nr(new Vc.default(t,n),e,{...i,ingestionUrl:o,sdkKey:r}):(He.logger.debug("Unable to parse Event ingestion URL from SDK key, falling back to no-op event dispatcher"),new Kc.default)}});var Ie=E(I=>{"use strict";f();h();Object.defineProperty(I,"__esModule",{value:!0});I.decodePrecomputedFlag=I.DefaultEventDispatcher=I.BatchEventProcessor=I.newDefaultEventDispatcher=I.DEFAULT_EVENT_DISPATCHER_BATCH_SIZE=I.DEFAULT_EVENT_DISPATCHER_CONFIG=I.BoundedEventQueue=I.FormatEnum=I.VariationType=I.assignmentCacheValueToString=I.assignmentCacheKeyToString=I.LRUInMemoryAssignmentCache=I.NonExpiringInMemoryAssignmentCache=I.MemoryOnlyConfigurationStore=I.HybridConfigurationStore=I.MemoryStore=I.EppoPrecomputedClient=I.validation=I.HttpClient=I.FlagConfigRequestor=I.ApiEndpoints=I.constants=I.EppoClient=I.AbstractAssignmentCache=I.applicationLogger=I.loggerPrefix=void 0;var Hc=Ct();I.ApiEndpoints=Hc.default;var No=ae();Object.defineProperty(I,"applicationLogger",{enumerable:!0,get:function(){return No.logger}});Object.defineProperty(I,"loggerPrefix",{enumerable:!0,get:function(){return No.loggerPrefix}});var si=it();Object.defineProperty(I,"AbstractAssignmentCache",{enumerable:!0,get:function(){return si.AbstractAssignmentCache}});Object.defineProperty(I,"assignmentCacheKeyToString",{enumerable:!0,get:function(){return si.assignmentCacheKeyToString}});Object.defineProperty(I,"assignmentCacheValueToString",{enumerable:!0,get:function(){return si.assignmentCacheValueToString}});var Jc=Nt();Object.defineProperty(I,"LRUInMemoryAssignmentCache",{enumerable:!0,get:function(){return Jc.LRUInMemoryAssignmentCache}});var Qc=Lt();Object.defineProperty(I,"NonExpiringInMemoryAssignmentCache",{enumerable:!0,get:function(){return Qc.NonExpiringInMemoryAssignmentCache}});var Wc=$t();I.EppoClient=Wc.default;var Zc=Eo();I.EppoPrecomputedClient=Zc.default;var Yc=En();I.FlagConfigRequestor=Yc.default;var Xc=So();Object.defineProperty(I,"HybridConfigurationStore",{enumerable:!0,get:function(){return Xc.HybridConfigurationStore}});var Po=Ao();Object.defineProperty(I,"MemoryStore",{enumerable:!0,get:function(){return Po.MemoryStore}});Object.defineProperty(I,"MemoryOnlyConfigurationStore",{enumerable:!0,get:function(){return Po.MemoryOnlyConfigurationStore}});var el=ge();I.constants=el;var tl=kt();Object.defineProperty(I,"decodePrecomputedFlag",{enumerable:!0,get:function(){return tl.decodePrecomputedFlag}});var rl=Zn();I.BatchEventProcessor=rl.default;var nl=Dn();Object.defineProperty(I,"BoundedEventQueue",{enumerable:!0,get:function(){return nl.BoundedEventQueue}});var ir=Io();I.DefaultEventDispatcher=ir.default;Object.defineProperty(I,"DEFAULT_EVENT_DISPATCHER_CONFIG",{enumerable:!0,get:function(){return ir.DEFAULT_EVENT_DISPATCHER_CONFIG}});Object.defineProperty(I,"DEFAULT_EVENT_DISPATCHER_BATCH_SIZE",{enumerable:!0,get:function(){return ir.DEFAULT_EVENT_DISPATCHER_BATCH_SIZE}});Object.defineProperty(I,"newDefaultEventDispatcher",{enumerable:!0,get:function(){return ir.newDefaultEventDispatcher}});var il=Ht();I.HttpClient=il.default;var Lo=ye();Object.defineProperty(I,"VariationType",{enumerable:!0,get:function(){return Lo.VariationType}});Object.defineProperty(I,"FormatEnum",{enumerable:!0,get:function(){return Lo.FormatEnum}});var sl=Wt();I.validation=sl});var ui=E(ai=>{"use strict";f();h();Object.defineProperty(ai,"__esModule",{value:!0});var oi=class{constructor(e){this.storage=e}async has(e){return!!await this.get(e)}async get(e){var r;let n=await this.storage.get(e);return(r=n?.[e])!==null&&r!==void 0?r:void 0}async entries(){return await this.storage.get(null)}async set(e,r){await this.storage.set({[e]:r})}};ai.default=oi});var ci=E(Je=>{"use strict";f();h();Object.defineProperty(Je,"__esModule",{value:!0});Je.META_KEY=Je.CONFIGURATION_KEY=void 0;Je.CONFIGURATION_KEY="eppo-configuration";Je.META_KEY="eppo-configuration-meta"});var di=E(sr=>{"use strict";f();h();Object.defineProperty(sr,"__esModule",{value:!0});sr.ChromeStorageEngine=void 0;var Fo=ci(),li=class{constructor(e,r){this.storageMap=e,this.getContentsJsonString=async()=>{let i=await this.storageMap.get(this.contentsKey);return i??null},this.getMetaJsonString=async()=>{let i=await this.storageMap.get(this.metaKey);return i??null},this.setContentsJsonString=async i=>{await this.storageMap.set(this.contentsKey,i)},this.setMetaJsonString=async i=>{await this.storageMap.set(this.metaKey,i)};let n=r?`-${r}`:"";this.contentsKey=Fo.CONFIGURATION_KEY+n,this.metaKey=Fo.META_KEY+n}};sr.ChromeStorageEngine=li});var Do=E(or=>{"use strict";f();h();Object.defineProperty(or,"__esModule",{value:!0});or.IsolatableHybridConfigurationStore=void 0;var ol=Ie(),gi=class extends ol.HybridConfigurationStore{constructor(e,r,n="always"){super(e,r),this.servingStoreUpdateStrategy=n}async setEntries(e){var r;this.persistentStore&&await this.persistentStore.setEntries(e);let n=!this.persistentStore||await this.persistentStore.isExpired(),i=!(!((r=this.servingStore.getKeys())===null||r===void 0)&&r.length),s=this.servingStoreUpdateStrategy==="always"||n&&this.servingStoreUpdateStrategy==="expired"||n&&i;return s&&this.servingStore.setEntries(e),s}};or.IsolatableHybridConfigurationStore=gi});var Ro=E(ar=>{"use strict";f();h();Object.defineProperty(ar,"__esModule",{value:!0});ar.LocalStorageEngine=void 0;var Mo=ci(),fi=class{constructor(e,r){this.localStorage=e,this.getContentsJsonString=async()=>this.localStorage.getItem(this.contentsKey),this.getMetaJsonString=async()=>this.localStorage.getItem(this.metaKey),this.setContentsJsonString=async i=>{this.localStorage.setItem(this.contentsKey,i)},this.setMetaJsonString=async i=>{this.localStorage.setItem(this.metaKey,i)};let n=r?`-${r}`:"";this.contentsKey=Mo.CONFIGURATION_KEY+n,this.metaKey=Mo.META_KEY+n}};ar.LocalStorageEngine=fi});var xo=E(ur=>{"use strict";f();h();Object.defineProperty(ur,"__esModule",{value:!0});ur.StringValuedAsyncStore=void 0;var hi=class{constructor(e,r=0){this.storageEngine=e,this.cooldownSeconds=r,this.initialized=!1}isInitialized(){return this.initialized}async isExpired(){if(!this.cooldownSeconds)return!0;let e=await this.storageEngine.getMetaJsonString(),r=!0;if(e){let i=JSON.parse(e).lastUpdatedAtMs;r=!i||Date.now()-i>this.cooldownSeconds*1e3}return r}async entries(){let e=await this.storageEngine.getContentsJsonString();return e?JSON.parse(e):{}}async setEntries(e){await this.storageEngine.setContentsJsonString(JSON.stringify(e));let r={lastUpdatedAtMs:new Date().getTime()};await this.storageEngine.setMetaJsonString(JSON.stringify(r)),this.initialized=!0}};ur.StringValuedAsyncStore=hi});var cr=E(J=>{"use strict";f();h();Object.defineProperty(J,"__esModule",{value:!0});J.localStorageIfAvailable=J.hasWindowLocalStorage=J.chromeStorageIfAvailable=J.hasChromeStorage=J.configurationStorageFactory=J.precomputedBanditStoreFactory=J.precomputedFlagsStorageFactory=void 0;var Be=Ie(),al=ui(),ul=di(),pi=Do(),cl=Ro(),jo=xo();function ll(){return new Be.MemoryOnlyConfigurationStore}J.precomputedFlagsStorageFactory=ll;function dl(){return new Be.MemoryOnlyConfigurationStore}J.precomputedBanditStoreFactory=dl;function gl({maxAgeSeconds:t=0,servingStoreUpdateStrategy:e="always",hasChromeStorage:r=!1,hasWindowLocalStorage:n=!1,persistentStore:i=void 0,forceMemoryOnly:s=!1},{chromeStorage:o,windowLocalStorage:a,storageKeySuffix:p}={}){if(s)return new Be.MemoryOnlyConfigurationStore;if(i)return new pi.IsolatableHybridConfigurationStore(new Be.MemoryStore,i,e);if(r&&o){let d=new ul.ChromeStorageEngine(new al.default(o),p??"");return new pi.IsolatableHybridConfigurationStore(new Be.MemoryStore,new jo.StringValuedAsyncStore(d,t),e)}else if(n&&a){let d=new cl.LocalStorageEngine(a,p??"");return new pi.IsolatableHybridConfigurationStore(new Be.MemoryStore,new jo.StringValuedAsyncStore(d,t),e)}return new Be.MemoryOnlyConfigurationStore}J.configurationStorageFactory=gl;function Uo(){return typeof chrome<"u"&&!!chrome.storage}J.hasChromeStorage=Uo;function fl(){return Uo()?chrome.storage.local:void 0}J.chromeStorageIfAvailable=fl;function qo(){try{return typeof self<"u"&&!!self.localStorage}catch{return!1}}J.hasWindowLocalStorage=qo;function hl(){return qo()?self.localStorage:void 0}J.localStorageIfAvailable=hl});var Vo=E(yi=>{"use strict";f();h();Object.defineProperty(yi,"__esModule",{value:!0});var Bo=Ie(),pl=ui(),mi=class{constructor(e){this.storage=new pl.default(e)}set(e){this.storage.set((0,Bo.assignmentCacheKeyToString)(e),(0,Bo.assignmentCacheValueToString)(e))}has(e){throw new Error("This should never be called for ChromeStorageAssignmentCache, use getEntries() instead.")}async getEntries(){let e=await this.storage.entries();return Object.entries(e).map(([r,n])=>[r,n])}};yi.default=mi});var vi=E(bi=>{"use strict";f();h();Object.defineProperty(bi,"__esModule",{value:!0});var _i=class{constructor(e,r){this.servingStore=e,this.persistentStore=r}async init(){let e=await this.persistentStore.getEntries();e&&this.servingStore.setEntries(e)}set(e){this.servingStore.set(e),this.persistentStore.set(e)}has(e){return this.servingStore.has(e)}};bi.default=_i});var zo=E(lr=>{"use strict";f();h();var ko;Object.defineProperty(lr,"__esModule",{value:!0});lr.LocalStorageAssignmentShim=void 0;var ml=cr(),Ei=class{constructor(e){if(this.size=this.getCache().size,this[ko]=this.getCache()[Symbol.toStringTag],!(0,ml.hasWindowLocalStorage)())throw new Error("LocalStorage is not available");let r=e?`-${e}`:"";this.localStorageKey=`eppo-assignment${r}`}clear(){this.getCache().clear()}delete(e){return this.getCache().delete(e)}forEach(e,r){this.getCache().forEach(e,r)}entries(){return this.getCache().entries()}keys(){return this.getCache().keys()}values(){return this.getCache().values()}[Symbol.iterator](){return this.getCache()[Symbol.iterator]()}has(e){return this.getCache().has(e)}get(e){var r;return(r=this.getCache().get(e))!==null&&r!==void 0?r:void 0}set(e,r){return this.setCache(this.getCache().set(e,r))}getCache(){let e=self.localStorage.getItem(this.localStorageKey);return e?new Map(JSON.parse(e)):new Map}setCache(e){return self.localStorage.setItem(this.localStorageKey,JSON.stringify(Array.from(e.entries()))),this}};lr.LocalStorageAssignmentShim=Ei;ko=Symbol.toStringTag});var Ko=E(dr=>{"use strict";f();h();Object.defineProperty(dr,"__esModule",{value:!0});dr.LocalStorageAssignmentCache=void 0;var yl=Ie(),_l=zo(),Si=class extends yl.AbstractAssignmentCache{constructor(e){super(new _l.LocalStorageAssignmentShim(e))}setEntries(e){e.forEach(([r,n])=>{r&&n&&this.delegate.set(r,n)})}getEntries(){return Promise.resolve(Array.from(this.entries()))}};dr.LocalStorageAssignmentCache=Si});var $o=E(Ci=>{"use strict";f();h();Object.defineProperty(Ci,"__esModule",{value:!0});var bl=Ie(),Ai=class{constructor(){this.store=new Map,this.cache=new bl.NonExpiringInMemoryAssignmentCache(this.store)}set(e){this.cache.set(e)}has(e){return this.cache.has(e)}setEntries(e){let{store:r}=this;e.forEach(([n,i])=>r.set(n,i))}getEntries(){return Promise.resolve(Array.from(this.cache.entries()))}};Ci.default=Ai});var Ho=E(gr=>{"use strict";f();h();Object.defineProperty(gr,"__esModule",{value:!0});gr.assignmentCacheFactory=void 0;var vl=cr(),El=Vo(),Go=vi(),Sl=Ko(),Al=$o();function Cl({forceMemoryOnly:t=!1,chromeStorage:e,storageKeySuffix:r}){let n=new Al.default;if(t)return n;if(e){let i=new El.default(e);return new Go.default(n,i)}else if((0,vl.hasWindowLocalStorage)()){let i=new Sl.LocalStorageAssignmentCache(r);return new Go.default(n,i)}else return n}gr.assignmentCacheFactory=Cl});var Jo=E(Ne=>{"use strict";f();h();Object.defineProperty(Ne,"__esModule",{value:!0});Ne.ConfigSource=Ne.ConfigLoaderStatus=void 0;var wl;(function(t){t[t.FAILED=0]="FAILED",t[t.DID_NOT_PRODUCE=1]="DID_NOT_PRODUCE",t[t.COMPLETED=2]="COMPLETED"})(wl=Ne.ConfigLoaderStatus||(Ne.ConfigLoaderStatus={}));var Tl;(function(t){t[t.CONFIG_STORE=0]="CONFIG_STORE",t[t.FETCH=1]="FETCH",t[t.NONE=2]="NONE"})(Tl=Ne.ConfigSource||(Ne.ConfigSource={}))});var Qo=E(Ti=>{"use strict";f();h();Object.defineProperty(Ti,"__esModule",{value:!0});var Ol=200,wi=class{constructor(){if(this.listeners=[],this.debounceTimer=null,typeof self>"u")throw new Error("BrowserNetworkStatusListener can only be used in a browser environment");this._isOffline=typeof navigator.onLine=="boolean"?!navigator.onLine:!1,self.addEventListener("offline",()=>this.notifyListeners(!0)),self.addEventListener("online",()=>this.notifyListeners(!1))}isOffline(){return this._isOffline}onNetworkStatusChange(e){this.listeners.push(e)}removeNetworkStatusChange(e){let r=this.listeners.indexOf(e);r!==-1&&this.listeners.splice(r,1)}notifyListeners(e){this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(()=>{this._isOffline=e,[...this.listeners].forEach(r=>r(e))},Ol)}};Ti.default=wi});var Wo=E(fr=>{"use strict";f();h();Object.defineProperty(fr,"__esModule",{value:!0});fr.takeWhile=void 0;function Il(t,e){let r=[];for(let n of t){if(!e(n))break;r.push(n)}return r}fr.takeWhile=Il});var Zo=E(Ii=>{"use strict";f();h();Object.defineProperty(Ii,"__esModule",{value:!0});var Nl=Ie(),Pl=Wo(),Oi=class{constructor(e){this.name=e,this.eventKeys=[],this.localStorageKey=`eventQueue:${this.name}`,this.loadStateFromLocalStorage()}splice(e){let r=Array.from({length:e},()=>this.shift());return(0,Pl.takeWhile)(r,n=>n!==void 0)}isEmpty(){return this.length===0}get length(){return this.eventKeys.length}push(e){let r=this.generateEventKey(e),n=JSON.stringify(e);localStorage.setItem(r,n),this.eventKeys.push(r),this.saveStateToLocalStorage()}*[Symbol.iterator](){for(let e of this.eventKeys){let r=localStorage.getItem(e);r&&(yield JSON.parse(r))}}shift(){if(this.eventKeys.length===0)return;let e=this.eventKeys.shift();if(!e)throw new Error("Unexpected undefined event key");let r=localStorage.getItem(e);if(r)return localStorage.removeItem(e),this.saveStateToLocalStorage(),JSON.parse(r)}loadStateFromLocalStorage(){let e=localStorage.getItem(this.localStorageKey);if(e)try{this.eventKeys=JSON.parse(e)}catch{Nl.applicationLogger.error(`Failed to parse event queue ${this.name} state. Initializing empty queue.`),this.eventKeys=[]}}saveStateToLocalStorage(){let e=JSON.stringify(this.eventKeys);localStorage.setItem(this.localStorageKey,e)}generateEventKey(e){let r=this.hashEvent(e);return`eventQueue:${this.name}:${r}`}hashEvent(e){let r=JSON.stringify(e),n=0;for(let i=0;i<r.length;i++)n=(n<<5)-n+r.charCodeAt(i),n|=0;return n.toString(36)}};Ii.default=Oi});var Yo=E((xp,Ll)=>{Ll.exports={name:"@eppo/js-client-sdk",version:"3.9.7",description:"Eppo SDK for client-side JavaScript applications",main:"dist/index.js",files:["/dist","/src","!*.spec.ts"],types:"dist/index.d.ts",scripts:{lint:"eslint '**/*.ts' --cache","lint:fix":"eslint --fix '**/*.ts' --cache","lint:fix-pre-commit":"eslint -c .eslintrc.pre-commit.js --fix '**/*.ts' --no-eslintrc --cache",prepare:"make prepare","pre-commit":"lint-staged && tsc && yarn docs",typecheck:"tsc",test:"yarn test:unit","test:unit":"NODE_ENV=test jest '.*\\.spec\\.ts'",docs:"api-documenter markdown -i ./temp -o ./docs"},jsdelivr:"dist/eppo-sdk.js",repository:{type:"git",url:"git+https://github.com/Eppo-exp/js-client-sdk.git"},author:"",license:"MIT",bugs:{url:"https://github.com/Eppo-exp/js-client-sdk/issues"},homepage:"https://github.com/Eppo-exp/js-client-sdk#readme",devDependencies:{"@microsoft/api-documenter":"^7.26.3","@microsoft/api-extractor":"^7.48.1","@types/chrome":"^0.0.268","@types/jest":"^29.5.11","@types/spark-md5":"^3.0.5","@typescript-eslint/eslint-plugin":"^5.13.0","@typescript-eslint/parser":"^5.13.0",eslint:"^8.17.0","eslint-config-prettier":"^9.1.0","eslint-import-resolver-typescript":"^3.6.3","eslint-plugin-import":"^2.25.4","eslint-plugin-prettier":"^5.2.1","eslint-plugin-promise":"^7.2.1",husky:"^9.1.7",jest:"^29.7.0","jest-environment-jsdom":"^29.7.0","lint-staged":"^15.4.1",prettier:"^3.4.2","terser-webpack-plugin":"^5.3.3",testdouble:"^3.20.2","ts-jest":"^29.1.1","ts-loader":"^9.3.1","ts-node":"^10.9.2",typescript:"^4.7.4",webpack:"^5.73.0","webpack-cli":"^6.0.1"},dependencies:{"@eppo/js-client-sdk-common":"4.8.4"},packageManager:"yarn@1.22.22+sha512.a6b2f7906b721bba3d67d4aff083df04dad64c399707841b7acf00f6b133b7ac24255f2652fa22ae3534329dc6180534e98d17432037ff6fd140556e2bb3137e"}});var Xo=E(Qe=>{"use strict";f();h();Object.defineProperty(Qe,"__esModule",{value:!0});Qe.sdkName=Qe.sdkVersion=void 0;var Fl=Yo();Qe.sdkVersion=Fl.version;Qe.sdkName="js-client-sdk"});var na=E(x=>{"use strict";f();h();Object.defineProperty(x,"__esModule",{value:!0});x.getPrecomputedInstance=x.offlinePrecomputedInit=x.precomputedInit=x.EppoPrecomputedJSClient=x.getConfigUrl=x.getInstance=x.init=x.offlineInit=x.buildStorageKeySuffix=x.EppoJSClient=x.ChromeStorageEngine=void 0;var F=Ie(),ea=Ho(),Dl=vi(),Y=Jo(),ee=cr(),Ml=Qo(),Rl=Zo(),We=Xo(),xl=di();Object.defineProperty(x,"ChromeStorageEngine",{enumerable:!0,get:function(){return xl.ChromeStorageEngine}});var jl=(0,ee.configurationStorageFactory)({forceMemoryOnly:!0}),ta=(0,ee.precomputedFlagsStorageFactory)(),Ul=(0,ee.precomputedBanditStoreFactory)(),U=class t extends F.EppoClient{getStringAssignment(e,r,n,i){return t.ensureInitialized(),super.getStringAssignment(e,r,n,i)}getStringAssignmentDetails(e,r,n,i){return t.ensureInitialized(),super.getStringAssignmentDetails(e,r,n,i)}getBoolAssignment(e,r,n,i){return this.getBooleanAssignment(e,r,n,i)}getBooleanAssignment(e,r,n,i){return t.ensureInitialized(),super.getBooleanAssignment(e,r,n,i)}getBooleanAssignmentDetails(e,r,n,i){return t.ensureInitialized(),super.getBooleanAssignmentDetails(e,r,n,i)}getIntegerAssignment(e,r,n,i){return t.ensureInitialized(),super.getIntegerAssignment(e,r,n,i)}getIntegerAssignmentDetails(e,r,n,i){return t.ensureInitialized(),super.getIntegerAssignmentDetails(e,r,n,i)}getNumericAssignment(e,r,n,i){return t.ensureInitialized(),super.getNumericAssignment(e,r,n,i)}getNumericAssignmentDetails(e,r,n,i){return t.ensureInitialized(),super.getNumericAssignmentDetails(e,r,n,i)}getJSONAssignment(e,r,n,i){return t.ensureInitialized(),super.getJSONAssignment(e,r,n,i)}getJSONAssignmentDetails(e,r,n,i){return t.ensureInitialized(),super.getJSONAssignmentDetails(e,r,n,i)}getBanditAction(e,r,n,i,s){return t.ensureInitialized(),super.getBanditAction(e,r,n,i,s)}getBanditActionDetails(e,r,n,i,s){return t.ensureInitialized(),super.getBanditActionDetails(e,r,n,i,s)}getExperimentContainerEntry(e,r,n){return t.ensureInitialized(),super.getExperimentContainerEntry(e,r,n)}static ensureInitialized(){t.initialized||F.applicationLogger.warn("Eppo SDK assignment requested before init() completed")}};x.EppoJSClient=U;U.instance=new U({flagConfigurationStore:jl,isObfuscated:!0});U.initialized=!1;function ra(t){return t.replace(/\W/g,"").substring(0,8)}x.buildStorageKeySuffix=ra;function ql(t){var e,r;let n=(e=t.isObfuscated)!==null&&e!==void 0?e:!1,i=(r=t.throwOnFailedInitialization)!==null&&r!==void 0?r:!0;try{let s=(0,ee.configurationStorageFactory)({forceMemoryOnly:!0});s.setEntries(t.flagsConfiguration).catch(p=>F.applicationLogger.warn("Error setting flags for memory-only configuration store",p)),U.instance.setFlagConfigurationStore(s),U.instance.setIsObfuscated(n),t.assignmentLogger&&U.instance.setAssignmentLogger(t.assignmentLogger),t.banditLogger&&U.instance.setBanditLogger(t.banditLogger);let a=(0,ea.assignmentCacheFactory)({storageKeySuffix:"offline",forceMemoryOnly:!0});U.instance.useCustomAssignmentCache(a)}catch(s){if(F.applicationLogger.warn("Eppo SDK encountered an error initializing, assignment calls will return the default value and not be logged"),i)throw s}return U.initialized=!0,U.instance}x.offlineInit=ql;var hr=null;async function Bl(t){F.validation.validateNotBlank(t.apiKey,"API key required"),hr||(hr=Vl(t));let e=await hr;return hr=null,e}x.init=Bl;async function Vl(t){var e;F.validation.validateNotBlank(t.apiKey,"API key required");let r,n=U.instance,{apiKey:i,persistentStore:s,baseUrl:o,maxCacheAgeSeconds:a,updateOnFetch:p,forceReinitialize:d,requestTimeoutMs:b,numInitialRequestRetries:A,numPollRequestRetries:T,pollingIntervalMs:S,pollAfterSuccessfulInitialization:C=!1,pollAfterFailedInitialization:N=!1,skipInitialRequest:O=!1,eventIngestionConfig:y}=t;try{if(U.initialized)if(d)F.applicationLogger.warn("Eppo SDK is already initialized, reinitializing since forceReinitialize is true."),U.initialized=!1;else return F.applicationLogger.warn("Eppo SDK is already initialized, skipping reinitialization since forceReinitialize is false."),n;n.stopPolling(),n.setAssignmentLogger(t.assignmentLogger),t.banditLogger&&n.setBanditLogger(t.banditLogger),n.setIsObfuscated(!0);let m=ra(i),c=(0,ee.configurationStorageFactory)({maxAgeSeconds:a,servingStoreUpdateStrategy:p,persistentStore:s,hasChromeStorage:(0,ee.hasChromeStorage)(),hasWindowLocalStorage:(0,ee.hasWindowLocalStorage)()},{chromeStorage:(0,ee.chromeStorageIfAvailable)(),windowLocalStorage:(0,ee.localStorageIfAvailable)(),storageKeySuffix:m});n.setFlagConfigurationStore(c);let u=(0,ea.assignmentCacheFactory)({chromeStorage:(0,ee.chromeStorageIfAvailable)(),storageKeySuffix:m});u instanceof Dl.default&&await u.init(),n.useCustomAssignmentCache(u);let g={apiKey:i,sdkName:We.sdkName,sdkVersion:We.sdkVersion,baseUrl:o,requestTimeoutMs:b,numInitialRequestRetries:A,numPollRequestRetries:T,pollAfterSuccessfulInitialization:C,pollAfterFailedInitialization:N,pollingIntervalMs:S,throwOnFailedInitialization:!0,skipInitialPoll:O};n.setConfigurationRequestParameters(g),n.setEventDispatcher(Jl(i,y));let l,D,W=c.init().then(async()=>{if(!c.getKeys().length)return F.applicationLogger.warn("Eppo SDK cached configuration is empty"),l=new Error("Configuration store was empty"),Y.ConfigLoaderStatus.DID_NOT_PRODUCE;let Q=await c.isExpired();return Q&&!t.useExpiredCache?(F.applicationLogger.warn("Eppo SDK set not to use expired cached configuration"),l=new Error("Configuration store was expired"),Y.ConfigLoaderStatus.DID_NOT_PRODUCE):(Q&&t.useExpiredCache&&F.applicationLogger.warn("Eppo SDK config.useExpiredCache is true; using expired cache"),Y.ConfigLoaderStatus.COMPLETED)}).catch(Q=>(F.applicationLogger.warn("Eppo SDK encountered an error initializing from the configuration store",Q),l=Q,Y.ConfigLoaderStatus.FAILED)).then(Q=>({source:Y.ConfigSource.CONFIG_STORE,result:Q})),Z=n.fetchFlagConfigurations().then(()=>c.isInitialized()?Y.ConfigLoaderStatus.COMPLETED:Y.ConfigLoaderStatus.DID_NOT_PRODUCE).catch(Q=>(F.applicationLogger.warn("Eppo SDK encountered an error initializing from fetching",Q),D=Q,Y.ConfigLoaderStatus.FAILED)).then(Q=>({source:Y.ConfigSource.FETCH,result:Q})),be=[W];t.skipInitialRequest||be.push(Z);let ve,{source:Ze,result:vt}=await Promise.race(be);vt===Y.ConfigLoaderStatus.COMPLETED?ve=Ze:ve=await(Ze===Y.ConfigSource.FETCH?W:Z).then(Et=>{let{source:Ye,result:pr}=Et;return pr===Y.ConfigLoaderStatus.COMPLETED?Ye:Y.ConfigSource.NONE}),ve===Y.ConfigSource.NONE&&(r=D||l||new Error("Eppo SDK: No configuration source produced a valid configuration")),F.applicationLogger.debug("Initialization source",ve)}catch(m){r=m instanceof Error?m:new Error(String(m))}if(r&&(F.applicationLogger.warn("Eppo SDK was unable to initialize with a configuration, assignment calls will return the default value and not be logged"+(t.pollAfterFailedInitialization?" until an experiment configuration is successfully retrieved":"")),!((e=t.throwOnFailedInitialization)!==null&&e!==void 0)||e))throw r;return U.initialized=!0,n}function kl(){return U.instance}x.getInstance=kl;function zl(t,e){let r={sdkName:We.sdkName,sdkVersion:We.sdkVersion,apiKey:t};return new F.ApiEndpoints({baseUrl:e,queryParams:r}).ufcEndpoint()}x.getConfigUrl=zl;var R=class t extends F.EppoPrecomputedClient{getStringAssignment(e,r){return t.getAssignmentInitializationCheck(),super.getStringAssignment(e,r)}getBooleanAssignment(e,r){return t.getAssignmentInitializationCheck(),super.getBooleanAssignment(e,r)}getIntegerAssignment(e,r){return t.getAssignmentInitializationCheck(),super.getIntegerAssignment(e,r)}getNumericAssignment(e,r){return t.getAssignmentInitializationCheck(),super.getNumericAssignment(e,r)}getJSONAssignment(e,r){return t.getAssignmentInitializationCheck(),super.getJSONAssignment(e,r)}getBanditAction(e,r){return t.getAssignmentInitializationCheck(),super.getBanditAction(e,r)}static getAssignmentInitializationCheck(){U.initialized||F.applicationLogger.warn("Eppo SDK assignment requested before init() completed")}};x.EppoPrecomputedJSClient=R;R.instance=new R({precomputedFlagStore:ta,subject:{subjectKey:"",subjectAttributes:{}}});R.initialized=!1;async function Kl(t){if(R.initialized)return R.instance;F.validation.validateNotBlank(t.apiKey,"API key required"),F.validation.validateNotBlank(t.precompute.subjectKey,"Subject key required");let{apiKey:e,precompute:{subjectKey:r,subjectAttributes:n={},banditActions:i},baseUrl:s,requestTimeoutMs:o,numInitialRequestRetries:a,numPollRequestRetries:p,pollingIntervalMs:d,pollAfterSuccessfulInitialization:b=!1,pollAfterFailedInitialization:A=!1,skipInitialRequest:T=!1}=t,S={apiKey:e,sdkName:We.sdkName,sdkVersion:We.sdkVersion,baseUrl:s,requestTimeoutMs:o,numInitialRequestRetries:a,numPollRequestRetries:p,pollAfterSuccessfulInitialization:b,pollAfterFailedInitialization:A,pollingIntervalMs:d,throwOnFailedInitialization:!0,skipInitialPoll:T},C={subjectKey:r,subjectAttributes:n};return R.instance=new R({precomputedFlagStore:ta,requestParameters:S,subject:C,precomputedBanditStore:Ul,banditActions:i}),R.instance.setAssignmentLogger(t.assignmentLogger),t.banditLogger&&R.instance.setBanditLogger(t.banditLogger),await R.instance.fetchPrecomputedFlags(),R.initialized=!0,R.instance}x.precomputedInit=Kl;function $l(t){var e;let r=(e=t.throwOnFailedInitialization)!==null&&e!==void 0?e:!0,n;try{if(n=JSON.parse(t.precomputedConfiguration),!n.precomputed)throw new Error}catch{let d="Invalid precomputed configuration wire";if(r)throw new Error(d);return F.applicationLogger.error(`[Eppo SDK] ${d}`),R.instance}let{subjectKey:i,subjectAttributes:s,response:o}=n.precomputed,a=JSON.parse(o);try{let p=(0,ee.precomputedFlagsStorageFactory)();p.setEntries(a.flags).catch(A=>F.applicationLogger.warn("Error setting precomputed assignments for memory-only store",A)),p.salt=a.salt;let d=(0,ee.precomputedBanditStoreFactory)();d.setEntries(a.bandits).catch(A=>F.applicationLogger.warn("Error setting precomputed bandits for memory-only store",A)),d.salt=a.salt;let b={subjectKey:i,subjectAttributes:s??{}};Gl(),R.instance=new R({precomputedFlagStore:p,precomputedBanditStore:d,subject:b}),t.assignmentLogger&&R.instance.setAssignmentLogger(t.assignmentLogger),t.banditLogger&&R.instance.setBanditLogger(t.banditLogger)}catch(p){if(F.applicationLogger.warn("[Eppo SDK] Encountered an error initializing precomputed client, assignment calls will return the default value and not be logged"),r)throw p}return R.initialized=!0,R.instance}x.offlinePrecomputedInit=$l;function Gl(){R.initialized&&(R.instance.stopPolling(),R.initialized=!1,F.applicationLogger.warn("[Eppo SDK] Precomputed client is being re-initialized."))}function Hl(){return R.instance}x.getPrecomputedInstance=Hl;function Jl(t,e={}){let{batchSize:r=1e3,deliveryIntervalMs:n=1e4,retryIntervalMs:i=5e3,maxRetryDelayMs:s=3e4,maxRetries:o=3,maxQueueSize:a=1e4}=e,p=(0,ee.hasWindowLocalStorage)()?new Rl.default("events"):new F.BoundedEventQueue("events",[],a),b=typeof self<"u"?new Ml.default:{isOffline:()=>!1,onNetworkStatusChange:()=>{}};return(0,F.newDefaultEventDispatcher)(p,b,t,r,{deliveryIntervalMs:n,retryIntervalMs:i,maxRetryDelayMs:s,maxRetries:o})}});f();h();var Yl=aa(na());f();h();var Ql={enabled:!0,clientToken:v.DATADOG_CLIENT_TOKEN,applicationId:"3f3bc3b0-8d80-4b31-b4b9-9909de4d243a",service:"browser-ext-frontend",traceSampleRate:1,sessionSampleRate:1},Wl={enabled:!0,dsn:"https://pub5df2cf131c51c4215f2ca3aa32d4e4b7@sentry-intake.datadoghq.com/1",sampleRate:.1,tracesSampleRate:0,initialScope:{tags:{service:"browser-ext-background",version:et}}};async function Ni(t,e){await tt.init({appVersion:et,sentry:t==="frontend"?{enabled:!1}:Wl,datadog:t==="frontend"?Ql:{enabled:!1}}),e&&await tt.setUser({id:e})}f();h();var Pi=class{requests=[];maxRequests=0;allowedDomains=["phantom.app","phantom.com"];ignoredHosts=new Set;ignoredUrls=new Set;ignoredPatterns;init(e={maxRequests:20,ignoredUrls:[],ignoredHosts:[]}){this.maxRequests=e.maxRequests,this.ignoredUrls=new Set(e.ignoredUrls),this.ignoredHosts=new Set(e.ignoredHosts);let r=self.fetch;self.fetch=async(...n)=>{let[i,s]=n,o=s?.method||"GET",a={};if(s?.headers instanceof Headers?s.headers.forEach((S,C)=>{a[C]=S}):Array.isArray(s?.headers)?s.headers.forEach(([S,C])=>{a[S]=C}):a=s?.headers||{},this.shouldIgnoreRequest(i.toString()))return r(...n);let d={id:`${Date.now()}-${Math.random()}`,method:o,url:i.toString(),requestHeaders:a,startTime:Date.now()};this.requests.length>=this.maxRequests&&this.requests.pop(),this.requests.unshift(d);let b=await r(...n),T=await b.clone().text();return d.status=b.status,d.responseHeaders={},b.headers.forEach((S,C)=>{d.responseHeaders[C]=S}),d.endTime=Date.now(),d.response=T,b}}shouldIgnoreRequest(e){try{let r=new URL(e).hostname;return this.ignoredHosts&&this.ignoredHosts.has(r)||this.ignoredUrls&&this.ignoredUrls.has(e)||!this.allowedDomains.some(n=>r.includes(n))?!0:!!(this.ignoredPatterns&&this.ignoredPatterns.some(n=>n.test(e)))}catch{return!0}}getRequests(){return this.requests}clearRequests(){this.requests=[]}setIgnoredHosts(e){this.ignoredHosts=new Set(e)}setIgnoredUrls(e){this.ignoredUrls=new Set(e)}setIgnoredPatterns(e){this.ignoredPatterns=e}clearIgnoredHosts(){this.ignoredHosts=new Set}clearIgnoredUrls(){this.ignoredUrls=new Set}clearIgnoredPatterns(){this.ignoredPatterns=void 0}},Zl=new Pi,ia=Zl;var sa=new Gi,Xl=(t,e=!0)=>Ve.isMultivariateFeatureEnabled(t,e),ed=Mi(Xl,{forceRefresh:yr}),um=t=>ed(t),td=async()=>{if(Ri()){let t=[new zi({eppoSDK:Yl,apiKey:Ui,subjectId:await rt.getDeviceId(),deviceAttributes:{appVersion:et,platform:"browser-ext",deviceId:await rt.getDeviceId()},maxCacheAgeSeconds:qi,analytics:rt}),new Bi(ji)];yr&&t.push(new ki({storage:sa})),Ve.setProviders(t)}else Ve.setProviders([new Ki(sa)]);await Ve.initializeFeatureFlags()},cm=t=>{rt.getDeviceId().then(e=>{td().then(()=>{Ni(t,e),rd(),$i(Hi),xi(e)})}).catch(e=>{Ni(t).then(()=>{tt.captureError(e,"startUp")})})},rd=()=>{let t=Ve.getMultivariateAssignment("network-logger-config-json");if(t)try{let e=JSON.parse(t),r=Vi.parse(e);ia.init({ignoredHosts:r.ignoredHosts,maxRequests:r.maxRequests,ignoredUrls:r.ignoredUrls})}catch(e){console.error("Error initializing network logger",e)}};export{ia as a,um as b,cm as c};
//# sourceMappingURL=chunk-MDGK3JFM.js.map
