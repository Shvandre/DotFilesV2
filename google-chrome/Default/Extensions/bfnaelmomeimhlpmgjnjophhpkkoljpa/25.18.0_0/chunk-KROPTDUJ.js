import{b as M}from"./chunk-MDGK3JFM.js";import{$ as Ee,aa as W,fc as De}from"./chunk-5HSK4GMQ.js";import{w as Ae}from"./chunk-QCTV7K6S.js";import{a as P,c as Te}from"./chunk-WN5BOODY.js";import{x as Ie,y as K}from"./chunk-LWEFQGDN.js";import{Da as pe,Eb as de,Oc as le,Pc as me,Sc as T,Tc as ge,Uc as he,Vc as ye,Wc as Re,Xc as xe,Ya as q,Yc as Se,_c as we,cd as Ce,oc as fe}from"./chunk-3GZCHS7Y.js";import{i as k}from"./chunk-SK6BTSEQ.js";import{D as ae,E as ue,I as ce}from"./chunk-WP4K54AS.js";import{C as w}from"./chunk-UCPKAIVR.js";import{U as ie,s as v}from"./chunk-NL7NWYRL.js";import{c as b,d as et,f as L,h as u,m as Buffer,n as c}from"./chunk-3KENBVE7.js";var Pe=b(C=>{"use strict";u();c();Object.defineProperty(C,"__esModule",{value:!0});C.TokenData=void 0;C.parse=G;C.compile=xt;C.match=wt;C.pathToRegexp=qe;C.stringify=At;var j="/",F=e=>e,ve=/^[$_\p{ID_Start}]$/u,z=/^[$\u200c\u200d\p{ID_Continue}]$/u,N="https://git.new/pathToRegexpError",ht={"{":"{","}":"}","(":"(",")":")","[":"[","]":"]","+":"+","?":"?","!":"!"};function yt(e){return e.replace(/[{}()\[\]+?!:*]/g,"\\$&")}function R(e){return e.replace(/[.+*?^${}()[\]|/\\]/g,"\\$&")}function*Rt(e){let t=[...e],r=0;function n(){let o="";if(ve.test(t[++r]))for(o+=t[r];z.test(t[++r]);)o+=t[r];else if(t[r]==='"'){let s=r;for(;r<t.length;){if(t[++r]==='"'){r++,s=0;break}t[r]==="\\"?o+=t[++r]:o+=t[r]}if(s)throw new TypeError(`Unterminated quote at ${s}: ${N}`)}if(!o)throw new TypeError(`Missing parameter name at ${r}: ${N}`);return o}for(;r<t.length;){let o=t[r],s=ht[o];if(s)yield{type:s,index:r++,value:o};else if(o==="\\")yield{type:"ESCAPED",index:r++,value:t[r++]};else if(o===":"){let a=n();yield{type:"PARAM",index:r,value:a}}else if(o==="*"){let a=n();yield{type:"WILDCARD",index:r,value:a}}else yield{type:"CHAR",index:r,value:t[r++]}}return{type:"END",index:r,value:""}}var _=class{constructor(t){this.tokens=t}peek(){if(!this._peek){let t=this.tokens.next();this._peek=t.value}return this._peek}tryConsume(t){let r=this.peek();if(r.type===t)return this._peek=void 0,r.value}consume(t){let r=this.tryConsume(t);if(r!==void 0)return r;let{type:n,index:o}=this.peek();throw new TypeError(`Unexpected ${n} at ${o}, expected ${t}: ${N}`)}text(){let t="",r;for(;r=this.tryConsume("CHAR")||this.tryConsume("ESCAPED");)t+=r;return t}},E=class{constructor(t){this.tokens=t}};C.TokenData=E;function G(e,t={}){let{encodePath:r=F}=t,n=new _(Rt(e));function o(a){let p=[];for(;;){let l=n.text();l&&p.push({type:"text",value:r(l)});let m=n.tryConsume("PARAM");if(m){p.push({type:"param",name:m});continue}let h=n.tryConsume("WILDCARD");if(h){p.push({type:"wildcard",name:h});continue}if(n.tryConsume("{")){p.push({type:"group",tokens:o("}")});continue}return n.consume(a),p}}let s=o("END");return new E(s)}function xt(e,t={}){let{encode:r=encodeURIComponent,delimiter:n=j}=t,o=e instanceof E?e:G(e,t),s=ke(o.tokens,n,r);return function(p={}){let[l,...m]=s(p);if(m.length)throw new TypeError(`Missing parameters: ${m.join(", ")}`);return l}}function ke(e,t,r){let n=e.map(o=>St(o,t,r));return o=>{let s=[""];for(let a of n){let[p,...l]=a(o);s[0]+=p,s.push(...l)}return s}}function St(e,t,r){if(e.type==="text")return()=>[e.value];if(e.type==="group"){let o=ke(e.tokens,t,r);return s=>{let[a,...p]=o(s);return p.length?[""]:[a]}}let n=r||F;return e.type==="wildcard"&&r!==!1?o=>{let s=o[e.name];if(s==null)return["",e.name];if(!Array.isArray(s)||s.length===0)throw new TypeError(`Expected "${e.name}" to be a non-empty array`);return[s.map((a,p)=>{if(typeof a!="string")throw new TypeError(`Expected "${e.name}/${p}" to be a string`);return n(a)}).join(t)]}:o=>{let s=o[e.name];if(s==null)return["",e.name];if(typeof s!="string")throw new TypeError(`Expected "${e.name}" to be a string`);return[n(s)]}}function wt(e,t={}){let{decode:r=decodeURIComponent,delimiter:n=j}=t,{regexp:o,keys:s}=qe(e,t),a=s.map(p=>r===!1?F:p.type==="param"?r:l=>l.split(n).map(r));return function(l){let m=o.exec(l);if(!m)return!1;let h=m[0],y=Object.create(null);for(let S=1;S<m.length;S++){if(m[S]===void 0)continue;let I=s[S-1],H=a[S-1];y[I.name]=H(m[S])}return{path:h,params:y}}}function qe(e,t={}){let{delimiter:r=j,end:n=!0,sensitive:o=!1,trailing:s=!0}=t,a=[],p=[],l=o?"":"i",h=(Array.isArray(e)?e:[e]).map(I=>I instanceof E?I:G(I,t));for(let{tokens:I}of h)for(let H of U(I,0,[])){let Qe=Ct(H,r,a);p.push(Qe)}let y=`^(?:${p.join("|")})`;return s&&(y+=`(?:${R(r)}$)?`),y+=n?"$":`(?=${R(r)}|$)`,{regexp:new RegExp(y,l),keys:a}}function*U(e,t,r){if(t===e.length)return yield r;let n=e[t];if(n.type==="group"){let o=r.slice();for(let s of U(n.tokens,0,o))yield*U(e,t+1,s)}else r.push(n);yield*U(e,t+1,r)}function Ct(e,t,r){let n="",o="",s=!0;for(let a=0;a<e.length;a++){let p=e[a];if(p.type==="text"){n+=R(p.value),o+=p.value,s||(s=p.value.includes(t));continue}if(p.type==="param"||p.type==="wildcard"){if(!s&&!o)throw new TypeError(`Missing text after "${p.name}": ${N}`);p.type==="param"?n+=`(${It(t,s?"":o)}+)`:n+="([\\s\\S]+)",r.push(p),o="",s=!1;continue}}return n}function It(e,t){return t.length<2?e.length<2?`[^${R(e+t)}]`:`(?:(?!${R(e)})[^${R(t)}])`:e.length<2?`(?:(?!${R(t)})[^${R(e)}])`:`(?:(?!${R(t)}|${R(e)})[\\s\\S])`}function At(e){return e.tokens.map(function t(r,n,o){if(r.type==="text")return yt(r.value);if(r.type==="group")return`{${r.tokens.map(t).join("")}}`;let a=Et(r.name)&&Tt(o[n+1])?r.name:JSON.stringify(r.name);if(r.type==="param")return`:${a}`;if(r.type==="wildcard")return`*${a}`;throw new TypeError(`Unexpected token: ${r}`)}).join("")}function Et(e){let[t,...r]=e;return ve.test(t)?r.every(n=>z.test(n)):!1}function Tt(e){return e?.type!=="text"?!0:!z.test(e.value[0])}});var B=b(f=>{"use strict";u();c();Object.defineProperty(f,"__esModule",{value:!0});f.isHexString=f.getKeys=f.fromAscii=f.fromUtf8=f.toAscii=f.arrayContainsArray=f.getBinarySize=f.padToEven=f.stripHexPrefix=f.isHexPrefixed=void 0;function He(e){if(typeof e!="string")throw new Error(`[isHexPrefixed] input must be type 'string', received type ${typeof e}`);return e[0]==="0"&&e[1]==="x"}f.isHexPrefixed=He;var Kt=e=>{if(typeof e!="string")throw new Error(`[stripHexPrefix] input must be type 'string', received ${typeof e}`);return He(e)?e.slice(2):e};f.stripHexPrefix=Kt;function Le(e){let t=e;if(typeof t!="string")throw new Error(`[padToEven] value must be type 'string', received ${typeof t}`);return t.length%2&&(t=`0${t}`),t}f.padToEven=Le;function Wt(e){if(typeof e!="string")throw new Error(`[getBinarySize] method requires input type 'string', received ${typeof e}`);return Buffer.byteLength(e,"utf8")}f.getBinarySize=Wt;function _t(e,t,r){if(Array.isArray(e)!==!0)throw new Error(`[arrayContainsArray] method requires input 'superset' to be an array, got type '${typeof e}'`);if(Array.isArray(t)!==!0)throw new Error(`[arrayContainsArray] method requires input 'subset' to be an array, got type '${typeof t}'`);return t[r===!0?"some":"every"](n=>e.indexOf(n)>=0)}f.arrayContainsArray=_t;function jt(e){let t="",r=0,n=e.length;for(e.substring(0,2)==="0x"&&(r=2);r<n;r+=2){let o=parseInt(e.substr(r,2),16);t+=String.fromCharCode(o)}return t}f.toAscii=jt;function Ft(e){let t=Buffer.from(e,"utf8");return`0x${Le(t.toString("hex")).replace(/^0+|0+$/g,"")}`}f.fromUtf8=Ft;function zt(e){let t="";for(let r=0;r<e.length;r++){let o=e.charCodeAt(r).toString(16);t+=o.length<2?`0${o}`:o}return`0x${t}`}f.fromAscii=zt;function Gt(e,t,r){if(!Array.isArray(e))throw new Error(`[getKeys] method expects input 'params' to be an array, got ${typeof e}`);if(typeof t!="string")throw new Error(`[getKeys] method expects input 'key' to be type 'string', got ${typeof e}`);let n=[];for(let o=0;o<e.length;o++){let s=e[o][t];if(r===!0&&!s)s="";else if(typeof s!="string")throw new Error(`invalid abi - expected type 'string', received ${typeof s}`);n.push(s)}return n}f.getKeys=Gt;function Jt(e,t){return!(typeof e!="string"||!e.match(/^0x[0-9A-Fa-f]*$/)||typeof t<"u"&&t>0&&e.length!==2+2*t)}f.isHexString=Jt});var Ke=b(x=>{"use strict";u();c();Object.defineProperty(x,"__esModule",{value:!0});x.assertIsString=x.assertIsArray=x.assertIsBuffer=x.assertIsHexString=void 0;var Xt=B(),Yt=function(e){if(!(0,Xt.isHexString)(e)){let t=`This method only supports 0x-prefixed hex strings but input was: ${e}`;throw new Error(t)}};x.assertIsHexString=Yt;var Zt=function(e){if(!Buffer.isBuffer(e)){let t=`This method only supports Buffer but input was: ${e}`;throw new Error(t)}};x.assertIsBuffer=Zt;var Qt=function(e){if(!Array.isArray(e)){let t=`This method only supports number arrays but input was: ${e}`;throw new Error(t)}};x.assertIsArray=Qt;var er=function(e){if(typeof e!="string"){let t=`This method only supports strings but input was: ${e}`;throw new Error(t)}};x.assertIsString=er});var Fe=b(i=>{"use strict";u();c();Object.defineProperty(i,"__esModule",{value:!0});i.intToUnpaddedBuffer=i.bigIntToUnpaddedBuffer=i.bigIntToHex=i.bufArrToArr=i.arrToBufArr=i.validateNoLeadingZeroes=i.baToJSON=i.toUtf8=i.short=i.addHexPrefix=i.toUnsigned=i.fromSigned=i.bufferToInt=i.bigIntToBuffer=i.bufferToBigInt=i.bufferToHex=i.toBuffer=i.unpadHexString=i.unpadArray=i.unpadBuffer=i.setLengthRight=i.setLengthLeft=i.zeros=i.intToBuffer=i.intToHex=void 0;var D=Ke(),A=B(),tr=function(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Received an invalid integer type: ${e}`);return`0x${e.toString(16)}`};i.intToHex=tr;var rr=function(e){let t=(0,i.intToHex)(e);return Buffer.from((0,A.padToEven)(t.slice(2)),"hex")};i.intToBuffer=rr;var nr=function(e){return Buffer.allocUnsafe(e).fill(0)};i.zeros=nr;var We=function(e,t,r){let n=(0,i.zeros)(t);return r?e.length<t?(e.copy(n),n):e.slice(0,t):e.length<t?(e.copy(n,t-e.length),n):e.slice(-t)},or=function(e,t){return(0,D.assertIsBuffer)(e),We(e,t,!1)};i.setLengthLeft=or;var sr=function(e,t){return(0,D.assertIsBuffer)(e),We(e,t,!0)};i.setLengthRight=sr;var ee=function(e){let t=e[0];for(;e.length>0&&t.toString()==="0";)e=e.slice(1),t=e[0];return e},ir=function(e){return(0,D.assertIsBuffer)(e),ee(e)};i.unpadBuffer=ir;var ar=function(e){return(0,D.assertIsArray)(e),ee(e)};i.unpadArray=ar;var ur=function(e){return(0,D.assertIsHexString)(e),e=(0,A.stripHexPrefix)(e),"0x"+ee(e)};i.unpadHexString=ur;var cr=function(e){if(e==null)return Buffer.allocUnsafe(0);if(Buffer.isBuffer(e))return Buffer.from(e);if(Array.isArray(e)||e instanceof Uint8Array)return Buffer.from(e);if(typeof e=="string"){if(!(0,A.isHexString)(e))throw new Error(`Cannot convert string to buffer. toBuffer only supports 0x-prefixed hex strings and this string was given: ${e}`);return Buffer.from((0,A.padToEven)((0,A.stripHexPrefix)(e)),"hex")}if(typeof e=="number")return(0,i.intToBuffer)(e);if(typeof e=="bigint"){if(e<BigInt(0))throw new Error(`Cannot convert negative bigint to buffer. Given: ${e}`);let t=e.toString(16);return t.length%2&&(t="0"+t),Buffer.from(t,"hex")}if(e.toArray)return Buffer.from(e.toArray());if(e.toBuffer)return Buffer.from(e.toBuffer());throw new Error("invalid type")};i.toBuffer=cr;var pr=function(e){return e=(0,i.toBuffer)(e),"0x"+e.toString("hex")};i.bufferToHex=pr;function te(e){let t=(0,i.bufferToHex)(e);return BigInt(t==="0x"?0:t)}i.bufferToBigInt=te;function re(e){return(0,i.toBuffer)("0x"+e.toString(16))}i.bigIntToBuffer=re;var dr=function(e){let t=Number(te(e));if(!Number.isSafeInteger(t))throw new Error("Number exceeds 53 bits");return t};i.bufferToInt=dr;var fr=function(e){return BigInt.asIntN(256,te(e))};i.fromSigned=fr;var lr=function(e){return re(BigInt.asUintN(256,e))};i.toUnsigned=lr;var mr=function(e){return typeof e!="string"||(0,A.isHexPrefixed)(e)?e:"0x"+e};i.addHexPrefix=mr;function gr(e,t=50){let r=Buffer.isBuffer(e)?e.toString("hex"):e;return r.length<=t?r:r.slice(0,t)+"\u2026"}i.short=gr;var hr=function(e){let t=/^(00)+|(00)+$/g;if(e=(0,A.stripHexPrefix)(e),e.length%2!==0)throw new Error("Invalid non-even hex string input for toUtf8() provided");return Buffer.from(e.replace(t,""),"hex").toString("utf8")};i.toUtf8=hr;var yr=function(e){if(Buffer.isBuffer(e))return`0x${e.toString("hex")}`;if(e instanceof Array){let t=[];for(let r=0;r<e.length;r++)t.push((0,i.baToJSON)(e[r]));return t}};i.baToJSON=yr;var Rr=function(e){for(let[t,r]of Object.entries(e))if(r!==void 0&&r.length>0&&r[0]===0)throw new Error(`${t} cannot have leading zeroes, received: ${r.toString("hex")}`)};i.validateNoLeadingZeroes=Rr;function _e(e){return Array.isArray(e)?e.map(t=>_e(t)):Buffer.from(e)}i.arrToBufArr=_e;function je(e){return Array.isArray(e)?e.map(t=>je(t)):Uint8Array.from(e??[])}i.bufArrToArr=je;var xr=e=>"0x"+e.toString(16);i.bigIntToHex=xr;function Sr(e){return(0,i.unpadBuffer)(re(e))}i.bigIntToUnpaddedBuffer=Sr;function wr(e){return(0,i.unpadBuffer)((0,i.intToBuffer)(e))}i.intToUnpaddedBuffer=wr});var be={};et(be,{any:()=>ot,cancelled:()=>gt,chainDisconnected:()=>st,error:()=>nt,internalError:()=>at,invalidInput:()=>it,methodNotFound:()=>ut,rateLimited:()=>lt,resourceUnavailable:()=>ct,result:()=>rt,transactionRejected:()=>pt,unauthorized:()=>dt,unsupportedMethod:()=>ft,userRejectedRequest:()=>mt});u();c();var rt=(e,t)=>({jsonrpc:"2.0",id:e,result:t}),nt=(e,t)=>({jsonrpc:"2.0",id:e,error:t}),ot=(e,t)=>({...t,jsonrpc:"2.0",id:e}),st=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4901,message:t??"The Provider is not connected to the requested chain."}}),it=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32e3,message:t??"Missing or invalid parameters."}}),at=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32603,message:t??"Something went wrong."}}),ut=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32601,message:t??"Method does not exist."}}),ct=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32002,message:t??"Requested resource not available."}}),pt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32003,message:t??"Transaction creation failed."}}),dt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4100,message:t??"The requested method and/or account has not been authorized by the user."}}),ft=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4200,message:t??"The requested method is not supported."}}),lt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4290,message:t??"The requested method has been rate limited."}}),mt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:4001,message:t??"User rejected the request."}}),gt=(e,t)=>({id:e,jsonrpc:"2.0",error:{code:-32800,message:t??"The request was cancelled."}});u();c();u();c();var Ue=L(Pe());u();c();u();c();var g=[];for(let e=0;e<256;++e)g.push((e+256).toString(16).slice(1));function Me(e,t=0){return(g[e[t+0]]+g[e[t+1]]+g[e[t+2]]+g[e[t+3]]+"-"+g[e[t+4]]+g[e[t+5]]+"-"+g[e[t+6]]+g[e[t+7]]+"-"+g[e[t+8]]+g[e[t+9]]+"-"+g[e[t+10]]+g[e[t+11]]+g[e[t+12]]+g[e[t+13]]+g[e[t+14]]+g[e[t+15]]).toLowerCase()}u();c();var J,Dt=new Uint8Array(16);function X(){if(!J){if(typeof self.crypto>"u"||!self.crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");J=self.crypto.getRandomValues.bind(self.crypto)}return J(Dt)}u();c();u();c();var bt=typeof self.crypto<"u"&&self.crypto.randomUUID&&self.crypto.randomUUID.bind(self.crypto),Y={randomUUID:bt};function vt(e,t,r){if(Y.randomUUID&&!t&&!e)return Y.randomUUID();e=e||{};let n=e.random??e.rng?.()??X();if(n.length<16)throw new Error("Random bytes length must be >= 16");if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){if(r=r||0,r<0||r+16>t.length)throw new RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let o=0;o<16;++o)t[r+o]=n[o];return t}return Me(n)}var Z=vt;function kt(e,t){return{request:e,source:t,id:Z()}}function qt(){return{parse(e){return Mt(e)}}}function Pt(e,t){let r=new URL(e),n=r.host+r.pathname;return(0,Ue.match)(t)(n)}function Mt(e){function t(r,n,o){return async a=>{if(e.path&&a.source?.type==="DeepLinkRpcRequestSource"){let h=Pt(a.source.deepLinkUrl,e.path);h&&a.request.params&&typeof a.request.params=="object"&&(a.request.params={...a.request.params,...h.params})}let p={...a,request:e.request.parse(a.request)},l=[];for(let h of n){let y=await h(p,r);if(y){if(typeof y!="function")return setTimeout(()=>{for(let S of l)S(y)},0),y;l.push(y)}}let m=e.response.parse(await o(p,r));if(m.id!==a.request.id){let h="Request id does not match response id";throw console.error(h,{request:a.request,response:m}),new Error(h)}return setTimeout(()=>{for(let h of l)h(m)},0),m}}return{context(r){return{use:(n,o)=>t(r,n,o)}},use:(r,n)=>t(void 0,r,n)}}u();c();var Q=class{#e;constructor(t){this.#e=t}init(t,r){let n=new AbortController,{signal:o}=n,s=Ut(this.#e.routes,this.#e.concurrent);return{start:async()=>{if(o.aborted){console.warn("stream already closed");return}try{await t.pipeThrough(s,{signal:o}).pipeTo(r,{signal:o})}catch(a){o.aborted||console.error("RPC router stream error",a)}},stop:a=>{n.abort(a)}}}};function Ut(e,t){return new TransformStream({async transform(r,n){let o=async()=>{let s=e[r.request.method];if(!s){let a={jsonrpc:"2.0",id:r.request.id,error:{code:0,message:`${r.request.method} isn't implemented`}};return n.enqueue([r,a])}try{let a=await s(r);return n.enqueue([r,a])}catch(a){console.error(`RPC ROUTER: Unexpected error in method: ${r.request.method}, message: ${a?.message}`);let p={jsonrpc:"2.0",id:r.request.id,error:{code:-32603,message:"Unexpected error"}};return n.enqueue([r,p])}};t?o():await o()}})}u();c();u();c();var Ne=e=>{let t=new P,r=new ce({storage:t,getPassword:e}),n=ue.fromStorage(t,r),o=new pe,s=new Se({keyPair:{solana:Re(),eip155:he(),bip122_p2tr:T(),bip122_p2wpkh:T(),bip122_p2sh:T(),bip122_p2pkh:T(),sui:xe(),JWT:ye(),Agent:me(),Cash:ge()},ledger:Ae(),seedVault:{type:"seedVault",async sign(){return le("unsupportedOperation")}}}),a=()=>de(t),p={generalStorage:t,secretsStorage:n,secureCache:we({isEnabled:()=>!M("kill-vault-secure-cache"),generalStorage:t,secretsStorage:n}),fetchChainAvailability:a,keypairGenerator:o,vaultSigner:s};return{vault:Ce(p),getChainAvailability:a,encryptedStorage:n,storageEncryptionKeyManager:r}};u();c();var Nt=/^\.phantom-labs\.vault\.seed\.[0-9A-Fa-f]+$/,$t=/^\.phantom-labs\.vault\.privateKey\.[0-9A-Fa-f]+$/;async function Be(e){let t;try{if(t=await e.storageEncryptionKeyManager.hasPersistedDeviceEncryptionKey(),!t)return{status:"noMiddleEncryptionKey"}}catch{return{status:"errorRetrievingMiddleEncryptionKey"}}let r;try{r=(await e.vault.checkVaultIntegrity()).status}catch{return{status:"errorUnableToCheckVaultIntegrity"}}try{let n=await e.generalStorage.getAll(),[o,s]=await $e(e,n,Nt),[a,p]=await $e(e,n,$t);return{status:"hasMiddleEncryptionKey",vaultStatus:r,numberOfEncryptedSeeds:o,numberOfDecryptableSeeds:s,numberOfEncryptedPrivateKeys:a,numberOfDecryptablePrivateKeys:p}}catch{return{status:"errorUnableToCountDecryptableValues",vaultStatus:r}}}async function $e(e,t,r){let n=0,o=0;for(let[s,a]of Object.entries(t))if(!(!s.match(r)||!ae.safeParse(a).success)){n++;try{await e.secretsStorage.getSecureValue(s),o++}catch{}}return[n,o]}var Vn="HAS_ONBOARDING_BEEN_OPENED",Hn="EXTENSION_LOCKED",$=null,Ln=()=>$,Vt=e=>{$=e},Kn=()=>{$=null},Ht=()=>$??null,{vault:Oe,getChainAvailability:Wn,encryptedStorage:Lt,storageEncryptionKeyManager:Ve}=Ne(Ht),_n=async e=>!e||!await w.startSpan("storageEncryptionKeyManager.verifyPassword",()=>Ve.verifyPassword(e))?!1:(Vt(e),!0),jn=async()=>{let e=await Oe.deriveAddresses();return e&&(w.addBreadcrumb("account","\u2705 Derived new addresses in Vault","info"),await De.invalidateQueries({refetchType:"all"})),e},Fn=async()=>{if(!M("kill-extension-storage-integrity-check"))try{let e=await Be({generalStorage:new P,secretsStorage:Lt,storageEncryptionKeyManager:Ve,vault:Oe});e.status!=="hasMiddleEncryptionKey"&&Te.capture("extensionStorageIntegrityCheck",{data:{extensionStorageIntegrityCheck:e}})}catch{}};u();c();var ne=L(Fe()),ze=L(B()),Cr=/^[0-9A-Fa-f]+$/gu;function Ge(e){try{let t=(0,ze.stripHexPrefix)(e);if(t.match(Cr))return Ir(t)}catch{return(0,ne.bufferToHex)(Buffer.from(e,"utf8"))}return(0,ne.bufferToHex)(Buffer.from(e,"utf8"))}var Ir=e=>typeof e!="string"||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):e.startsWith("-")?e.replace("-","-0x"):`0x${e}`,Ar=e=>{let t=Buffer.from(e.substring(2),"hex"),r=t.length===32?"hex":"utf8",n;switch(r){case"hex":n=Ge(e);break;case"utf8":default:n=t.toString("utf8")}return n};u();c();u();c();var Tr={UNSUPPORTED_DAPP:"autoConfirmReasonDappNotWhitelisted",DISABLED:"autoConfirmReasonSessionNotActive",RATE_LIMIT_EXCEEDED:"autoConfirmReasonRateLimited",SIMULATION_FAILED:"autoConfirmReasonSimulationFailed",UNSUPPORTED_NETWORK_ID:"autoConfirmReasonUnsupportedNetwork",TAB_NOT_FOCUSED:"autoConfirmReasonTabNotFocused",WALLET_LOCKED:"autoConfirmReasonNotUnlocked"},Dr=e=>e?Tr[e]:void 0;u();c();u();c();u();c();var oe=e=>`/auto-confirm/v1/${e}`;async function Je(e){return q.isEVMNetworkID(e.chainId)?(await k.api().post(oe("transaction"),{txObjects:e.txObjects,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:q.isSolanaNetworkID(e.chainId)?(await k.api().post(oe("transaction"),{transactions:e.transactions,chainId:e.chainId,domain:e.domain})).data?.isEligible===!0:!1}async function Xe(e){if(q.isEVMNetworkID(e.chainId)){let t=JSON.parse(JSON.stringify(e.data));return delete t.message,delete t.primaryType,delete t.types,(await(await k.api().post(oe("message"),{chainId:e.chainId,domain:e.domain,data:[t]})).data)?.isEligible===!0}return!1}var br=10,O=[],se=class{constructor(t){this.storage=t}executedChecksAudit=[];isDappWhitelistedForMessage=Xe;isDappWhitelistedForTransaction=Je;async isEthTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:v(t.url.origin),txObjects:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:s,...a}=await this.didPassEthTransactionSimulation(t,r);return s?{...n,...a,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...a,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}async isEthMessageAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);return n.status!=="OK"?n:await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForMessage({chainId:t.networkID,domain:v(t.url.origin),data:t.data})?await this.didPassEthMessageSimulation(t,r)?{...n,status:"OK",auditTrail:this.executedChecksAudit}:{...n,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}:{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit}}async isSolTransactionAutoConfirmable(t,r){this.executedChecksAudit=[];let n=await this.didPassGenericChecks(t);if(n.status!=="OK")return n;if(!(await this.isDappWhitelistOverridden()||await this.isDappWhitelistedForTransaction({chainId:t.networkID,domain:v(t.url.origin),transactions:t.data})))return{...n,status:"UNSUPPORTED_DAPP",auditTrail:this.executedChecksAudit};let{success:s,...a}=await this.didPassSolTransactionSimulation(t,r);return s?{...n,...a,status:"OK",auditTrail:this.executedChecksAudit}:{...n,...a,status:"SIMULATION_FAILED",auditTrail:this.executedChecksAudit}}isSolMessageAutoConfirmable(t){return this.executedChecksAudit=[],Promise.resolve({status:"UNIMPLEMENTED"})}async didPassGenericChecks(t){try{if(!await this.isFeatureEnabled())return{status:"FEATURE_KILLED"};if(!await this.isWalletUnlocked())return{status:"WALLET_LOCKED"};if(!await this.isTabFocused(t.url.origin))return{status:"TAB_NOT_FOCUSED"};if(!await this.isAutoConfirmEnabledInUserSettings({origin:t.url.origin,networkID:t.networkID,accountIdentifier:t.accountIdentifier}))return{status:"DISABLED"};let r=await this.isAutoConfirmSessionActive(t.accountIdentifier,t.url.origin);return r.success?await this.isNotRateLimited()?{status:"OK",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"RATE_LIMIT_EXCEEDED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}:{status:"SESSION_EXPIRED",sessionStartTime:r.sessionStartTime,sessionMaxDuration:r.sessionMaxDuration}}catch{return{status:"UNKNOWN"}}}async isAutoConfirmEnabledInUserSettings({origin:t,accountIdentifier:r,networkID:n}){return this.executedChecksAudit.push("IS_AUTO_CONFIRM_ENABLED_IN_USER_SETTINGS"),(await K(this.storage,r,t))?.networks?.[n]===!0}isNotRateLimited(){this.executedChecksAudit.push("IS_NOT_RATE_LIMITED");let t=O.findIndex(r=>r<=Date.now()-6e4);return t>-1&&O.splice(t),O.length>=br?!1:(O.push(Date.now()),!0)}async isAutoConfirmSessionActive(t,r){this.executedChecksAudit.push("IS_AUTO_CONFIRM_SESSION_ACTIVE");let n=await K(this.storage,t,r),o=Ie(n);return{sessionStartTime:n.sessionStartTime,sessionMaxDuration:n.maxSessionDuration,success:o}}async didPassEthTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_TRANSACTION_SIMULATION");try{let n=await W(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url?.href,userAccount:t.userAccountAddress,params:{transactions:t.data,userAddresses:[]}});return Ye(n)}catch{return{success:!1}}}async didPassSolTransactionSimulation(t,r){this.executedChecksAudit.push("DID_PASS_SOL_TRANSACTION_SIMULATION");try{let n=await W(r.locale,r.deviceId,{networkID:t.networkID,type:"transaction",url:t.url.href,userAccount:t.userAccountAddress,params:{transactions:t.data,method:"signAndSendTransaction"}});return Ye(n)}catch{return{success:!1}}}async didPassEthMessageSimulation(t,r){this.executedChecksAudit.push("DID_PASS_ETH_MESSAGE_SIMULATION");try{let n=await Ee(r.locale,r.deviceId,{params:{message:"0x"+Buffer.from(JSON.stringify(t.data)).toString("hex")},type:"message",userAccount:t.userAccountAddress,networkID:t.networkID,url:t.url?.href});return vr(n)}catch{return!1}}};function Ye(e){let t=!!e.warnings.find(o=>o.severity<=3),r=!!e.block,n=e.expectedChanges.map(o=>o.type==="AssetChange"&&o.asset.usdValue||0).reduce((o,s)=>o+s,0);return{success:!t&&!r&&!e.error,dollarValue:parseFloat((n||0).toFixed(6))}}function vr(e){let t=!!e.warnings.find(n=>n.severity<=3),r=!!e.block;return!t&&!r&&!e.error}u();c();var Ze=7,No=ie(fe,e=>new V(e)),V=class{#e;constructor(t){this.#e=t}onAutoConfirmSettingsChanged({origin:t,networkID:r,enabled:n,sessionStartTime:o,maxSessionDuration:s,view:a}){w.addBreadcrumb(`Auto-Confirm: ${n?"Enabling":"Disabling"} network ID ${r}`,"autoConfirm","info"),this.#e.capture("autoConfirmSettingsChanged",{data:{origin:t,networkId:r,enabled:n,sessionStartTime:n?o:void 0,maxSessionDuration:n?s:void 0,view:a}})}transactionAutoConfirmed(t){let r={type:"transaction",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<Ze&&(t.autoConfirm.suspectSettingsTamper=!0),w.addBreadcrumb(`Auto-Confirm: transaction on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&w.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}messageAutoConfirmed(t){let r={type:"message",data:t};return t.autoConfirm.auditTrail?.length&&t.autoConfirm.auditTrail.length<Ze&&(t.autoConfirm.suspectSettingsTamper=!0),w.addBreadcrumb(`Auto-Confirm: message on origin ${t.origin} for network ${t.networkId} auto-confirmed`,"autoConfirm","info"),t.autoConfirm.suspectSettingsTamper&&w.addBreadcrumb("Auto-Confirm: suspected tampering with settings...","autoConfirm","info"),this.#e.capture("transactionAutoConfirmed",r)}};export{kt as a,qt as b,Q as c,be as d,Vn as e,Hn as f,Ln as g,Vt as h,Kn as i,Oe as j,Wn as k,Lt as l,Ve as m,_n as n,jn as o,Fn as p,se as q,No as r,V as s,Dr as t,Ge as u,Ar as v};
//# sourceMappingURL=chunk-KROPTDUJ.js.map
