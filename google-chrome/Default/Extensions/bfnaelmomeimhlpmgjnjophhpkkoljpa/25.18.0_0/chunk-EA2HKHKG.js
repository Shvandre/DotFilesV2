import{c as C,i as O}from"./chunk-QNLMWMRR.js";import{m as at,o as B,p as ot,q as v,s as x,v as nt,w as W}from"./chunk-4AX42N6B.js";import{Ab as P,Dc as z,Ec as N,Ka as b}from"./chunk-HKKBRKQE.js";import{H as Q,K as R,L as s,Ya as c}from"./chunk-3GZCHS7Y.js";import{i as X,l as $}from"./chunk-SK6BTSEQ.js";import{x as I}from"./chunk-BY5XXL4W.js";import{q as tt}from"./chunk-WP4K54AS.js";import{C as T,u as w,w as D,z as et}from"./chunk-UCPKAIVR.js";import{R as Y,S as Z}from"./chunk-NL7NWYRL.js";import{a as M}from"./chunk-57IY32VM.js";import{f as U,h as o,n}from"./chunk-3KENBVE7.js";o();n();var K=U(M());o();n();var rt={location:0,distance:50,threshold:.2,shouldSort:!0,keys:[{name:"info.name",weight:.5},{name:"info.keybaseUsername",weight:.3},{name:"info.website",weight:.1},{name:"voteAccountPubkey",weight:.1},{name:"identityPubkey",weight:.1}]},it={identityPublicKey:"7GkMBmtrTZz8QbjSe1sXvAUtz7Pp42SQxfT5ymmJD4We",voteAccountPublicKey:"J2nUHEAgZFRyuJbFjdqPrAa9gyWDuc7hErtDQHPhsYRp"};o();n();var st=e=>(r,i)=>{let t=e.indexOf(r.voteAccountPubkey),d=e.indexOf(i.voteAccountPubkey);return(t>-1?t:1/0)-(d>-1?d:1/0)};o();n();o();n();var ct=new Error("Failed to fetch recommended staking validators.");async function ut(){try{let e=await X.api().get("/staking/v1/recommended");if(!$(e))throw ct;let r=e.data;return at.parse(r).validators}catch{throw ct}}var mt=()=>{let e=ot.recommendedValidators();return et({enabled:!0,queryKey:e,gcTime:nt.Long,staleTime:1/0,async queryFn(){return ut()}})};function pt(){let{connection:e}=z(),r=W(e),{results:i=[]}=r,t=mt(),{data:d=null,isFetched:E}=O(),F=tt.isFeatureEnabled("kill-phantom-validator"),[a,u]=(0,K.useState)(""),y=Y(a),k=(0,K.useMemo)(()=>{let A=i.map(V=>({...V,totalApy:d?B(d,V?.commission):null})),S=t.data??[];if(S.length===0)return A;let L=A.sort(st(S));return F?L.filter(V=>V.identityPubkey!==it.identityPublicKey):L},[i,t.data,d,F]),g=Z(k,y||"",rt),m=(0,K.useCallback)(()=>{r.isError&&!r.isFetching&&r.refetch(),t.isError&&!t.isFetching&&t.refetch()},[t,r]),l=!r.isFetched||!E||!t.isFetched,f=r.isError||t.isError,h=r.isSuccess;return{isLoading:l,isSuccess:h,hasError:f,searchResults:g,showApy:d!==null,onRefetch:m,searchTerm:a,setSearchTerm:u}}o();n();function St({stakePubkey:e,stakeAuthorityPubkey:r,authorizedPubkey:i,transaction:t=new R.Transaction}){return r.equals(i)||t.add(s.StakeProgram.authorize({authorizedPubkey:i,newAuthorizedPubkey:i,stakeAuthorizationType:s.StakeAuthorizationLayout.Staker,stakePubkey:e})),t.add(s.StakeProgram.deactivate({stakePubkey:e,authorizedPubkey:i})),t}var yt=e=>{let{t:r}=I(),i=w(),t=x(),{mutateAsync:d}=N(e);return D({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,stakeAuthorityPubkey:k,authorizedPubkey:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=St({stakePubkey:y,stakeAuthorityPubkey:k,authorizedPubkey:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"deactivateState",display:{summary:{topLeft:{text:r("transactionsPendingDeactivatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"undelegate"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),t.deactivateStake(),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}}),v(i)()}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),T.captureError(u,"staking")})}})};o();n();function G({stakePubkey:e,authorizedPubkey:r,votePubkey:i}){return s.StakeProgram.delegate({stakePubkey:e,authorizedPubkey:r,votePubkey:i})}var kt=e=>{let{t:r}=I(),i=w(),t=x(),{mutateAsync:d}=N(e);return D({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,authorizedPubkey:k,votePubkey:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=G({stakePubkey:y,authorizedPubkey:k,votePubkey:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"delegateStake",display:{summary:{topLeft:{text:r("transactionsPendingDelegatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"delegate"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}}),v(i)()}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),T.captureError(u,"staking")})}})};o();n();function ft({stakePubkey:e,authorizedPubkey:r,amount:i,transaction:t=new R.Transaction}){return t.add(s.StakeProgram.withdraw({stakePubkey:e,authorizedPubkey:r,toPubkey:r,lamports:i})),t}var At=e=>{let{t:r}=I(),i=w(),t=x(),{mutateAsync:d}=N(e);return D({mutationFn:async({accountIdentifier:a,senderAddress:u,stakePubkey:y,authorizedPubkey:k,amount:g})=>{if(!u)throw C;let{networkID:m,address:l}=u,f=ft({stakePubkey:y,authorizedPubkey:k,amount:g}),h=await b(f,{connection:e}),A={ownerAddress:l??"",networkID:m,data:{signature:""},type:"withdrawStake",display:{summary:{topLeft:{text:r("transactionsPendingWithdrawingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),type:"withdraw"});let S=await d({accountIdentifier:a,feePayer:new s.PublicKey(l),transaction:h,pendingTransactionInput:A});return t.submittedTransaction(S,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(m),method:"signAndSendTransaction"}),{networkID:m,id:S??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}}),v(i)()}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),T.captureError(u,"staking")})}})};o();n();function gt({ownerPublicKey:e,lamports:r,transaction:i=new R.Transaction}){let t=s.Keypair.generate();return i.add(s.StakeProgram.createAccount({fromPubkey:e,stakePubkey:t.publicKey,authorized:new s.Authorized(e,e),lamports:r})),[i,t]}function ht({lamports:e,votePubkey:r,authorizedPubkey:i}){let[t,d]=gt({ownerPublicKey:i,lamports:e});return t.add(G({stakePubkey:d.publicKey,authorizedPubkey:i,votePubkey:r})),[t,d]}var wt=e=>{let{t:r}=I(),i=w(),t=x(),{mutateAsync:d}=N(e);return D({mutationFn:async({accountIdentifier:a,senderAddress:u,lamports:y,votePubkey:k,authorizedPubkey:g,usdPerSol:m})=>{if(!u)throw C;let{networkID:l,address:f}=u,[h,A]=ht({accountIdentifier:a,senderAddress:u,lamports:y,votePubkey:k,authorizedPubkey:g}),S=await b(h,{connection:e}),L={ownerAddress:f??"",networkID:l,data:{signature:""},type:"createAccountAndDelegateStake",display:{summary:{topLeft:{text:r("transactionsPendingCreatingAndDelegatingStake")}}}};t.approved({chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(l),type:"delegate"});let V=await d({accountIdentifier:a,feePayer:new s.PublicKey(f),transaction:S,pendingTransactionInput:L,opts:{additionalSignerAccounts:[A]}});t.submittedTransaction(V,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(l),method:"signAndSendTransaction"});let J=Q(y),lt=m?J.times(m):void 0;return t.createStakeAccountAndDelegateStake({sol:J.toNumber(),usd:lt?.toNumber(),voteAccountPubkey:k}),{networkID:l,id:V??""}},onSuccess:a=>{P({connection:e,signature:a.id}).then(()=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"confirmed"}}),v(i)()}).catch(u=>{t.transactionStatus(a.id,{chainType:"solana",chainName:"solana",networkId:c.getSolanaNetworkIDValue(a.networkID),status:{type:"error"}}),T.captureError(u,"staking")})}})};o();n();o();n();var dt=U(M());o();n();var bt=U(M());o();n();o();n();var Tt=U(M());o();n();var It=U(M());o();n();export{pt as a,yt as b,kt as c,At as d,wt as e};
//# sourceMappingURL=chunk-EA2HKHKG.js.map
